<!DOCTYPE html><html lang="zh-CN" data-theme="light"> <head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>STM32HAL库 | 会飞的鱼</title><meta name="author" content="6+1"><meta name="copyright" content="6+1"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="HAL库">
<meta property="og:type" content="article">
<meta property="og:title" content="STM32HAL库">
<meta property="og:url" content="http://example.com/2023/11/18/STM32HAL%E5%BA%93/index.html">
<meta property="og:site_name" content="会飞的鱼">
<meta property="og:description" content="HAL库">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/num9.webp">
<meta property="article:published_time" content="2023-11-18T01:41:52.000Z">
<meta property="article:modified_time" content="2023-11-25T11:36:30.270Z">
<meta property="article:author" content="6+1">
<meta property="article:tag" content="STM32">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/num9.webp"><link rel="shortcut icon" href="/img/tubiao.webp"><link rel="canonical" href="http://example.com/2023/11/18/STM32HAL%E5%BA%93/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'STM32HAL库',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-25 19:36:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/izitoast@1.4.0/dist/css/iziToast.min.css" media="all" onload="this.media='all'"><link rel="stylesheet" href="/css/readPercent.css"><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/TX1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-home"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-home"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-guidang"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guidang"></use></svg><span> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw icon-MBEfenggechangyongtubiao-biaoqian"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-MBEfenggechangyongtubiao-biaoqian"></use></svg><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw icon-fenlei"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei"></use></svg><span> 分类</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liebiao"></use></svg><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinlecidai">                   </use></svg><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon--dianyingyuan-">                   </use></svg><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw icon-liuyanban"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liuyanban"></use></svg><span> 留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw icon-lianjie"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-lianjie"></use></svg><span> 友链</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-aixin"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-aixin"></use></svg><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/num9.webp')"><nav class="fixed" id="nav"><span id="blog-info"><a href="/" title="会飞的鱼"><span class="site-name">会飞的鱼</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-sousuo"></use></svg></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-home"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-home"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-guidang"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guidang"></use></svg><span> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw icon-MBEfenggechangyongtubiao-biaoqian"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-MBEfenggechangyongtubiao-biaoqian"></use></svg><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw icon-fenlei"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei"></use></svg><span> 分类</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liebiao"></use></svg><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinlecidai">                   </use></svg><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon--dianyingyuan-">                   </use></svg><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw icon-liuyanban"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liuyanban"></use></svg><span> 留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw icon-lianjie"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-lianjie"></use></svg><span> 友链</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-aixin"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-aixin"></use></svg><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">STM32HAL库</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-18T01:41:52.000Z" title="发表于 2023-11-18 09:41:52">2023-11-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-25T11:36:30.270Z" title="更新于 2023-11-25 19:36:30">2023-11-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/32%E5%8D%95%E7%89%87%E6%9C%BA/">32单片机</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2w</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>80分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="STM32HAL库"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><strong>==注==</strong> ：<strong>此教程代码为硬件家园开发板STM32ZET6，我用的开发板是江科大教程的面包板加stm32c8t6。参考代码，请注意板子引脚</strong></p>
<h3 id="STM32CubeMx"><a href="#STM32CubeMx" class="headerlink" title="STM32CubeMx"></a>STM32CubeMx</h3><p>软件下载直接去官网下载就行</p>
<h4 id="安装软件包"><a href="#安装软件包" class="headerlink" title="安装软件包"></a>安装软件包</h4><p>安装芯片软件包，用那款芯片就安装哪个就行，不安装会无法生成代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919093400569.png" alt="image-20230919093400569"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919093427400.png" alt="image-20230919093427400"></p>
<h4 id="时钟配置问题"><a href="#时钟配置问题" class="headerlink" title="时钟配置问题"></a>时钟配置问题</h4><p>要先在这里选择外部时钟</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919092925360.png" alt="image-20230919092925360"></p>
<p>不选择的话，是用不了72Mhz的，只能使用64Mhz，时钟越大跑的越快，但是功耗也会更大，看自己需求配置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919093052210.png" alt="image-20230919093052210"></p>
<p>时钟失常恢复机制(CSS)，当系统选择HSE作系工作时钟，并打开了CSS功能后，当HSE由于外部原因而停震时，系统将自动切换到内部HSI运行，并产生NMI中断，于是可以在NMI中断中进行安全处理。在cubeMX中显示如下：</p>
<p>开启</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919095655175.png" alt="image-20230919095655175"></p>
<p>框图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919143519746.png" alt="image-20230919143519746"></p>
<h4 id="新建工程"><a href="#新建工程" class="headerlink" title="新建工程"></a>新建工程</h4><p>配置时钟</p>
<p>配置调试端口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919095214139.png" alt="image-20230919095214139"></p>
<p>配置GPIO口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919101826081.png" alt="image-20230919101826081"></p>
<p>生成代码文件。这里选择MDK，版本看自己的版本选择</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919102416979.png" alt="image-20230919102416979"></p>
<p>这样就可以了，点击右上角生成代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919102626653.png" alt="image-20230919102626653"></p>
<p>配置烧录程序方式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919103417077.png" alt="image-20230919103417077"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919103434895.png" alt="image-20230919103434895"></p>
<p>下载进去，低电平点亮LED</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230919105532775.png" alt="image-20230919105532775"></p>
<h4 id="代码区域"><a href="#代码区域" class="headerlink" title="代码区域"></a>代码区域</h4><p>自己编写的代码注意写在区域里，不然重新生成 CubeMX 会没了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230626162723140.png" alt="image-20230626162723140"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230626162754993.png" alt="image-20230626162754993"></p>
<h3 id="全新的程序框架"><a href="#全新的程序框架" class="headerlink" title="全新的程序框架"></a>全新的程序框架</h3><h4 id="程序框架的构想"><a href="#程序框架的构想" class="headerlink" title="程序框架的构想"></a>程序框架的构想</h4><p>1、STM32cubeMX生成的代码与添加的应用代码分离；</p>
<p>2、利用STM32cubeMX重新生成代码，不影响应用代码；</p>
<p>3、应用代码的添加，移除与修改，不影响cube生成的代码；</p>
<p>4、代码架构方便阅读，编辑，修改与移植；</p>
<p>5、代码架构标准化，可以很方便的应用到产品开发中。</p>
<h4 id="程序框架的实现"><a href="#程序框架的实现" class="headerlink" title="程序框架的实现"></a>程序框架的实现</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230920144428234.png" alt="image-20230920144428234"></p>
<p>1、新增MyApplication文件夹，放置4个标准c文件，分别是公共文件，回调文件，系统文件，用户初始化文件，后续应用代码均放在此文件夹；</p>
<p>2、新增MyApplication.h文件，包含所有用户代码的头文件与外设头文件，调整外设或用户文件，只需要调整此文件内的相应头文件即可；</p>
<p>3、main.c文件标准化。</p>
<h4 id="MyApplication-h"><a href="#MyApplication-h" class="headerlink" title="MyApplication.h"></a>MyApplication.h</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230920144610053.png" alt="image-20230920144610053"></p>
<p> 1、此文件放置于main.c与应用代码文件中，作为头文件的集合；</p>
<p> 2、更改处理器外设或应用代码，此文件需要相应的增加或删除相应的头文件。</p>
<h4 id="main-c文件"><a href="#main-c文件" class="headerlink" title="main.c文件"></a>main.c文件</h4><p>添加头文件集合</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdkc4BtBKDv5ibauMqSyXOzlHf1YKX9XtprczWZFaYH8VzaeMQKtvnliaQ6bmQvwRfic0N6eUlZaWD5w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、添加用户初始化函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdkc4BtBKDv5ibauMqSyXOzlvVuEop3ANQgmg2LM0uos0Fgw9Ng00lvVjR34GZak0XnIz4NdT89Gnw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>3、标准化主循环</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdkc4BtBKDv5ibauMqSyXOzlmIu67vZgpcO5V5N0U0aic0TGPMXzXXjNjro3hxGWRJZ3paHSjr1YgdQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、标准化错误处理函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdkc4BtBKDv5ibauMqSyXOzlZ7ntF5WO5jywzDY0zTFicIzuRT0NcVvXNSBd9Rg1ibUz2zO28c3pCgHg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、标准化断言失败处理函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdkc4BtBKDv5ibauMqSyXOzlhd19ib4lXPQbKV5P3AbTg6C0zY5ibkHvJsSmrFhHaUAg4Wpiaicy35ZKeA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="system文件"><a href="#system文件" class="headerlink" title="system文件"></a>system文件</h4><p>1、头文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdkc4BtBKDv5ibauMqSyXOzlic3Rtott5bnzn90oCM8a9P9Ds6kWqC2ar0VDQWKuH4PVnXOOr0ia3W7w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>主要定义结构体类型System_t，包含3个函数指针，分别为函数运行，系统错误处理，断言失败处理，被main.c文件调用。</p>
<p>2、源文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdkc4BtBKDv5ibauMqSyXOzlia0X7Gb2xCO3ficicwgic0NQ71hTR11HCn1NgGCMqYS8JcHZjiaWzcE7qAQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>主要定义结构体System以及3个函数，并将3个函数的名称(首地址)赋值给System结构体，完成结构体的初始化。 如此一来，main.c文件可以通过System结构体的函数指针调用System.c文件的3个函数了。</p>
<p>Run函数：用户应用代码；</p>
<p>Error_Hander函数：系统错误处理代码；</p>
<p>Asset_Failed函数： 断言失败处理代码。</p>
<h4 id="Run函数"><a href="#Run函数" class="headerlink" title="Run函数"></a>Run函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdkc4BtBKDv5ibauMqSyXOzl2QbzrYQGxSFFK1ib4ApMAKxReZW4lOWFygd4a19lf3TrkubaCnOHzQQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>作为功能演示，简单的实现了LED1间隔1s闪烁。</p>
<h3 id="HAL库函数"><a href="#HAL库函数" class="headerlink" title="HAL库函数"></a>HAL库函数</h3><h4 id="常用c函数"><a href="#常用c函数" class="headerlink" title="常用c函数"></a>常用c函数</h4><h5 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h5><p><code>volatile</code> 是一个在编程中使用的关键字，用于声明一个变量为“易变”的，指示编译器不要对该变量进行优化，强制在每次访问时都从内存中读取或写入该变量的值。</p>
<p>在多线程或嵌入式系统等特定环境下，使用 <code>volatile</code> 关键字可以确保对变量的读写操作是原子的，并且能够避免编译器对变量的优化，以防止出现意外的行为。</p>
<p>主要有两个方面需要注意：</p>
<ol>
<li>内存可见性：在多线程环境中，当一个线程修改了一个 <code>volatile</code> 变量的值时，其他线程可以立即看到这个修改，而不会使用缓存中的旧值。这保证了多线程之间对共享变量的正确读写。</li>
<li>编译器优化：编译器在进行代码优化时，可能会将读取同一个变量的多个操作合并，或者优化成常量。对于 <code>volatile</code> 变量，编译器会禁止这些优化，确保每次都从内存中读取或写入最新的值。</li>
</ol>
<p>需要注意的是，<code>volatile</code> 并不能保证对变量的操作是原子的，仅仅保证了内存的可见性和禁止了编译器的优化。如果需要原子操作，请使用适当的同步机制，如互斥锁或原子操作。</p>
<p>以下是 C 语言中使用 <code>volatile</code> 的示例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="type">int</span> flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在一个线程中修改 flag 的值</span></span><br><span class="line">flag = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在另一个线程中读取 flag 的值</span></span><br><span class="line"><span class="type">int</span> value = flag;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在上述示例中，使用了 <code>volatile</code> 关键字来确保 <code>flag</code> 变量的可见性，从而保证了两个线程对 <code>flag</code> 的正确读写。</p>
<h5 id="weak"><a href="#weak" class="headerlink" title="_weak"></a>_weak</h5><p><strong>weak是一个用于声明弱符号（weak symbol）的关键字。在C语言中，可以使用</strong>weak来声明一个可选的、弱引用的函数或变量。<br>当你定义一个函数或变量时，如果该函数或变量被声明为<strong>weak，那么它将成为一个弱符号。弱符号表示这个符号的默认定义是弱的，可以被其他相同符号的强定义所替代。如果存在多个定义相同的弱符号，链接器会选择其中一个作为最终符号的实际定义。<br>使用</strong>weak关键字的一个常见场景是在编写嵌入式系统的驱动程序时。例如，某个外设驱动程序可能提供一个默认的中断处理函数，但用户也可以根据自己的需求定义一个具有相同名称的函数来替代默认的中断处理函数。在这种情况下，可以将默认的中断处理函数声明为弱符号，使得用户定义的中断处理函数能够替代默认的中断处理函数。</p>
<h4 id="GPIO"><a href="#GPIO" class="headerlink" title="GPIO"></a>GPIO</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">void HAL_GPIO_TogglePin()</td>
<td style="text-align:center">GPIO_TypeDef *GPIOx,<br />uint16_t GPIO_Pin</td>
<td style="text-align:center">翻转（切换）指定 GPIO 引脚的电平状态</td>
</tr>
<tr>
<td style="text-align:center">void HAL_GPIO_WritePin()</td>
<td style="text-align:center">GPIO_TypeDef *GPIOx, <br />uint16_t GPIO_Pin, <br />GPIO_PinState PinState</td>
<td style="text-align:center">设置或清除选定的数据端口位<br />GPIO_PIN_RESET：清除端口引脚（低电平，0）<br />GPIO_PIN_SET：设置端口引脚（高电平，1）</td>
</tr>
<tr>
<td style="text-align:center">HAL_GPIO_ReadPin()</td>
<td style="text-align:center">GPIO_TypeDef *GPIOx,<br /> uint16_t GPIO_Pin</td>
<td style="text-align:center">读取指定输入端口引脚。</td>
</tr>
</tbody>
</table>
</div>
<h4 id="USART"><a href="#USART" class="headerlink" title="USART"></a>USART</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HAL_UART_Transmit()</td>
<td style="text-align:center">UART_HandleTypeDef *huart, \</td>
<td style="text-align:center"><br />const uint8_t *pData, <br />uint16_t Size, <br />uint32_t Timeout</td>
<td>异步（中断方式）发送串口数据</td>
</tr>
<tr>
<td style="text-align:center">HAL_UART_Receive()</td>
<td style="text-align:center">UART_HandleTypeDef <em>huart,<br /> uint8_t </em>pData, <br />uint16_t Size,<br /> uint32_t Timeout</td>
<td style="text-align:center">异步（中断方式）接收串口数据</td>
</tr>
<tr>
<td style="text-align:center">HAL_UART_Receive_IT()</td>
<td style="text-align:center">UART_HandleTypeDef <em>huart, <br />uint8_t </em>pData, <br />uint16_t Size</td>
<td style="text-align:center">在非阻塞模式下接收大量数据。</td>
</tr>
</tbody>
</table>
</div>
<h4 id="TIM"><a href="#TIM" class="headerlink" title="TIM"></a>TIM</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HAL_TIM_Base_Start_IT()</td>
<td style="text-align:center">TIM_HandleTypeDef *htim</td>
<td style="text-align:center">启动定时器基本模式中断</td>
</tr>
<tr>
<td style="text-align:center">HAL_TIM_Base_Stop_IT()</td>
<td style="text-align:center">TIM_HandleTypeDef *htim</td>
<td style="text-align:center">关闭定时器基本模式中断</td>
</tr>
<tr>
<td style="text-align:center">HAL_TIM_PeriodElapsedCallback()</td>
<td style="text-align:center">TIM_HandleTypeDef *htim</td>
<td style="text-align:center">定时器中断回调函数</td>
</tr>
<tr>
<td style="text-align:center">HAL_StatusTypeDef HAL_TIM_Encoder_Start()</td>
<td style="text-align:center">TIM_HandleTypeDef *htim, <br />uint32_t Channel</td>
<td style="text-align:center">启动定时器的编码器模式</td>
</tr>
<tr>
<td style="text-align:center">__HAL_TIM_GET_COUNTER()</td>
<td style="text-align:center">HANDLE</td>
<td style="text-align:center">定时器计数器获取当前计数值</td>
</tr>
<tr>
<td style="text-align:center">__HAL_TIM_SET_COUNTER()</td>
<td style="text-align:center">HANDLE<strong>, </strong><br />COUNTER</td>
<td style="text-align:center">设置定时器计数器值</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="EXTI"><a href="#EXTI" class="headerlink" title="EXTI"></a>EXTI</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">__weak void HAL_GPIO_EXTI_Callback()</td>
<td style="text-align:center">uint16_t GPIO_Pin</td>
<td style="text-align:center">外部中断回调函数，检测引脚状态</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="NVIC"><a href="#NVIC" class="headerlink" title="NVIC"></a>NVIC</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">void HAL_NVIC_DisableIRQ()</td>
<td style="text-align:center">IRQn_Type IRQn</td>
<td style="text-align:center">禁用 NVIC 中断控制器中的设备特定中断。</td>
</tr>
<tr>
<td style="text-align:center">void HAL_NVIC_EnableIRQ()</td>
<td style="text-align:center">IRQn_Type IRQn</td>
<td style="text-align:center">启用 NVIC 中断控制器中的设备特定中断。</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="ADC"><a href="#ADC" class="headerlink" title="ADC"></a>ADC</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HAL_ADC_Start()</td>
<td style="text-align:center">ADC_HandleTypeDef* hadc</td>
<td style="text-align:center">启用 ADC，开始常规组的转换</td>
</tr>
<tr>
<td style="text-align:center">HAL_ADC_PollForConversion()</td>
<td style="text-align:center">ADC_HandleTypeDef* hadc, <br />uint32_t Timeout</td>
<td style="text-align:center">等待常规组转换完成。</td>
</tr>
<tr>
<td style="text-align:center">uint32_t HAL_ADC_GetValue()</td>
<td style="text-align:center">ADC_HandleTypeDef* hadc</td>
<td style="text-align:center">获取ADC常规组转换结果</td>
</tr>
<tr>
<td style="text-align:center">HAL_ADC_PollForConversion()</td>
<td style="text-align:center">ADC_HandleTypeDef* hadc, <br />uint32_t Timeout</td>
<td style="text-align:center">轮询地等待ADC转换完成并返回转换结果</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="DAC"><a href="#DAC" class="headerlink" title="DAC"></a>DAC</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="PWM"><a href="#PWM" class="headerlink" title="PWM"></a>PWM</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HAL_TIM_PWM_Start()</td>
<td style="text-align:center">TIM_HandleTypeDef *htim, <br />uint32_t Channel</td>
<td style="text-align:center">开启PWM</td>
</tr>
<tr>
<td style="text-align:center">HAL_TIM_PWM_Stop()</td>
<td style="text-align:center">TIM_HandleTypeDef *htim, <br />uint32_t Channel</td>
<td style="text-align:center">关闭PWM</td>
</tr>
<tr>
<td style="text-align:center">__HAL_TIM_SET_COMPARE()</td>
<td style="text-align:center">HANDLE<strong>, </strong><br />CHANNEL<strong>,<br /> </strong>COMPARE</td>
<td style="text-align:center">修改PWM占空比的值</td>
</tr>
</tbody>
</table>
</div>
<h4 id="RTC"><a href="#RTC" class="headerlink" title="RTC"></a>RTC</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">uint32_t HAL_RTCEx_BKUPRead()</td>
<td style="text-align:center">RTC_HandleTypeDef *hrtc, <br />uint32_t BackupRegister</td>
<td style="text-align:center">从指定的 RTC 备份数据寄存器读取数据。</td>
</tr>
<tr>
<td style="text-align:center">void HAL_RTCEx_BKUPWrite()</td>
<td style="text-align:center">RTC_HandleTypeDef *hrtc, <br />uint32_t BackupRegister, <br />uint32_t Data</td>
<td style="text-align:center">在指定的 RTC 备份数据寄存器中写入数据。</td>
</tr>
<tr>
<td style="text-align:center">HAL_RTC_SetDate()</td>
<td style="text-align:center">RTC_HandleTypeDef <em>hrtc,<br />RTC_DateTypeDef </em>sDate,<br /> uint32_t Format</td>
<td style="text-align:center">设置 RTC 当前日期。</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="IWDG"><a href="#IWDG" class="headerlink" title="IWDG"></a>IWDG</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HAL_IWDG_Refresh()</td>
<td style="text-align:center">IWDG_HandleTypeDef *hiwdg</td>
<td style="text-align:center">刷新（喂狗）独立看门狗定时器</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="System"><a href="#System" class="headerlink" title="System"></a>System</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">__weak void HAL_SuspendTick()</td>
<td style="text-align:center">void</td>
<td style="text-align:center">暂停 Tick 增量,被调用时，SysTick 中断将被禁用</td>
</tr>
<tr>
<td style="text-align:center">__weak void HAL_ResumeTick()</td>
<td style="text-align:center">void</td>
<td style="text-align:center">恢复 Tick 增量,被调用时，SysTick 中断将被启用</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="PWR"><a href="#PWR" class="headerlink" title="PWR"></a>PWR</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">void HAL_PWR_EnterSLEEPMode()</td>
<td style="text-align:center">uint32_t Regulator, uint8_t SLEEPEntry</td>
<td style="text-align:center">进入睡眠模式</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HAL_SPI_Receive()</td>
<td style="text-align:center">SPI_HandleTypeDef <em>hspi, <br />uint8_t </em>pData, <br />uint16_t Size, <br />uint32_t Timeout</td>
<td style="text-align:center">通过SPI（串行外设接口）接收数据</td>
</tr>
<tr>
<td style="text-align:center">HAL_SPI_Transmit()</td>
<td style="text-align:center">SPI_HandleTypeDef <em>hspi, <br />uint8_t </em>pData,<br /> uint16_t Size, <br />uint32_t Timeout</td>
<td style="text-align:center">通过SPI（串行外设接口）发送数据</td>
</tr>
</tbody>
</table>
</div>
<h3 id="LED流水灯"><a href="#LED流水灯" class="headerlink" title="LED流水灯"></a>LED流水灯</h3><h4 id="普通编程"><a href="#普通编程" class="headerlink" title="普通编程"></a>普通编程</h4><p>硬件电路</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKrM8cGnSYXI4PA9Wicz36NaaHdYVb0ODy5l2YWichqfHIIIpXanEQdJ9Sg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：</p>
<p>灯亮 - GPIO输出高电平</p>
<p>灯灭 - GPIO输出低电平</p>
<p>技术讲解</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKrqPsvibwt1BBTkRS7VvqLbsoMXAysUicIGiaViaHmnjf30RXicNK6ccQddrw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKrGEaibtDMcEZqUgG8AEn9JGgx65vf8AgWuyGxWyfTy6nChRfoHsn1y7Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：视频详细讲解各种模式以及应用情况。</p>
<p>HAL库函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKrwxicJkicDSuTQ09QDhvjmE8g54plc6kXliahibiavyH691qniaCHWsny7qtA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：视频详细讲解各个函数以及应用情况。</p>
<p>编程说明</p>
<p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKr5I3tUYRYICF6JeQypJKfUESH88G71sI6Ohx4tFtTvCSjgmRSr8iaOdw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：初始化3个LED灯为推挽输出，默认高电平，亮灯。</p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKrp6S4avsS09ic3zBKkfwd1w6GhiaQF2ZvQ8JDynGdaSSXUceF4mfEUBkw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKrUTn666s2Jo5S7yaVZCan97E4QfMDQvwiaR1V7ZDcXPat1Rg5qVvSfMw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>本次直接调用HAL库函数，后续的代码，全部采用结构体调用。</p>
<h4 id="状态机流水灯"><a href="#状态机流水灯" class="headerlink" title="状态机流水灯"></a>状态机流水灯</h4><p>技术讲解</p>
<p>1、模块化编程</p>
<p>面向对象是软件开发方法，是相对于面向过程来讲的。通过把数据与方法组织为一个整体来看待，从更高的层次来进行系统建模，更贴近事物的自然运行模式;</p>
<p>单片机C语言的面向对象编程，是利用结构体，将变量、指针、函数等进行封装，达到编程更加方便、程序可读性更好、方便移植等目的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230920154241296.png" alt="image-20230920154241296"></p>
<p>有限状态机</p>
<p>有限状态机是一种概念思想，把复杂的控制逻辑分解成有限个稳定状态，组成闭环系统，通过事件触发，让状态机按设定的顺序处理事务;</p>
<p>单片机C语言的状态机编程，是利用条件选择语句(switch — case)切换状态，通过函数内部指令改变状态机状态，让程序按设定的顺序执行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeCl745KgCu4npdBsGPydoJOyry9mWxGUBMkQBsGTxwiasCeZzsj5QMkT5nq5icKjgdxJbWEmmSYm4w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>状态机流水灯流程图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeCl745KgCu4npdBsGPydoJIQllMley5sNibiagwOcTtX4KX8DcITUC5QMVK2iahKwyPIlaXbuhBMM8g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>状态机流水灯代码实现</p>
<p>HAL库函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKrwxicJkicDSuTQ09QDhvjmE8g54plc6kXliahibiavyH691qniaCHWsny7qtA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>编程说明</p>
<p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKr5I3tUYRYICF6JeQypJKfUESH88G71sI6Ohx4tFtTvCSjgmRSr8iaOdw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：初始化3个LED灯为推挽输出，默认高电平，亮灯。</p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeCl745KgCu4npdBsGPydoJqNn7mPDMZbiaIyKos0bk28Sw7OOAVhk2DbnkvfTnStgVBBWKESvIjRA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeCl745KgCu4npdBsGPydoJWOJOs69IXe9Y1OkMhOV6tdVU597iak6Z71zYexWsGjZQFSJYRKoyppg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="回调函数流水灯"><a href="#回调函数流水灯" class="headerlink" title="回调函数流水灯"></a>回调函数流水灯</h4><p>技术讲解</p>
<p>1、回调函数</p>
<p>一般解释：</p>
<p>回调函数就是一个通过函数指针调用的函数。如果你把函数的地址传递给中间函数的形参，中间函数通过函数指针调用其所指向的函数时，我们就说这是回调函数。</p>
<p>通俗解释：</p>
<p>函数Fun1调用函数Fun2，同时将函数Fun3作为形参传递给Fun2,此时，Fun1为应用层函数，Fun2为中间层函数，Fun3为回调函数，回调函数是一种说法而已。</p>
<p>伪代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Fun1()</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  Fun2(Fun3);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>意义何在：</p>
<p>① 利于代码结构，将代码分为应用层，中间层，硬件驱动层，彼此独立，方便程序的编辑，阅读，修改与移植；</p>
<p>② 结构化编程时，结构体只需要定义中间函数，减小内存的开销。</p>
<p>为什么不在Fun2里面直接调用Fun3：</p>
<p>伪代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Fun1()</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  Fun2()</span><br><span class="line"></span><br><span class="line">  &#123;  </span><br><span class="line"></span><br><span class="line">	 Fun3_1();</span><br><span class="line"></span><br><span class="line">     Fun3_2();</span><br><span class="line"></span><br><span class="line">     ...... </span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过函数指针的好处是，Fun2与Fun3实现隔离，比如Fun3具有多个功能函数，增加或减少时，不需要修改Fun2的代码。</p>
<p>2、代码实现</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd7IsdeK8y3tnR5ShkrvK8eVeD2D2F6bbSicrEPoIHnziaMWjOPcqygZx4nX0kutDm3R1FKNaaiaXxMQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h文件>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd7IsdeK8y3tnR5ShkrvK8eeUnFxpflKicv1LTuGru64riaonco4uQGA21Ryb0eEG1fOf3e074GzZ0Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>&lt; 中间函数&gt;</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd7IsdeK8y3tnR5ShkrvK8eU1BmXAvc2fd0INYCkHiaegl9rrHzibDwyc3XfsaTb4VGtmtGwyCazQzw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>&lt;底层驱动函数&gt;</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd7IsdeK8y3tnR5ShkrvK8eEIqEGaIL22g45pmF0GfUQKddhMq9ffs7y5wQZ1mDsu9ST8NyCVLvFw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>&lt;应用层&gt;</p>
<p>HAL库函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKrwxicJkicDSuTQ09QDhvjmE8g54plc6kXliahibiavyH691qniaCHWsny7qtA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>编程说明</p>
<p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKr5I3tUYRYICF6JeQypJKfUESH88G71sI6Ohx4tFtTvCSjgmRSr8iaOdw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：初始化3个LED灯为推挽输出，默认高电平，亮灯。</p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeCl745KgCu4npdBsGPydoJqNn7mPDMZbiaIyKos0bk28Sw7OOAVhk2DbnkvfTnStgVBBWKESvIjRA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeCl745KgCu4npdBsGPydoJWOJOs69IXe9Y1OkMhOV6tdVU597iak6Z71zYexWsGjZQFSJYRKoyppg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序"><a href="#6-1的程序" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置"><a href="#工程配置" class="headerlink" title="工程配置"></a>工程配置</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230920210024535.png" alt="image-20230920210024535"></p>
<h5 id="硬件电路"><a href="#硬件电路" class="headerlink" title="硬件电路"></a>硬件电路</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230920203644796.png" alt="image-20230920203644796"></p>
<h5 id="软件代码"><a href="#软件代码" class="headerlink" title="软件代码"></a>软件代码</h5><h6 id="LED文件"><a href="#LED文件" class="headerlink" title="LED文件"></a>LED文件</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">LED_Fun</span><span class="params">(<span class="type">uint8_t</span>,<span class="type">void</span>(*Callback)(<span class="type">uint8_t</span>))</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">LED_t LED =</span><br><span class="line">&#123;</span><br><span class="line">    LED_Fun,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private function prototypes------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   LED_Fun</span></span><br><span class="line"><span class="comment">      * @brief  LED功能函数，中间虚拟函数</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @param  Num -&gt; 编号，Callback -&gt;回调函数指针</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">LED_Fun</span><span class="params">(<span class="type">uint8_t</span> LED_Num,<span class="type">void</span>(*Callback)(<span class="type">uint8_t</span>))</span></span><br><span class="line">&#123;</span><br><span class="line">    (*Callback)(LED_Num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   LED_ON</span></span><br><span class="line"><span class="comment">      * @brief  打开LED</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @param  Num -&gt; 编号</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LED_ON</span><span class="params">(<span class="type">uint8_t</span> LED_Num)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//条件选择语句</span></span><br><span class="line">    <span class="keyword">switch</span> (LED_Num)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> LED1:HAL_GPIO_WritePin(LED1_GPIO_Port,LED1_Pin,GPIO_PIN_RESET); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED2:HAL_GPIO_WritePin(LED2_GPIO_Port,LED2_Pin,GPIO_PIN_RESET); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED3:HAL_GPIO_WritePin(LED3_GPIO_Port,LED3_Pin,GPIO_PIN_RESET); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED4:HAL_GPIO_WritePin(LED4_GPIO_Port,LED4_Pin,GPIO_PIN_RESET); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED5:HAL_GPIO_WritePin(LED5_GPIO_Port,LED5_Pin,GPIO_PIN_RESET); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: System.Assert_Failed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   LED_OFF</span></span><br><span class="line"><span class="comment">      * @brief  关闭LED</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @param  Num -&gt; 编号</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LED_OFF</span><span class="params">(<span class="type">uint8_t</span> LED_Num)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//条件选择语句</span></span><br><span class="line">    <span class="keyword">switch</span> (LED_Num)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> LED1:HAL_GPIO_WritePin(LED1_GPIO_Port,LED1_Pin,GPIO_PIN_SET); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED2:HAL_GPIO_WritePin(LED2_GPIO_Port,LED2_Pin,GPIO_PIN_SET); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED3:HAL_GPIO_WritePin(LED3_GPIO_Port,LED3_Pin,GPIO_PIN_SET); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED4:HAL_GPIO_WritePin(LED4_GPIO_Port,LED4_Pin,GPIO_PIN_SET); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED5:HAL_GPIO_WritePin(LED5_GPIO_Port,LED5_Pin,GPIO_PIN_SET); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: System.Assert_Failed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   LED_Flip</span></span><br><span class="line"><span class="comment">      * @brief  取反LED</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @param  Num -&gt; 编号</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LED_Flip</span><span class="params">(<span class="type">uint8_t</span> LED_Num)</span></span><br><span class="line">&#123; <span class="comment">//条件选择语句</span></span><br><span class="line">    <span class="keyword">switch</span> (LED_Num)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> LED1:HAL_GPIO_TogglePin(LED1_GPIO_Port,LED1_Pin); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED2:HAL_GPIO_TogglePin(LED2_GPIO_Port,LED2_Pin); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED3:HAL_GPIO_TogglePin(LED3_GPIO_Port,LED3_Pin); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED4:HAL_GPIO_TogglePin(LED4_GPIO_Port,LED4_Pin); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LED5:HAL_GPIO_TogglePin(LED5_GPIO_Port,LED5_Pin); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: System.Assert_Failed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LED_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LED_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义枚举类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    LED1 = (<span class="type">uint8_t</span>)<span class="number">0x01</span>,</span><br><span class="line">    LED2 = (<span class="type">uint8_t</span>)<span class="number">0x02</span>,</span><br><span class="line">    LED3 = (<span class="type">uint8_t</span>)<span class="number">0x03</span>,</span><br><span class="line">    LED4 = (<span class="type">uint8_t</span>)<span class="number">0x04</span>,</span><br><span class="line">    LED5 = (<span class="type">uint8_t</span>)<span class="number">0x05</span>,</span><br><span class="line">&#125;LED_Num_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">void</span> (*LED_Fun)(<span class="type">uint8_t</span>,<span class="type">void</span>(*Callback)(<span class="type">uint8_t</span>));</span><br><span class="line">&#125;LED_t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> LED_t LED;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern function prototypes-------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">LED_ON</span><span class="params">(<span class="type">uint8_t</span>)</span>; </span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">LED_OFF</span><span class="params">(<span class="type">uint8_t</span>)</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">LED_Flip</span><span class="params">(<span class="type">uint8_t</span>)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="状态机文件"><a href="#状态机文件" class="headerlink" title="状态机文件"></a>状态机文件</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Fun_STA1</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Fun_STA2</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Fun_STA3</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Fun_STA4</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Fun_STA5</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Fun_STA6</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Fun_STA7</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">STA_Machine_t STA_Machine = </span><br><span class="line">&#123;</span><br><span class="line">    STA1,</span><br><span class="line"></span><br><span class="line">    Fun_STA1,</span><br><span class="line">    Fun_STA2,</span><br><span class="line">    Fun_STA3,</span><br><span class="line">    Fun_STA4,</span><br><span class="line">    Fun_STA5,</span><br><span class="line">    Fun_STA6,</span><br><span class="line">    Fun_STA7</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* function prototypes--------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   Fun_STA 1 - 7</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  状态函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Fun_STA1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);    <span class="comment">//延时500ms</span></span><br><span class="line">    LED.LED_Fun(LED1,LED_OFF);  <span class="comment">//LED1灭灯</span></span><br><span class="line">    LED.LED_Fun(LED2,LED_OFF);  <span class="comment">//LED2灭灯</span></span><br><span class="line">    LED.LED_Fun(LED3,LED_OFF);  <span class="comment">//LED3灭灯</span></span><br><span class="line">    LED.LED_Fun(LED4,LED_OFF);  <span class="comment">//LED4灭灯</span></span><br><span class="line">    LED.LED_Fun(LED5,LED_OFF);  <span class="comment">//LED5灭灯</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//状态机切换至状态2</span></span><br><span class="line">    STA_Machine.ucSTA_Machine_Status = STA2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Fun_STA2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);  <span class="comment">//延时500ms</span></span><br><span class="line">    LED.LED_Fun(LED1,LED_ON);  <span class="comment">//LED1亮灯</span></span><br><span class="line">    LED.LED_Fun(LED2,LED_OFF); <span class="comment">//LED2灭灯</span></span><br><span class="line">    LED.LED_Fun(LED3,LED_OFF); <span class="comment">//LED3灭灯</span></span><br><span class="line">    LED.LED_Fun(LED4,LED_OFF); <span class="comment">//LED4灭灯</span></span><br><span class="line">    LED.LED_Fun(LED5,LED_OFF); <span class="comment">//LED5灭灯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//状态机切换至状态3</span></span><br><span class="line">    STA_Machine.ucSTA_Machine_Status = STA3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Fun_STA3</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);</span><br><span class="line">    LED.LED_Fun(LED1,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED2,LED_ON);</span><br><span class="line">    LED.LED_Fun(LED3,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED4,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED5,LED_OFF);</span><br><span class="line"></span><br><span class="line">    STA_Machine.ucSTA_Machine_Status = STA4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Fun_STA4</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);</span><br><span class="line">    LED.LED_Fun(LED1,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED2,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED3,LED_ON);</span><br><span class="line">    LED.LED_Fun(LED4,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED5,LED_OFF);</span><br><span class="line"></span><br><span class="line">    STA_Machine.ucSTA_Machine_Status = STA5;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Fun_STA5</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);</span><br><span class="line">    LED.LED_Fun(LED1,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED2,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED3,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED4,LED_ON);</span><br><span class="line">    LED.LED_Fun(LED5,LED_OFF);</span><br><span class="line"></span><br><span class="line">    STA_Machine.ucSTA_Machine_Status = STA6;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Fun_STA6</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);</span><br><span class="line">    LED.LED_Fun(LED1,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED2,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED3,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED4,LED_OFF);</span><br><span class="line">    LED.LED_Fun(LED5,LED_ON);</span><br><span class="line"></span><br><span class="line">    STA_Machine.ucSTA_Machine_Status = STA7;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Fun_STA7</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HAL_Delay(<span class="number">500</span>);</span><br><span class="line">    LED.LED_Fun(LED1,LED_ON);</span><br><span class="line">    LED.LED_Fun(LED2,LED_ON);</span><br><span class="line">    LED.LED_Fun(LED3,LED_ON);</span><br><span class="line">    LED.LED_Fun(LED4,LED_ON);</span><br><span class="line">    LED.LED_Fun(LED5,LED_ON);</span><br><span class="line"></span><br><span class="line">    STA_Machine.ucSTA_Machine_Status = STA1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __STA_MACHINE_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __STA_MACHINE_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//枚举类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    STA1 = (<span class="type">uint8_t</span>)<span class="number">0x01</span>,</span><br><span class="line">    STA2 = (<span class="type">uint8_t</span>)<span class="number">0x02</span>,</span><br><span class="line">    STA3 = (<span class="type">uint8_t</span>)<span class="number">0x03</span>,</span><br><span class="line">    STA4 = (<span class="type">uint8_t</span>)<span class="number">0x04</span>,</span><br><span class="line">    STA5 = (<span class="type">uint8_t</span>)<span class="number">0x05</span>,</span><br><span class="line">    STA6 = (<span class="type">uint8_t</span>)<span class="number">0x06</span>,</span><br><span class="line">    STA7 = (<span class="type">uint8_t</span>)<span class="number">0x07</span>,</span><br><span class="line"></span><br><span class="line">&#125; STA_Machine_Status_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    STA_Machine_Status_t ucSTA_Machine_Status;  <span class="comment">//状态机状态</span></span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> (*Fun_STA1)(<span class="type">void</span>);</span><br><span class="line">    <span class="type">void</span> (*Fun_STA2)(<span class="type">void</span>);</span><br><span class="line">    <span class="type">void</span> (*Fun_STA3)(<span class="type">void</span>);</span><br><span class="line">    <span class="type">void</span> (*Fun_STA4)(<span class="type">void</span>);</span><br><span class="line">    <span class="type">void</span> (*Fun_STA5)(<span class="type">void</span>);</span><br><span class="line">    <span class="type">void</span> (*Fun_STA6)(<span class="type">void</span>);</span><br><span class="line">    <span class="type">void</span> (*Fun_STA7)(<span class="type">void</span>);</span><br><span class="line"></span><br><span class="line">&#125; STA_Machine_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> STA_Machine_t STA_Machine;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern function prototypes-------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="主函数"><a href="#主函数" class="headerlink" title="主函数"></a>主函数</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">static void Run()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	switch(STA_Machine.ucSTA_Machine_Status)</span><br><span class="line">	&#123;</span><br><span class="line">		case STA1: STA_Machine.Fun_STA1(); break;</span><br><span class="line">		case STA2: STA_Machine.Fun_STA2(); break;</span><br><span class="line">		case STA3: STA_Machine.Fun_STA3(); break;</span><br><span class="line">		case STA4: STA_Machine.Fun_STA4(); break;</span><br><span class="line">		case STA5: STA_Machine.Fun_STA5(); break;</span><br><span class="line">		case STA6: STA_Machine.Fun_STA6(); break;</span><br><span class="line">		case STA7: STA_Machine.Fun_STA7(); break;</span><br><span class="line">		default:STA_Machine.ucSTA_Machine_Status = STA1;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>主要是框架，流水灯怎么写都可以，注意引脚，注意在面包板上LED正负极别插反。</p>
<h3 id="串口打印"><a href="#串口打印" class="headerlink" title="串口打印"></a>串口打印</h3><p>只是先简单学习一下打印，让程序运行效果能够更好的理解，实现人机交互，有很多方法可以实现，不过我还是喜欢用OLED屏看效果</p>
<h4 id="程序功能"><a href="#程序功能" class="headerlink" title="程序功能"></a>程序功能</h4><p>实现串口打印功能，实现现象如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZczMcoiaxaQ1mXdibfMTGA8kVUxzqzsiaGc4K62eJnz4ORre2L3XrTSXKtNHqDUWuWjEAMJVbgicnBsDg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-1"><a href="#硬件电路-1" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZczMcoiaxaQ1mXdibfMTGA8kVgVhV8T6icpcBMcuKrS4lIpKvvUu3adr1KeXPVZbO687aaW8CssOne3g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：</p>
<p>集成TTL转USB驱动，插入MicroUSB线即可。</p>
<h4 id="技术讲解"><a href="#技术讲解" class="headerlink" title="技术讲解"></a>技术讲解</h4><p> <strong>1、定义</strong></p>
<p>UART是一种通用串行数据总线，用于==异步通信==。该总线双向通信，可以实现==全双工传输==和接收。</p>
<p>在单片机产品设计中，UART主要用于设备与设备之间的通讯，设备与传感器之间的通信。例如通过RS-485接口，构成工业设备系统总线。</p>
<p><strong>2、协议</strong></p>
<p>UART作为异步串口通信协议的一种，工作原理是将传输数据的每个字符一位接一位地传输。</p>
<p>其中各位的意义如下:</p>
<p><strong>==起始位==</strong>:先发出一个逻辑”0”的信号，表示传输字符的开始。</p>
<p><strong>==数据位==</strong>:紧接着起始位之后。数据位的个数可以是4、5、6、7、8等，构成一个字符，从最低位开始传送。</p>
<p>==<strong>奇偶校验位</strong>==:数据位加上这一位后，使得”1”的位数应为偶数(偶校验)或奇数(奇校验)，以此来校验资料传送的正确性。</p>
<p><strong>==停止位==</strong>:它是一个字符数据的结束标志。可以是1位、1.5位、2位的高电平。由于数据是在传输线上定时的，并且每一个设备有其自己的时钟，很可能在通信中两台设备间出现了小小的不同步。因此停止位不仅仅是表示传输的结束，并且提供计算机校正时钟同步的机会。适用于停止位的位数越多，不同时钟同步的容忍程度越大，但是数据传输率同时也越慢。</p>
<p><strong>==空闲位==</strong>:处于逻辑”1”状态，表示当前线路上没有资料传送。</p>
<p>==<strong>波特率</strong>==:衡量数据传送速率的指标。表示每秒钟传送的比特位。</p>
<p>3、STM32的UART框图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZczMcoiaxaQ1mXdibfMTGA8kV6GszXHvFTJGSUyjR7ia5uwaKWmjUBFh5vnDHu3nZXPMpIKBsHe0j0Gg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="编程说明"><a href="#编程说明" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZczMcoiaxaQ1mXdibfMTGA8kVfUWa6SYRO1SGEa329iclcnLRPKfehsmPnpNHAy38nRZBzYJN8t2icE9g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：主要设置波特率，数据长度，校验位，停止位，数据方向等。</p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZczMcoiaxaQ1mXdibfMTGA8kVceEYhMMbkx3346Aotxg0ic8PR0iauVYia5jylFSxxKqp9PhVnrIQmnT1Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZczMcoiaxaQ1mXdibfMTGA8kVjUWEPjmvDDBn09a52n4NyRrFZy6k3P24tCZiaLl0dLgys2pccFG3EcA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、fputc重映射函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZczMcoiaxaQ1mXdibfMTGA8kVcqqEXxzQBlbxt6xK3QVTes5d8ttxbZJ4pqrkOp5loAF9ysoYpTyapw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-1"><a href="#6-1的程序-1" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置-1"><a href="#工程配置-1" class="headerlink" title="工程配置"></a>工程配置</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230921133147376.png" alt="image-20230921133147376"></p>
<p>一定要勾选Use MicroLIB，不然程序跑不起来</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230921151625203.png" alt="image-20230921151625203"></p>
<h5 id="硬件电路-2"><a href="#硬件电路-2" class="headerlink" title="硬件电路"></a>硬件电路</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230921154923848.png" alt="image-20230921154923848"></p>
<h5 id="软件代码-1"><a href="#软件代码-1" class="headerlink" title="软件代码"></a>软件代码</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Run</span></span><br><span class="line"><span class="comment">	* @brief  系统运行</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Run</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">uint16_t</span> STA_Cnt = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(STA_Machine.ucSTA_Machine_Status == STA1)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;状态机第%d次运行\r\n&quot;</span>,STA_Cnt++);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">switch</span>(STA_Machine.ucSTA_Machine_Status)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> STA1: STA_Machine.Fun_STA1(); <span class="built_in">printf</span>(<span class="string">&quot;状态机状态为STA1\r\n&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> STA2: STA_Machine.Fun_STA2(); <span class="built_in">printf</span>(<span class="string">&quot;状态机状态为STA2\r\n&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> STA3: STA_Machine.Fun_STA3(); <span class="built_in">printf</span>(<span class="string">&quot;状态机状态为STA3\r\n&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> STA4: STA_Machine.Fun_STA4(); <span class="built_in">printf</span>(<span class="string">&quot;状态机状态为STA4\r\n&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> STA5: STA_Machine.Fun_STA5(); <span class="built_in">printf</span>(<span class="string">&quot;状态机状态为STA5\r\n&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> STA6: STA_Machine.Fun_STA6(); <span class="built_in">printf</span>(<span class="string">&quot;状态机状态为STA6\r\n&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> STA7: STA_Machine.Fun_STA7(); <span class="built_in">printf</span>(<span class="string">&quot;状态机状态为STA7\r\n\r\n&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:STA_Machine.ucSTA_Machine_Status = STA1;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Peripheral_Set</span></span><br><span class="line"><span class="comment">	* @brief  外设设置</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Peripheral_Set</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;----此程序实现串口打印功能----\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Initialization completed, system startup!\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Software version is V%.1f\r\n\r\n&quot;</span>,SoftWare_Version);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;开始运行有限状态机:\r\n\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * @name   fputc</span></span><br><span class="line"><span class="comment">    * @param  ch -&gt; 待发送字符</span></span><br><span class="line"><span class="comment">    * @retval ch -&gt; 已发送字符      </span></span><br><span class="line"><span class="comment">    * @brief  fputc映射物理串口</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">fputc</span><span class="params">(<span class="type">int</span> ch,FILE *f)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//通过查询的方式循环发送</span></span><br><span class="line">  HAL_UART_Transmit(&amp;huart_debug, (<span class="type">uint8_t</span> *)&amp;ch, <span class="number">1</span>, <span class="number">0x000A</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public define-------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SoftWare_Version 	(float)1.0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>	huart_debug		huart1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>发送到串口中文乱码问题</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230921151725289.png" alt="image-20230921151725289"></p>
<p>把编码改成ANSI，直接另存为就能改</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230921152006816.png" alt="image-20230921152006816"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230921152108140.png" alt="image-20230921152108140"></p>
<h3 id="基本定时器"><a href="#基本定时器" class="headerlink" title="基本定时器"></a>基本定时器</h3><h4 id="程序功能-1"><a href="#程序功能-1" class="headerlink" title="程序功能"></a>程序功能</h4><p>通过基本定时器6，让3个LED灯间隔1s闪烁。</p>
<h4 id="技术讲解-1"><a href="#技术讲解-1" class="headerlink" title="技术讲解"></a>技术讲解</h4><p> 基本定时器框图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf2MxeupDjzgCEJAZTYytFaaxZIFESiaPgHD366RjTzCXFImOezY2H9B7ekEC034dWCkkZevNjqaUg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>NVIC</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf2MxeupDjzgCEJAZTYytFaVYwkFQTTK67MI0U5wy3QLafZtpLCKEp070WS8oNxpAFb30124y0VsA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf2MxeupDjzgCEJAZTYytFaiaiafnV9QicyOvhKFtlywQlYhukOXAjZkGib0eOSehcz6ckRGajFlDkViag/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf2MxeupDjzgCEJAZTYytFa3ibOVzeurQ3kseIE9vSkxP8YR2ib5siaS1EHxFCfxtuxocRZEGISI070g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>HAL库函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf2MxeupDjzgCEJAZTYytFaR8noiczib5bjezsaQ558ApR76HC6qwyA0gSFyvuWmRj40DOeGUv15Pag/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：视频详细讲解各个函数以及应用情况。</p>
<h4 id="编程说明-1"><a href="#编程说明-1" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf2MxeupDjzgCEJAZTYytFaseY4OQP5b5ISvuu1esvqNpuJ9jTxqIbO0Pj85zS3y9RMlEhPzHhGLg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：初始化基本定时器6，自动重载，5ms中断一次。</p>
<p>计算如下：</p>
<p>1、定时器时钟 = 72MHz</p>
<p>2、计算时钟 = 72MHz/(71+1) = 1MHz</p>
<p>3、定时周期 = （（1/1000000Hz）*5000）s = (5/1000)s = 5ms </p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdodUJQfL7aBBlGSjRY2wKrp6S4avsS09ic3zBKkfwd1w6GhiaQF2ZvQ8JDynGdaSSXUceF4mfEUBkw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf2MxeupDjzgCEJAZTYytFaYJCFl9QFRTv0Tc0ErWWudyTeuA6TO2SvtdeofbL79GxNGAYOAKIU4g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、定时器结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf2MxeupDjzgCEJAZTYytFaE52lbTEribm4eHTEMQtxDFHaYVZenqbYdBUsSreH9pRHwYRs6PzbMkw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、定时器回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf2MxeupDjzgCEJAZTYytFaN9Cia5XrNsmT8akTeQ85j0kPMwbdyr3qYNRp4yV1NQmmJ3DoAzpEa5g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-2"><a href="#6-1的程序-2" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置-2"><a href="#工程配置-2" class="headerlink" title="工程配置"></a>工程配置</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230921210129467.png" alt="image-20230921210129467"></p>
<h5 id="硬件电路-3"><a href="#硬件电路-3" class="headerlink" title="硬件电路"></a>硬件电路</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230921215213904.png" alt="image-20230921215213904"></p>
<h5 id="软件代码-2"><a href="#软件代码-2" class="headerlink" title="软件代码"></a>软件代码</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Timer2_Start_IT</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//定时器2以中断模式启动</span></span><br><span class="line"></span><br><span class="line">Timer2_t Timer2 =</span><br><span class="line">&#123;</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">    Timer2_Start_IT,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   Timer2_Start_IT</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  定时器2以中断模式启动</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Timer2_Start_IT</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    HAL_TIM_Base_Start_IT(&amp;htim2);  <span class="comment">//启动定时器2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TIMER2_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TIMER2_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//枚举类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	TIMER0_10ms  	= (<span class="type">uint16_t</span>)<span class="number">2</span>,</span><br><span class="line">	TIMER0_50ms  	= (<span class="type">uint16_t</span>)<span class="number">10</span>,</span><br><span class="line">	TIMER0_100ms	= (<span class="type">uint16_t</span>)<span class="number">20</span>,</span><br><span class="line">	TIMER0_200ms	= (<span class="type">uint16_t</span>)<span class="number">40</span>,</span><br><span class="line">	TIMER0_500ms	= (<span class="type">uint16_t</span>)<span class="number">100</span>,</span><br><span class="line">	TIMER0_1S       = (<span class="type">uint16_t</span>)<span class="number">200</span>,</span><br><span class="line">	TIMER0_2S       = (<span class="type">uint16_t</span>)<span class="number">400</span>,</span><br><span class="line">	TIMER0_3S       = (<span class="type">uint16_t</span>)<span class="number">600</span>,</span><br><span class="line">	TIMER0_5S       = (<span class="type">uint16_t</span>)<span class="number">1000</span>,</span><br><span class="line">	TIMER0_10S      = (<span class="type">uint16_t</span>)<span class="number">2000</span>,</span><br><span class="line">    TIMER0_30S      = (<span class="type">uint16_t</span>)<span class="number">6000</span>,</span><br><span class="line">	TIMER0_1min     = (<span class="type">uint16_t</span>)<span class="number">12000</span>,</span><br><span class="line">	TIMER0_3min     = (<span class="type">uint16_t</span>)<span class="number">36000</span>,</span><br><span class="line">&#125;TIMER0_Value_t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">uint16_t</span> <span class="keyword">volatile</span> usMCU_Run_Timer;  <span class="comment">//系统运行定时器</span></span><br><span class="line"></span><br><span class="line">    <span class="type">void</span>(*Timer2_Start_IT)(<span class="type">void</span>);  <span class="comment">//定时器2以中断模式启动</span></span><br><span class="line">&#125;Timer2_t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">extern</span> Timer2_t  Timer2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * @name   HAL_TIM_PeriodElapsedCallback</span></span><br><span class="line"><span class="comment">    * @param  *htim -&gt; 处理定时器的结构体指针</span></span><br><span class="line"><span class="comment">    * @retval None</span></span><br><span class="line"><span class="comment">    * @brief  定时器中断回调函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_PeriodElapsedCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (htim-&gt;Instance == htim2.Instance)</span><br><span class="line">  &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (++Timer2.usMCU_Run_Timer &gt;= TIMER0_1S)</span><br><span class="line">    &#123;</span><br><span class="line">      Timer2.usMCU_Run_Timer = <span class="number">0</span>;</span><br><span class="line">      LED.LED_Flip(LED1);</span><br><span class="line">      LED.LED_Flip(LED2);</span><br><span class="line">      LED.LED_Flip(LED3);</span><br><span class="line">      LED.LED_Flip(LED4);</span><br><span class="line">      LED.LED_Flip(LED5);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Peripheral_Set</span></span><br><span class="line"><span class="comment">	* @brief  外设设置</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Peripheral_Set</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	Timer6.Timer6_Start_IT(); <span class="comment">//启动定时器6</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h5><p>一定要开启我们自己的初始化函数。仔细的检查代码，因为不是一块板子，所以要认真点，不然烧进去没效果的时候真的很难搞。</p>
<h3 id="按键"><a href="#按键" class="headerlink" title="按键"></a>按键</h3><p>硬件家园的是触摸按键，我的是机械按键</p>
<h4 id="程序功能-2"><a href="#程序功能-2" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、触摸按键1单击与长按，控制LED1；</p>
<p>2、触摸按键2单击与长按，控制LED2;</p>
<p>3、触摸按键3单击与长按，控制LED3;</p>
<p>4、触摸按键4单击与长按，控制继电器;</p>
<h4 id="硬件电路-4"><a href="#硬件电路-4" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyI0f2j6jhUwmgRKIqwiceibUoFL67n1wGdjxQoJf1eyTjyt3nEkDu5xzeHj9fLovcBKesk5Acz9hg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyI0f2j6jhUwmgRKIqwiceibJTToOvBVhcOac6CGTUgiaFAwdrLfoRVibTbMdqpbF2nDgsj2XkhtsStQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyI0f2j6jhUwmgRKIqwiceibjbmZCJzJMGpUblScukvNU5pHwVhNibHLm4xNCltE8XJpHFvM8X0GEMg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-2"><a href="#技术讲解-2" class="headerlink" title="技术讲解"></a>技术讲解</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyI0f2j6jhUwmgRKIqwiceibUpfqcX68dOpYzqGJ2dm3xLdFdrZ4cNQHhmBZnv1q6LPNtQhves2LkQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>框图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230921220509890.png" alt="image-20230921220509890"></p>
<p>HAL库函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyI0f2j6jhUwmgRKIqwiceibpbiarnpH7Jq85lI01ZUfoXwnc15snDukcRU8iaURmcMBrbgEDdmOdDhA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：视频详细讲解各个函数以及应用情况。</p>
<h4 id="编程说明-2"><a href="#编程说明-2" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyI0f2j6jhUwmgRKIqwiceibgbf9Kkh4rJgt3WYzaA62N7vgUaOMiaMibGtUia5HEtHPR94Y12Rbr5Qdw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyI0f2j6jhUwmgRKIqwiceibibd13EoY65kaU4q8A3F4fCibRmpYtLTMLAZ9XJs80j6yKoDH8d36l1Lg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyI0f2j6jhUwmgRKIqwiceibkzH9BSxncPl0bpEgnicpwegqjQm43vqpCETKtW9M9aGVhMKL0qMpfWw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、按键结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyI0f2j6jhUwmgRKIqwiceibF78WM3pxdW2ict6w0Ribrz4KehsvoOulYrWZNPCWs67pfyIVP8XK4hibw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、外部中断回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyI0f2j6jhUwmgRKIqwiceibPJl3zqdtxhRmX8oyVkYCvT3RqgTMibK39rAIqFlRAHibRuqLreX91Ckg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-3"><a href="#6-1的程序-3" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置-3"><a href="#工程配置-3" class="headerlink" title="工程配置"></a>工程配置</h5><p>一定 一定 一定 使能中断，设置上拉。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230922200056237.png" alt="image-20230922200056237"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230922200112088.png" alt="image-20230922200112088"></p>
<h5 id="硬件电路-5"><a href="#硬件电路-5" class="headerlink" title="硬件电路"></a>硬件电路</h5><p>怎么接都行，我这样接只是想试试能不能这样接，按键接一脚接负极就行，接正极没反应</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230922200606013.png" alt="image-20230922200606013"></p>
<h5 id="软件代码-3"><a href="#软件代码-3" class="headerlink" title="软件代码"></a>软件代码</h5><p>其他按键复制按键1改个名字跟引脚就行</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY1_Detect</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//机械按键1检测</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY2_Detect</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//机械按键2检测</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY3_Detect</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//机械按键3检测</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY4_Detect</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//机械按键4检测</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY5_Detect</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//机械按键5检测</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">//结构体类型定义</span></span><br><span class="line">KEY_t KEY1 = &#123;.KEY_Flag = FALSE,.Click = FALSE,.Press = FALSE,KEY1_Detect&#125;;</span><br><span class="line">KEY_t KEY2 = &#123;.KEY_Flag = FALSE,.Click = FALSE,.Press = FALSE,KEY2_Detect&#125;;</span><br><span class="line">KEY_t KEY3 = &#123;.KEY_Flag = FALSE,.Click = FALSE,.Press = FALSE,KEY3_Detect&#125;;</span><br><span class="line">KEY_t KEY4 = &#123;.KEY_Flag = FALSE,.Click = FALSE,.Press = FALSE,KEY4_Detect&#125;;</span><br><span class="line">KEY_t KEY5 = &#123;.KEY_Flag = FALSE,.Click = FALSE,.Press = FALSE,KEY5_Detect&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* function prototypes--------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   Key_waitReadPin</span></span><br><span class="line"><span class="comment">      * @param  GPIOx  </span></span><br><span class="line"><span class="comment">      *         GPIO_Pin  </span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  等待按键释放,超时则跳出循环</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Key_waitReadPin</span><span class="params">(GPIO_TypeDef* GPIOx, <span class="type">uint16_t</span> GPIO_Pin)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> Timeout;</span><br><span class="line">	Timeout = <span class="number">10000</span>;</span><br><span class="line">    <span class="keyword">while</span> (HAL_GPIO_ReadPin(GPIOx, GPIO_Pin) == GPIO_PIN_SET)</span><br><span class="line">    &#123;</span><br><span class="line">        Timeout --;</span><br><span class="line">		<span class="keyword">if</span> (Timeout == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   KEY1_Detect</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  机械按键1检测</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY1_Detect</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (KEY1.KEY_Flag == TRUE)</span><br><span class="line">    &#123;</span><br><span class="line">        KEY1.Click = FALSE;</span><br><span class="line">        KEY1.Press = TRUE;</span><br><span class="line">        <span class="comment">//消抖</span></span><br><span class="line">		HAL_Delay(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//按键长按检测</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//延时1秒</span></span><br><span class="line">            HAL_Delay(<span class="number">10</span>);</span><br><span class="line">            <span class="comment">//如果1s内，按键状态出现高电平，此时按键为单击，跳出循环</span></span><br><span class="line">            <span class="keyword">if</span>(HAL_GPIO_ReadPin( KEY1_GPIO_Port, KEY1_Pin) == GPIO_PIN_SET)</span><br><span class="line">            &#123;</span><br><span class="line">                KEY1.Click = TRUE;</span><br><span class="line">                KEY1.Press = FALSE;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(KEY1.Click == TRUE)</span><br><span class="line">        &#123;</span><br><span class="line">			</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;检测到按键1点击\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            LED.LED_Flip(LED1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(KEY1.Press == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;检测到按键1长按\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//等待按键释放,超时直接跳出循环</span></span><br><span class="line">			Key_waitReadPin( KEY1_GPIO_Port, KEY1_Pin);</span><br><span class="line"></span><br><span class="line">			<span class="comment">//按键1长按动作</span></span><br><span class="line">			LED.LED_Flip(LED1);</span><br><span class="line">			HAL_Delay(<span class="number">200</span>);</span><br><span class="line">			LED.LED_Flip(LED1);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//清除按键状态</span></span><br><span class="line">		KEY1.KEY_Flag = FALSE;</span><br><span class="line">		KEY1.Click = FALSE;</span><br><span class="line">		KEY1.Press = FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __KEY_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __KEY_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">uint8_t</span> <span class="keyword">volatile</span> KEY_Flag;  <span class="comment">//按键标志位</span></span><br><span class="line">    <span class="type">uint8_t</span> Click;  <span class="comment">//单击</span></span><br><span class="line">    <span class="type">uint8_t</span> Press;  <span class="comment">//长按</span></span><br><span class="line">    <span class="type">void</span> (*KEY_Deteck)(<span class="type">void</span>);  <span class="comment">//按键检测</span></span><br><span class="line">&#125; KEY_t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">extern</span> KEY_t KEY1;</span><br><span class="line"><span class="keyword">extern</span> KEY_t KEY2;</span><br><span class="line"><span class="keyword">extern</span> KEY_t KEY3;</span><br><span class="line"><span class="keyword">extern</span> KEY_t KEY4;</span><br><span class="line"><span class="keyword">extern</span> KEY_t KEY5;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern function prototypes-------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Peripheral_Set</span></span><br><span class="line"><span class="comment">	* @brief  外设设置</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Peripheral_Set</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;----此程序实现触摸按键单击与长按功能----\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Initialization completed, system startup!\r\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;等待触摸按键:\r\n\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * @name   </span></span><br><span class="line"><span class="comment">    * @param  </span></span><br><span class="line"><span class="comment">    * @retval </span></span><br><span class="line"><span class="comment">    * @brief  中断回调函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_EXTI_Callback</span><span class="params">(<span class="type">uint16_t</span> GPIO_Pin)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">switch</span>(GPIO_Pin)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> KEY1_Pin: KEY1.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY2_Pin: KEY2.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY3_Pin: KEY3.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY4_Pin: KEY4.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY5_Pin: KEY5.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:<span class="built_in">printf</span>(<span class="string">&quot;错误 - 外部中断回调函数中，触摸按键键值错误！\r\n\r\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Run</span></span><br><span class="line"><span class="comment">	* @brief  系统运行</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Run</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	KEY1.KEY_Deteck();</span><br><span class="line">	KEY2.KEY_Deteck();</span><br><span class="line">	KEY3.KEY_Deteck();</span><br><span class="line">	KEY4.KEY_Deteck();</span><br><span class="line">	KEY5.KEY_Deteck();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h4><p>使能中断，不使能中断程序没效果，串口有信息发出来，按键是没有效果的，</p>
<p>设置上拉电阻，不设置上拉串口那边会一直发按键按下，自己按按键没反应，LED一直变换状态。</p>
<p>按键一脚接串口，另一脚只能接负极，不然没反应。</p>
<p>不知道为什么这个延时没效果，慢慢学吧，可能后面就清楚了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">      * @name   Key_waitReadPin</span><br><span class="line">      * @param  GPIOx  </span><br><span class="line">      *         GPIO_Pin  </span><br><span class="line">      * @retval None</span><br><span class="line">      * @brief  等待按键释放,超时则跳出循环</span><br><span class="line">*/</span><br><span class="line">void Key_waitReadPin(GPIO_TypeDef* GPIOx, uint16_t GPIO_Pin)</span><br><span class="line">&#123;</span><br><span class="line">    uint32_t Timeout;</span><br><span class="line">	Timeout = 10000;</span><br><span class="line">    while (HAL_GPIO_ReadPin(GPIOx, GPIO_Pin) == GPIO_PIN_SET)</span><br><span class="line">    &#123;</span><br><span class="line">        Timeout --;</span><br><span class="line">		if (Timeout == 0)</span><br><span class="line">		&#123;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="蜂鸣器"><a href="#蜂鸣器" class="headerlink" title="蜂鸣器"></a>蜂鸣器</h3><h4 id="程序功能-3"><a href="#程序功能-3" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、上电后，无源蜂鸣器发出警报声；</p>
<p>2、通过触摸按键1打开或关闭蜂鸣器;</p>
<h4 id="硬件电路-6"><a href="#硬件电路-6" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230922201939771.png" alt="image-20230922201939771"></p>
<h4 id="技术讲解-3"><a href="#技术讲解-3" class="headerlink" title="技术讲解"></a>技术讲解</h4><p><strong>PWM</strong></p>
<p>英文全称，Pulse-Width Modulation，脉冲宽度调制。是利用微处理器的数字输出来对模拟电路进行控制的一种非常有效的技术。</p>
<p>PWM可用于驱动无源蜂鸣器，通过调整PWM的频率，可以改变蜂鸣器发出的声音，比如发出报警音，歌曲等。</p>
<p><strong>框图</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230922202109368.png" alt="image-20230922202109368"></p>
<p>HAL库函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZerVR0IFWtZtpjd6e31LSdFnxN3F6qkZaNQsXkNNAUNkvjxflibRmOzFJKOwU0ohD5ofqEKMxV06kA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：视频详细讲解各个函数以及应用情况。</p>
<h4 id="编程说明-3"><a href="#编程说明-3" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZerVR0IFWtZtpjd6e31LSdFsR7PxgYZpVg4dZwIFibiceZp7PAjKNkubZj0AlfricyGibCpcmpDiaNk3Cg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZerVR0IFWtZtpjd6e31LSdF4iaxmlyLYkBwS7kFMhZQMAWoNoGZbbaV7sHaBqPdTLtfj8sTjodThfQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZerVR0IFWtZtpjd6e31LSdFbaldMMtsqd7v1EaB8onoRfqHVY6QIXlCKfETveuicfTtPAc10FOibXRg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、蜂鸣器结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZerVR0IFWtZtpjd6e31LSdFyZb2HBKAXQcRwdZTl8R57c2rGJl6MYpCWH4dUaL02WCMubNOg36mYw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、定时器回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZerVR0IFWtZtpjd6e31LSdFFT5yNQ69OJ70S322UjBZLmLm7rrkI6gRcgE2R0rV5CRnO0pe5QfGnQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-4"><a href="#6-1的程序-4" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><p>没有无源蜂鸣器，想写呼吸灯奈何技术不行，只能后面再写。</p>
<h5 id="工程配置-4"><a href="#工程配置-4" class="headerlink" title="工程配置"></a>工程配置</h5><h5 id="硬件电路-7"><a href="#硬件电路-7" class="headerlink" title="硬件电路"></a>硬件电路</h5><h5 id="软件代码-4"><a href="#软件代码-4" class="headerlink" title="软件代码"></a>软件代码</h5><h3 id="高级定时器"><a href="#高级定时器" class="headerlink" title="高级定时器"></a>高级定时器</h3><h4 id="程序功能-4"><a href="#程序功能-4" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、上电后，输出带死区的互补PWM；</p>
<p>2、触摸按键1调节PWM占空比；</p>
<p>3、刹车引脚高电平触发。</p>
<p>硬件电路</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcRHHwSMzNDpG4j4Hq5qBccVzWG9hu5dicZEeusibKGzmJuTUtw7UVOWWiaCHQYUe5xXFpfetJJlqedA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-4"><a href="#技术讲解-4" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>  1<strong>、高级定时器</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcRHHwSMzNDpG4j4Hq5qBccOv0AM2BztIUlLv7XTIp9ficcpraP1bIeaPgC4cBtsbS8xpUibJej6hNg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><strong>2、框图</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcRHHwSMzNDpG4j4Hq5qBccI4c0BM2LcxEOVibBvZ6fB7uQdJzzviarJEM47PYbYyxaXnocCBc43o7A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>3、重复计数器</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcRHHwSMzNDpG4j4Hq5qBccjpiaYZiaKauF7DIPEkGkL61AWhu5Q7FxOPIBl6J0BO3UwVibcTo1oGAtw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>HAL库函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZerVR0IFWtZtpjd6e31LSdFnxN3F6qkZaNQsXkNNAUNkvjxflibRmOzFJKOwU0ohD5ofqEKMxV06kA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<stm32f1xx_hal_tim.h>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcRHHwSMzNDpG4j4Hq5qBccGTIxuzsiaB0kZO6rJjLicRia6CLjzaEl2p2QnEWGLdBAyL4ABWBNJNoTA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<stm32f1xx_hal_tim_ex.h>



<p>说明：视频详细讲解各个函数以及应用情况。</p>
<h4 id="编程说明-4"><a href="#编程说明-4" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcRHHwSMzNDpG4j4Hq5qBccNGciaXKTXqeRjycJ1BWwVMChUqHpANPl8GpN0yvvrV4QceVFpHL3Reg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcRHHwSMzNDpG4j4Hq5qBccPwUFFDBibDczAkEOojdI9BscYscbVricBbIcoBu6BENGO9UrIVOicR5xg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZerVR0IFWtZtpjd6e31LSdFbaldMMtsqd7v1EaB8onoRfqHVY6QIXlCKfETveuicfTtPAc10FOibXRg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、初始化代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcRHHwSMzNDpG4j4Hq5qBccQAHA0NibLzCYesVTqPEPDF0hU6ncddZxvcb2WlAVeEnn5HfoTeKT5uw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、外部中断回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcRHHwSMzNDpG4j4Hq5qBccLZru1eSaBNibp6TI4TUjAwb1ysOwhjWxdSzs2EC2ZcPJorBPS5YnIgw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-5"><a href="#6-1的程序-5" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><p>波形对不上，问题很大。</p>
<h3 id="NTC-ADC"><a href="#NTC-ADC" class="headerlink" title="NTC(ADC)"></a>NTC(ADC)</h3><h4 id="程序功能-5"><a href="#程序功能-5" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、上电后，数码管数码PCB板温度；</p>
<p>2、串口间隔1s打印温度信息。</p>
<h4 id="硬件电路-8"><a href="#硬件电路-8" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKrZbkGpkXhoVvDict1ZyvuBMZEcIHcVl4MnKSXIUgq1cUvCS69uCr0yA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-5"><a href="#技术讲解-5" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>1、ADC</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKq82wg6Hr3jGvGJO9XKyIp8NibAaic28vIe6micyhoJ01EpePRKE1iaIMFA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKjbJXRicJ1MbxoBn6Je4Yw08qaF2dONzWVUrM5bicsRNicnU5KrRia8dJxQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、自制的NTC的温度数据表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKqQGNKGdBY27glodAblUsJk4liaibDQc4FJRLLr31rClylexW5YJkSopg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKNXickpoZhN91of2yVW0B0e803phIWJaicR4n7SBcpJFMAoNaUxpb18bw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>HAL库函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKsUrtDMhrDaibCIdKYYQCPhljUuRc10kRBRbpx5RSl4mHsQ5y4uwIJaA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
 <stm32f1xx_hal_adc.h>



<h4 id="编程说明-5"><a href="#编程说明-5" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKxFjHaiaY4mIhcX0juVJFZNP94coEEf9VW0J2FuPbX0V7eyrV1WOx6cQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd9fsiacYEJNg9ZBSBlVQEPeGp4wVZkUgu6vRXibK1fJ1GrnxUSPFG8fr909ddsRNRjphssjIiaqE58w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKDXhKc4FPteAalDjDYP0wLYgBR5I888BB2N7hTCAW3HojqR6vOtfgHg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、NTC结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QK12pBIEdlUWzw4pYIGqNfibyM1nsiayxn16wdoSXClVxhibq94gv9h0lXg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、NTC相关函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKOTfrLmNUuzOusYM23qDCeSGiasBsNPSvfrU4Um9hgb4tVSRia0DZbCNA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKz7JkYMvHDMdLUxDZ1eeqpSeagmeUauWPgdpV84qaGjr5xOwlHUgBTA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-6"><a href="#6-1的程序-6" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置-5"><a href="#工程配置-5" class="headerlink" title="工程配置"></a>工程配置</h5><p>ADC时钟最高14，配高了会出错，所以我们配置12</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230924173744486.png" alt="image-20230924173744486"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230924174102068.png" alt="image-20230924174102068"></p>
<h5 id="硬件电路-9"><a href="#硬件电路-9" class="headerlink" title="硬件电路"></a>硬件电路</h5><p>在PA5加一个热敏电阻</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230925091344308.png" alt="image-20230925091344308"></p>
<h5 id="软件代码-5"><a href="#软件代码-5" class="headerlink" title="软件代码"></a>软件代码</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">  * @file    NTC</span></span><br><span class="line"><span class="comment">  * @author  6+1</span></span><br><span class="line"><span class="comment">  * @date    2023-09-25 09:15:13</span></span><br><span class="line"><span class="comment">  * @brief   存放热敏电阻函数文件</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">////优化后的温度表，将不在数据表中的数据放入临近的数组</span></span><br><span class="line"><span class="type">const</span> <span class="type">uint16_t</span>  NTC_Table[<span class="number">101</span>][<span class="number">2</span>] = </span><br><span class="line">&#123;</span><br><span class="line">	&#123;<span class="number">3850</span>,<span class="number">3867</span>&#125;,&#123;<span class="number">3837</span>,<span class="number">3854</span>&#125;,&#123;<span class="number">3822</span>,<span class="number">3840</span>&#125;,&#123;<span class="number">3807</span>,<span class="number">3826</span>&#125;,&#123;<span class="number">3791</span>,<span class="number">3810</span>&#125;,</span><br><span class="line">	&#123;<span class="number">3774</span>,<span class="number">3795</span>&#125;,&#123;<span class="number">3757</span>,<span class="number">3778</span>&#125;,&#123;<span class="number">3739</span>,<span class="number">3761</span>&#125;,&#123;<span class="number">3721</span>,<span class="number">3743</span>&#125;,&#123;<span class="number">3701</span>,<span class="number">3724</span>&#125;,</span><br><span class="line">	&#123;<span class="number">3681</span>,<span class="number">3704</span>&#125;,&#123;<span class="number">3660</span>,<span class="number">3684</span>&#125;,&#123;<span class="number">3638</span>,<span class="number">3663</span>&#125;,&#123;<span class="number">3616</span>,<span class="number">3641</span>&#125;,&#123;<span class="number">3592</span>,<span class="number">3618</span>&#125;,</span><br><span class="line">  &#123;<span class="number">3568</span>,<span class="number">3595</span>&#125;,&#123;<span class="number">3543</span>,<span class="number">3570</span>&#125;,&#123;<span class="number">3517</span>,<span class="number">3545</span>&#125;,&#123;<span class="number">3491</span>,<span class="number">3519</span>&#125;,&#123;<span class="number">3463</span>,<span class="number">3492</span>&#125;,</span><br><span class="line">	&#123;<span class="number">3435</span>,<span class="number">3464</span>&#125;,&#123;<span class="number">3405</span>,<span class="number">3435</span>&#125;,&#123;<span class="number">3375</span>,<span class="number">3405</span>&#125;,&#123;<span class="number">3344</span>,<span class="number">3375</span>&#125;,&#123;<span class="number">3312</span>,<span class="number">3343</span>&#125;,</span><br><span class="line">	&#123;<span class="number">3280</span>,<span class="number">3311</span>&#125;,&#123;<span class="number">3246</span>,<span class="number">3279</span>&#125;,&#123;<span class="number">3212</span>,<span class="number">3245</span>&#125;,&#123;<span class="number">3177</span>,<span class="number">3211</span>&#125;,&#123;<span class="number">3141</span>,<span class="number">3176</span>&#125;,</span><br><span class="line">	&#123;<span class="number">3105</span>,<span class="number">3140</span>&#125;,&#123;<span class="number">3067</span>,<span class="number">3104</span>&#125;,&#123;<span class="number">3029</span>,<span class="number">3066</span>&#125;,&#123;<span class="number">2991</span>,<span class="number">3028</span>&#125;,&#123;<span class="number">2951</span>,<span class="number">2990</span>&#125;,</span><br><span class="line">	&#123;<span class="number">2911</span>,<span class="number">2950</span>&#125;,&#123;<span class="number">2871</span>,<span class="number">2910</span>&#125;,&#123;<span class="number">2829</span>,<span class="number">2870</span>&#125;,&#123;<span class="number">2788</span>,<span class="number">2828</span>&#125;,&#123;<span class="number">2745</span>,<span class="number">2787</span>&#125;,</span><br><span class="line">  &#123;<span class="number">2705</span>,<span class="number">2744</span>&#125;,&#123;<span class="number">2660</span>,<span class="number">2704</span>&#125;,&#123;<span class="number">2616</span>,<span class="number">2659</span>&#125;,&#123;<span class="number">2572</span>,<span class="number">2615</span>&#125;,&#123;<span class="number">2528</span>,<span class="number">2571</span>&#125;,</span><br><span class="line">  &#123;<span class="number">2484</span>,<span class="number">2527</span>&#125;,&#123;<span class="number">2440</span>,<span class="number">2483</span>&#125;,&#123;<span class="number">2395</span>,<span class="number">2439</span>&#125;,&#123;<span class="number">2350</span>,<span class="number">2394</span>&#125;,&#123;<span class="number">2305</span>,<span class="number">2349</span>&#125;,</span><br><span class="line">	&#123;<span class="number">2260</span>,<span class="number">2304</span>&#125;,  <span class="comment">//对应20℃  --下标为50</span></span><br><span class="line">  &#123;<span class="number">2216</span>,<span class="number">2259</span>&#125;,&#123;<span class="number">2171</span>,<span class="number">2215</span>&#125;,&#123;<span class="number">2126</span>,<span class="number">2170</span>&#125;,&#123;<span class="number">2082</span>,<span class="number">2125</span>&#125;,&#123;<span class="number">2037</span>,<span class="number">2081</span>&#125;,</span><br><span class="line">  &#123;<span class="number">1992</span>,<span class="number">2036</span>&#125;,&#123;<span class="number">1947</span>,<span class="number">1991</span>&#125;,&#123;<span class="number">1903</span>,<span class="number">1946</span>&#125;,&#123;<span class="number">1859</span>,<span class="number">1902</span>&#125;,&#123;<span class="number">1815</span>,<span class="number">1858</span>&#125;,</span><br><span class="line">  &#123;<span class="number">1772</span>,<span class="number">1814</span>&#125;,&#123;<span class="number">1729</span>,<span class="number">1771</span>&#125;,&#123;<span class="number">1687</span>,<span class="number">1728</span>&#125;,&#123;<span class="number">1646</span>,<span class="number">1687</span>&#125;,&#123;<span class="number">1604</span>,<span class="number">1645</span>&#125;,</span><br><span class="line">  &#123;<span class="number">1564</span>,<span class="number">1603</span>&#125;,&#123;<span class="number">1524</span>,<span class="number">1563</span>&#125;,&#123;<span class="number">1484</span>,<span class="number">1523</span>&#125;,&#123;<span class="number">1446</span>,<span class="number">1483</span>&#125;,&#123;<span class="number">1408</span>,<span class="number">1445</span>&#125;,</span><br><span class="line">  &#123;<span class="number">1370</span>,<span class="number">1407</span>&#125;,&#123;<span class="number">1334</span>,<span class="number">1369</span>&#125;,&#123;<span class="number">1297</span>,<span class="number">1333</span>&#125;,&#123;<span class="number">1262</span>,<span class="number">1296</span>&#125;,&#123;<span class="number">1228</span>,<span class="number">1261</span>&#125;,</span><br><span class="line">  &#123;<span class="number">1194</span>,<span class="number">1227</span>&#125;,&#123;<span class="number">1161</span>,<span class="number">1193</span>&#125;,&#123;<span class="number">1128</span>,<span class="number">1160</span>&#125;,&#123;<span class="number">1096</span>,<span class="number">1129</span>&#125;,&#123;<span class="number">1062</span>,<span class="number">1095</span>&#125;,</span><br><span class="line">  &#123;<span class="number">1035</span>,<span class="number">1067</span>&#125;,&#123;<span class="number">1006</span>,<span class="number">1038</span>&#125;,&#123;<span class="number">977</span> ,<span class="number">1009</span>&#125;,&#123;<span class="number">949</span> , <span class="number">981</span>&#125;,&#123;<span class="number">921</span> , <span class="number">953</span>&#125;,</span><br><span class="line">  &#123;<span class="number">895</span> , <span class="number">926</span>&#125;,&#123;<span class="number">869</span> , <span class="number">900</span>&#125;,&#123;<span class="number">843</span> , <span class="number">875</span>&#125;,&#123;<span class="number">819</span> , <span class="number">850</span>&#125;,&#123;<span class="number">795</span> , <span class="number">826</span>&#125;,</span><br><span class="line">  &#123;<span class="number">771</span> , <span class="number">802</span>&#125;,&#123;<span class="number">749</span> , <span class="number">779</span>&#125;,&#123;<span class="number">727</span> , <span class="number">757</span>&#125;,&#123;<span class="number">705</span> , <span class="number">735</span>&#125;,&#123;<span class="number">684</span> , <span class="number">714</span>&#125;,</span><br><span class="line">  &#123;<span class="number">664</span> , <span class="number">694</span>&#125;,&#123;<span class="number">644</span> , <span class="number">674</span>&#125;,&#123;<span class="number">625</span> , <span class="number">654</span>&#125;,&#123;<span class="number">607</span> , <span class="number">636</span>&#125;,&#123;<span class="number">589</span> , <span class="number">617</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Get_NTC_Voltage</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//获取温度电压</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Get_Temperature_Value</span><span class="params">(<span class="type">void</span>)</span>; <span class="comment">//获取温度值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* function prototypes--------------------------------------------------------*/</span></span><br><span class="line">NTC_t NTC = </span><br><span class="line">&#123;</span><br><span class="line">    Get_NTC_Voltage,</span><br><span class="line">    .usADC_Value = <span class="number">0</span>,</span><br><span class="line">    .fNTC_Voltage = <span class="number">0.0</span>,</span><br><span class="line"></span><br><span class="line">    Get_Temperature_Value,</span><br><span class="line">    .fTemperature = <span class="number">0.0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Get_NTC_Voltage</span></span><br><span class="line"><span class="comment">	* @brief  获取温度电压</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None    </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Get_NTC_Voltage</span><span class="params">()</span> </span><br><span class="line">&#123;	</span><br><span class="line">	HAL_ADC_Start(&amp;hadc1);	</span><br><span class="line">	<span class="keyword">if</span>(HAL_ADC_PollForConversion(&amp;hadc1,<span class="number">10</span>) == HAL_OK)</span><br><span class="line">	&#123;</span><br><span class="line">		NTC.usADC_Value    = HAL_ADC_GetValue(&amp;hadc1);</span><br><span class="line">		NTC.fNTC_Voltage   = (NTC.usADC_Value*<span class="number">3.3</span>)/<span class="number">4095</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;AD转换原始值 = %d\r\n&quot;</span>,NTC.usADC_Value);</span><br><span class="line">	  <span class="built_in">printf</span>(<span class="string">&quot;计算得出的电压值 = %.2fV\r\n&quot;</span>,NTC.fNTC_Voltage);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;AD转换错误或超时!!!\r\n&quot;</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Get_Temperature_Value</span></span><br><span class="line"><span class="comment">	* @brief  获取温度值</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None    </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Get_Temperature_Value</span><span class="params">()</span> </span><br><span class="line">&#123;	</span><br><span class="line">	<span class="type">uint8_t</span> Temp;</span><br><span class="line">	</span><br><span class="line">	NTC.Get_NTC_Voltage(); <span class="comment">//获取ADC采集值与NTC电压</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">////临界温度处理</span></span><br><span class="line">	<span class="keyword">if</span>(NTC.usADC_Value &lt; <span class="number">589</span>) <span class="comment">//最高70℃</span></span><br><span class="line">	&#123;</span><br><span class="line">		NTC.usADC_Value = <span class="number">589</span>;</span><br><span class="line">		</span><br><span class="line">	  <span class="built_in">printf</span>(<span class="string">&quot;Temperature is higher than 70℃\r\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(NTC.usADC_Value &gt; <span class="number">3867</span>) <span class="comment">//最低-30℃</span></span><br><span class="line">	&#123;</span><br><span class="line">		NTC.usADC_Value = <span class="number">3867</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Temperature is below -30℃\r\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//二分法查表</span></span><br><span class="line">	<span class="keyword">if</span>(NTC.usADC_Value &gt; NTC_Table[<span class="number">50</span>][<span class="number">1</span>])</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//查询0 - 49  对应-30℃至19℃摄氏度</span></span><br><span class="line">		<span class="keyword">for</span>(Temp=<span class="number">0</span>;Temp&lt;=<span class="number">49</span>;Temp++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>((NTC.usADC_Value &gt;= NTC_Table[Temp][<span class="number">0</span>]) &amp;&amp; (NTC.usADC_Value &lt;= NTC_Table[Temp][<span class="number">1</span>]))</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(NTC.usADC_Value &lt; NTC_Table[<span class="number">50</span>][<span class="number">0</span>])</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//查询51 - 100  对应21℃至70℃摄氏度</span></span><br><span class="line">		<span class="keyword">for</span>(Temp=<span class="number">51</span>;Temp&lt;=<span class="number">100</span>;Temp++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>((NTC.usADC_Value &gt;= NTC_Table[Temp][<span class="number">0</span>]) &amp;&amp; (NTC.usADC_Value &lt;= NTC_Table[Temp][<span class="number">1</span>]))</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		Temp = <span class="number">50</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//计算温度</span></span><br><span class="line">	NTC.fTemperature = (<span class="type">float</span>)Temp - <span class="number">30</span>;	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Temperature is :%.1f℃\r\n\r\n&quot;</span>,NTC.fTemperature);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Peripheral_Set</span></span><br><span class="line"><span class="comment">	* @brief  外设设置</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Peripheral_Set</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;----此程序实现ADC功能,获取PCB板温度----\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Initialization completed, system startup!\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  Timer2.Timer2_Start_IT();  <span class="comment">//启动定时器2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Run</span></span><br><span class="line"><span class="comment">	* @brief  系统运行</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Run</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">		NTC.Get_Temperature_Value();</span><br><span class="line">		HAL_Delay(<span class="number">1000</span>); <span class="comment">//延时1s采集</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   Timer2_Start_IT</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  定时器2以中断模式启动</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Timer2_Start_IT</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">		HAL_TIM_Base_Start_IT(&amp;htim2);  <span class="comment">//启动定时器2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   HAL_TIM_PeriodElapsedCallback</span></span><br><span class="line"><span class="comment">	* @brief  定时器中断回调函数</span></span><br><span class="line"><span class="comment">	* @param  *htim -&gt; 处理定时器的结构体指针</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_PeriodElapsedCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(htim-&gt;Instance == htim2.Instance)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//程序支持运行，指示灯间隔1s闪烁</span></span><br><span class="line">		<span class="keyword">if</span>(++Timer2.usMCU_Run_Timer &gt;= TIMER0_1S)</span><br><span class="line">		&#123;</span><br><span class="line">			Timer2.usMCU_Run_Timer = <span class="number">0</span>;</span><br><span class="line">			</span><br><span class="line">			LED.LED_Flip(LED1);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h5><p>程序现象没问题，就是我的热敏电阻的电压有点问题，不知道是什么问题</p>
<h3 id="DAC-1"><a href="#DAC-1" class="headerlink" title="DAC"></a>DAC</h3><h4 id="程序功能-6"><a href="#程序功能-6" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、上电后，输出正弦波；</p>
<p>2、触摸按键1调整正玄波频率。</p>
<h4 id="硬件电路-10"><a href="#硬件电路-10" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO41tzmPfmBWphIFicz0GsFlmaujJCDJpxUHrjbgSDOWLtjhO7YaOR7yN1A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-6"><a href="#技术讲解-6" class="headerlink" title="技术讲解"></a>技术讲解</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO414tjBsroJKcia4ZGfOibYzlvY0uAf8YwS7dYN4Hg8qcoEPfWHdvnlQFKQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO41bIFhY9kZ2I8PI3254mmJ7he4JF0vqY86rFVpN25mSHicd8oWOqvZVeQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO41XjWhnyrsibNYBhanyeL3Sb6ruDswrH2tz8fFytRKf49tib5T7PgiajyAw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>HAL库函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO41RE9dK9szB3TCBVDfcfprjCXmeic7TctI2ASmBpv9I7e5KXJ3UtzKvoQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
 <stm32f1xx_hal_dac.h>

<h4 id="编程说明-6"><a href="#编程说明-6" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO41y8Sv27t1yQKSfYt2xLKVJBc6xlknvBdjZ2LX61KCvMxktBich7XwBFA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO41ibp9oOPMoeyxVXFTVARNEN2dtLgjqDWdpoUeoJ6w1tMnH63LXZkIicIQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO41XsoXRq3JZDQeyEBanh5YnWqg9AV3fliawNkEObT8yrs96ZEgCC59ia6g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、DAC结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO41Xs8AYhpNEu1iasstA3xK5YLvGYNLCDicuGV3iaevnIrHjSfxpGojWKX3w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、DAC相关函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO41yOJhOTIppXWWbljOEwZLXncYwMdMZfAU8LEzeibrOgOfAQ626xIvxUg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-7"><a href="#6-1的程序-7" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><p>c8t6没有DAC，下课。</p>
<h5 id="工程配置-6"><a href="#工程配置-6" class="headerlink" title="工程配置"></a>工程配置</h5><h3 id="DMA"><a href="#DMA" class="headerlink" title="DMA"></a>DMA</h3><h4 id="程序功能-7"><a href="#程序功能-7" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、数码管显示PCB板温度；</p>
<p>2、SPI扩展接口的CS管脚(DAC_OUT1)输出1kHz的正弦波</p>
<p>3、触摸按键调整正弦波频率，在100Hz，1kHz，10kHz，100kHz，1MHz间切换；</p>
<p>4、串口打印温度信息与调整后的正弦波频率；</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUS68Lt2OBnN1EfQthntFytFZib1BCvJyX29Mk58Ht5fEPiaMvXySlN5OQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-11"><a href="#硬件电路-11" class="headerlink" title="硬件电路"></a>硬件电路</h4><p>ADC：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdiaI3ichCibFQcdWWzz6US8QKrZbkGpkXhoVvDict1ZyvuBMZEcIHcVl4MnKSXIUgq1cUvCS69uCr0yA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>DAC：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfP8icibpaHW6yxZCv9DpVO41tzmPfmBWphIFicz0GsFlmaujJCDJpxUHrjbgSDOWLtjhO7YaOR7yN1A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-7"><a href="#技术讲解-7" class="headerlink" title="技术讲解"></a>技术讲解</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUspmWEv2MV9ukO58aDOtQMnGIJ3re8AicVqwRKUnnese8stnthFffjWg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUUZWMxok7K629biaN1TMapcxJV6KSfUQiaGbSQiaNXc5XSQe8n185rKibBg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUib62zXIaicZlSpcCwt6IVUO1Q2ibXcKgPQrxxV33mGFRB3Zx9icNUod4Vw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUgK0CehuibYsCSD1gdxCXOtP4NPiaG8deLpSwxCldzqkEOjFAaKeoCsiag/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="HAL库函数-1"><a href="#HAL库函数-1" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUsGHRDYqvf0hkuh4oqBYM77HHdmaoa1Tr7ZEYq3aj8w1jueCSNcORYQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
 <stm32f1xx_hal_adc.h>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNU0AiboT1WO15TiaYMECCubHvtuLFYFZMQcYxZozNSe6tbambbySNicnlxA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
 <stm32f1xx_hal_dac.h>



<h4 id="编程说明-7"><a href="#编程说明-7" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p>ADC部分：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNULl4JfCkkxuUnDAs0dJyK91t3DatsowLGs7s6E7L2q3tKGiaXZkHug9A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUlavWRE64VYNuBvzhzXCeOfHf677ll78rhoPhB12ShicBrhFe1ZUQjcQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>DAC部分：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUFF37jY9a5ZBkFG3SAcdrOOiaP3yC7VqFiaBqSMIh5icvPRRuddS8RerVQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNU9spkRku5xXAIMjfUbZupkZG1gCZT8jaHmQaMCNCricHI0dWfENM1Evg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>TIM5部分：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUYLYHjGYmjKKfhe3Gn7pvC5uELMDCMfQ6qB4ZrcpCR8gUiblGvYLF5dw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>NVIC部分：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUibzTdMf88zRfexxsnUds402YBjEgFGotSuKhwcfhdbWzAeibT0Nicibumw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUZ6L2iacX8Myr6t2Fae9EySpTHCUm7oMWxlwuLKTLdIibk6yKOVhGvWVg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUHjeMAOrkHjROLON5EQibyfibm0ASVaPiasRhghicDO8iaIYU2YwvLkxX9Sw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、用户初始化函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNUvnOA122a3p3UPFBiaFvZZTecGZMkibQDMzNyS7z83qJSy6kfTcKq40MQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、中断回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcqHBzNGIJkLGoxAicys0kNU2ticiafEVjGVN8bpakwibVh4lCDSgKSOBtA42tbibmP1mFrbED5mFLPibuA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-8"><a href="#6-1的程序-8" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><p>后面再写，现在的芯片没有DAC</p>
<h3 id="I2C"><a href="#I2C" class="headerlink" title="I2C"></a>I2C</h3><h4 id="程序功能-8"><a href="#程序功能-8" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、软件模拟I2C协议与SHT30数字温湿度传感器通讯；</p>
<p>2、数码管显示环境温湿度；</p>
<p>3、串口打印环境温湿度。</p>
<p>图片如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZde5ttiaYmsaI0vlY6BvbBEUkRPkz410CSOE0p4ibdScibEPyZ4QULBydHW36gV7DeUtLiaIgogSaVDBw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-12"><a href="#硬件电路-12" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcrj76JvZpVax0ZswvVqicaYZ71vwsmcpGbymrk9ZC86gbMBSRiapVJOicC6gIoSradTXe3Mva04WLug/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-8"><a href="#技术讲解-8" class="headerlink" title="技术讲解"></a>技术讲解</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcrj76JvZpVax0ZswvVqicaYjyAt2w1iaEhIgVzOjWib803Z8r8gj5KWUuiaucouAFoXiaLGq3L5134PmQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcrj76JvZpVax0ZswvVqicaY54yYg3FVDaaA6gRibBxvzN9sAEx3AZTjOmick19ne0Bo5FOMUxBwXmAQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p> I2C协议特点</p>
<p>1、串行协议，多主机模式；</p>
<p>2、起始信号，SCL为高电平时，SDA下降沿，主机发出；</p>
<p>3、停止信号，SCL为高电平时，SDA上升沿，主机发出；</p>
<p>4、数据与地址按8位/字节传输，高位在前；</p>
<p>5、传输过程中，SCL为低电平时，SDA更改状态，SCL为高电平时，SDA状态需稳定；</p>
<p>6、每传输一个字节，接收器必须回应1个应答位(ACK)给发送器。</p>
<p>AT24Cxx传输图片：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcrj76JvZpVax0ZswvVqicaY806YmoJQnzNqMUlSDiaISjdcwRrwen5qhxRgbWqIu62cHoHUSBkmIbw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcrj76JvZpVax0ZswvVqicaYngGPIXvdt06YQjHUVCvZiaHSxjflYiayZSExia1FVS8xIJI7hEOxlWwCA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>SHT30手册阅读：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcrj76JvZpVax0ZswvVqicaYMMqFP8S4KgcVt0NfRBw4MRzCkEg6RtG6OuBaC6msO2KNc1dicUZfvHA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcrj76JvZpVax0ZswvVqicaYbEXMuphQRG2RCLANBtBzGAiaJAkibdIh3emRqKNbP2U39H4DQIv2IlYA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="HAL库函数-2"><a href="#HAL库函数-2" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p>​    软件模拟IIC，用GPIO的库函数即可。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZde5ttiaYmsaI0vlY6BvbBEUviaCjllPAjJmVlWpY320QbDgcL3e4QW4GEsMbVzcNM3Jhe65Dpy5uPw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="编程说明-8"><a href="#编程说明-8" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZde5ttiaYmsaI0vlY6BvbBEUjkC7ee4xVB8fBGMxFvmI5dQHlVQqZ8vuonMGPkZibiav8gRNM53jDOEw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：</p>
<p>SCL与SDA均配置为开漏输出，总线上均有上拉电阻。如此，SDA作为输出的同时，也可以作为输入使用。 与51内核的准双向口一样，作为输入使用时，需要先输出高电平，关闭内部的NMOS管。</p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZde5ttiaYmsaI0vlY6BvbBEUe9waDUpMRNdPXUvVlB4y7ibCFBCJwoM23ojw3RzhDv6icCHzL6nLb3wg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZde5ttiaYmsaI0vlY6BvbBEUCQXYVoYVjw1nIdzicuUmMvvdQ2icH7LfAcsYlx8Oiafia71S0EKtTra7pQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、I2C结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZde5ttiaYmsaI0vlY6BvbBEUc0xvOSp0Iu7YPxDUhahSI1OBibicxl5OpRQxHMFqXHRHv1hh2t0XUib8A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、SHT30结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZde5ttiaYmsaI0vlY6BvbBEU40Krm1aFwTsH4iaicED1y0gicdia8iaAaTYHGS9iaNkv0llwib6BCBPmLswUA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-9"><a href="#6-1的程序-9" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置-7"><a href="#工程配置-7" class="headerlink" title="工程配置"></a>工程配置</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230925172621821.png" alt="image-20230925172621821"></p>
<h5 id="硬件电路-13"><a href="#硬件电路-13" class="headerlink" title="硬件电路"></a>硬件电路</h5><p>没有芯片，也弄不出效果，就跟着模拟一遍I2C的流程，多打打，多熟悉熟悉。</p>
<h5 id="软件代码-6"><a href="#软件代码-6" class="headerlink" title="软件代码"></a>软件代码</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">  * @file    MyI2C</span></span><br><span class="line"><span class="comment">  * @author  6+1</span></span><br><span class="line"><span class="comment">  * @date    2023-09-25 15:55:20</span></span><br><span class="line"><span class="comment">  * @brief   软件模拟IIC</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//置位与清零SCL管脚</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>	SET_SCL	HAL_GPIO_WritePin(SCL_GPIO_Port,SCL_Pin,GPIO_PIN_SET) </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>	CLR_SCL	HAL_GPIO_WritePin(SCL_GPIO_Port,SCL_Pin,GPIO_PIN_RESET)</span></span><br><span class="line"><span class="comment">//置位与清零SDA管脚</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>	SET_SDA	HAL_GPIO_WritePin(SDA_GPIO_Port,SDA_Pin,GPIO_PIN_SET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>	CLR_SDA	HAL_GPIO_WritePin(SDA_GPIO_Port,SDA_Pin,GPIO_PIN_RESET)</span></span><br><span class="line"><span class="comment">//读SDA管脚状态</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> READ_SDA	HAL_GPIO_ReadPin(SCL_GPIO_Port,SDA_Pin)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Init</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//I2C初始化</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Start</span><span class="params">(<span class="type">void</span>)</span>; <span class="comment">//I2C起始信号</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Stop</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//I2C停止信号</span></span><br><span class="line">ACK_Value_t <span class="title function_">Write_Byte</span><span class="params">(<span class="type">uint8_t</span>)</span>;      <span class="comment">//I2C写字节</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">Read_Byte</span> <span class="params">(ACK_Value_t)</span>;  <span class="comment">//I2C读字节</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line">MyI2C_t MyI2C =</span><br><span class="line">&#123;</span><br><span class="line">	Init,</span><br><span class="line">	Start,</span><br><span class="line">	Stop,</span><br><span class="line">	Write_Byte,</span><br><span class="line">	Read_Byte</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* function prototypes--------------------------------------------------------*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">I2C_Delay_us</span><span class="params">(<span class="type">uint8_t</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   Init</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  IIC初始化</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    SET_SCL;</span><br><span class="line">    SET_SDA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   Start</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  IIC起始信号</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Start</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    SET_SDA;</span><br><span class="line">    SET_SCL;</span><br><span class="line">    I2C_Delay_us(<span class="number">1</span>);</span><br><span class="line">    CLR_SDA;</span><br><span class="line">    I2C_Delay_us(<span class="number">10</span>);</span><br><span class="line">    CLR_SCL;</span><br><span class="line">    I2C_Delay_us(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   Stop</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  I2C停止信号</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Stop</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    CLR_SDA;</span><br><span class="line">    SET_SCL; </span><br><span class="line">    I2C_Delay_us(<span class="number">10</span>);</span><br><span class="line">    SET_SDA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Write_Byte</span></span><br><span class="line"><span class="comment">	* @brief  I2C写字节</span></span><br><span class="line"><span class="comment">	* @param  WR_Byte -&gt; 待写入数据</span></span><br><span class="line"><span class="comment">	* @retval ACK_Value_t -&gt; 从机应答值      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> ACK_Value_t <span class="title function_">Write_Byte</span><span class="params">(<span class="type">uint8_t</span> WR_Byte)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> i;</span><br><span class="line">	ACK_Value_t  ACK_Rspond;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//SCL为低电平时，SDA准备数据,接着SCL为高电平，读取SDA数据</span></span><br><span class="line">	<span class="comment">//数据按8位传输，高位在前，利用for循环逐个接收</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//SCL清零，主机SDA准备数据</span></span><br><span class="line">		CLR_SCL;</span><br><span class="line">		I2C_Delay_us(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>((WR_Byte&amp;BIT7) == BIT7)</span><br><span class="line">		&#123;</span><br><span class="line">			SET_SDA;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			CLR_SDA;</span><br><span class="line">		&#125;</span><br><span class="line">		I2C_Delay_us(<span class="number">1</span>);</span><br><span class="line">		<span class="comment">//SCL置高，传输数据</span></span><br><span class="line">		SET_SCL;</span><br><span class="line">		I2C_Delay_us(<span class="number">10</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//准备发送下一比特位</span></span><br><span class="line">		WR_Byte &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	CLR_SCL;	</span><br><span class="line">	<span class="comment">//释放SDA，等待从机应答</span></span><br><span class="line">	SET_SDA;</span><br><span class="line">	I2C_Delay_us(<span class="number">1</span>);</span><br><span class="line">	</span><br><span class="line">	SET_SCL;</span><br><span class="line">	I2C_Delay_us(<span class="number">10</span>);</span><br><span class="line">	</span><br><span class="line">	ACK_Rspond = (ACK_Value_t)READ_SDA;</span><br><span class="line">	</span><br><span class="line">	CLR_SCL;</span><br><span class="line">	I2C_Delay_us(<span class="number">1</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//返回从机的应答信号</span></span><br><span class="line">	<span class="keyword">return</span> ACK_Rspond;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Write_Byte</span></span><br><span class="line"><span class="comment">	* @brief  I2C读字节</span></span><br><span class="line"><span class="comment">	* @param  ACK_Value -&gt; 主机回应值</span></span><br><span class="line"><span class="comment">	* @retval 从机返回值      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> <span class="title function_">Read_Byte</span><span class="params">(ACK_Value_t ACK_Value)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> RD_Byte = <span class="number">0</span>,i;</span><br><span class="line">		</span><br><span class="line">	<span class="comment">////接收数据</span></span><br><span class="line">	<span class="comment">//SCL为低电平时，SDA准备数据,接着SCL为高电平，读取SDA数据</span></span><br><span class="line">	<span class="comment">//数据按8位传输，高位在前，利用for循环逐个接收</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//准备接收下一比特位</span></span><br><span class="line">		RD_Byte &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//SCL清零，从机SDA准备数据</span></span><br><span class="line">		CLR_SCL;</span><br><span class="line">		I2C_Delay_us(<span class="number">10</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//SCL置高，获取数据</span></span><br><span class="line">		SET_SCL;</span><br><span class="line">		I2C_Delay_us(<span class="number">10</span>);	</span><br><span class="line"></span><br><span class="line">		RD_Byte |= READ_SDA;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//SCL清零，主机准备应答信号</span></span><br><span class="line">	CLR_SCL;</span><br><span class="line">	I2C_Delay_us(<span class="number">1</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//主机发送应答信号	</span></span><br><span class="line">	<span class="keyword">if</span>(ACK_Value == ACK)</span><br><span class="line">	&#123;</span><br><span class="line">		CLR_SDA;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		SET_SDA;	</span><br><span class="line">  &#125;	</span><br><span class="line">	I2C_Delay_us(<span class="number">1</span>);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	SET_SCL; 	</span><br><span class="line">	I2C_Delay_us(<span class="number">10</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//Note:</span></span><br><span class="line">  <span class="comment">//释放SDA数据线</span></span><br><span class="line">	<span class="comment">//SCL先清零，再释放SDA，防止连续传输数据时，从机错将SDA释放信号当成NACk信号</span></span><br><span class="line">	CLR_SCL;</span><br><span class="line">  SET_SDA; 	</span><br><span class="line">	I2C_Delay_us(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//返回数据</span></span><br><span class="line">	<span class="keyword">return</span> RD_Byte;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   I2C_Delay</span></span><br><span class="line"><span class="comment">	* @brief  I2C延时</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">I2C_Delay_us</span><span class="params">(<span class="type">uint8_t</span> us)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> i = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//通过示波器测量进行校准</span></span><br><span class="line">	<span class="keyword">while</span>(us--)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">7</span>;i++);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MYI2C_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MYI2C_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//枚举类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  BIT0 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">0</span>),  </span><br><span class="line">	BIT1 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">1</span>),  </span><br><span class="line">	BIT2 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">2</span>),  </span><br><span class="line">	BIT3 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">3</span>),  </span><br><span class="line">	BIT4 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">4</span>),</span><br><span class="line">	BIT5 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">5</span>),</span><br><span class="line">	BIT6 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">6</span>),</span><br><span class="line">	BIT7 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">7</span>),</span><br><span class="line">&#125;BIT_t;</span><br><span class="line"><span class="comment">//定义枚举类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	ACK	 = GPIO_PIN_RESET,</span><br><span class="line">	NACK = GPIO_PIN_SET,</span><br><span class="line">&#125;ACK_Value_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">void</span> (*Init)(<span class="type">void</span>);  <span class="comment">//I2C初始化</span></span><br><span class="line">	<span class="type">void</span> (*Start)(<span class="type">void</span>); <span class="comment">//I2C起始信号</span></span><br><span class="line">	<span class="type">void</span> (*Stop)(<span class="type">void</span>);  <span class="comment">//I2C停止信号</span></span><br><span class="line">	ACK_Value_t (*Write_Byte)(<span class="type">uint8_t</span>);      <span class="comment">//I2C写字节</span></span><br><span class="line">	<span class="type">uint8_t</span>     (*Read_Byte) (ACK_Value_t);  <span class="comment">//I2C读字节</span></span><br><span class="line">&#125;MyI2C_t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> MyI2C_t MyI2C;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern function prototypes-------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="直流电机"><a href="#直流电机" class="headerlink" title="直流电机"></a>直流电机</h3><h4 id="程序功能-9"><a href="#程序功能-9" class="headerlink" title="程序功能"></a>程序功能</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeuF1icciaO3pV2uiaRSP2kmZcibXGWtIIrTxicohBwHTPR0icDft14O8YiaOhrzMIxibJukKhUx2TYUj2qdw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-14"><a href="#硬件电路-14" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcSibsibibdok1LMeiacUR0VY9Y2reCQ1VUWvTf3p51p6FNFHf8V5ibXXA3UTgEuc8ibuCjOCk25CLahQCA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-9"><a href="#技术讲解-9" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>直流电动机是能将直流电能转换成机械能的旋转电机。</p>
<p>驱动方式一：只能打开或关闭，不能变速与换向，用继电器，BJT或MOS开关控制通断即可。</p>
<p>驱动方式二：可以打开或关闭，可以变速，但不能换向，用PWM控制电子开关即可，如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfyXibX4t6zTic9hNZglgLV6ebaxpicfZ1jaicJGsIBqJaNyjkDicbEKe75vW88SRMmZq7jBetB0pUpsng/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>驱动方式三：可以打开或关闭，可以变速，也可以换向，用PWM控制桥路，如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeuF1icciaO3pV2uiaRSP2kmZcTMibR2QNHVEibSvPxzzZH4Caa5WhO1VSIOxIm8EvHPNmQGHVPo5jU9tQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="HAL库函数-3"><a href="#HAL库函数-3" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p>   <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZerVR0IFWtZtpjd6e31LSdFnxN3F6qkZaNQsXkNNAUNkvjxflibRmOzFJKOwU0ohD5ofqEKMxV06kA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="编程说明-9"><a href="#编程说明-9" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeuF1icciaO3pV2uiaRSP2kmZcCT4lmchpSOY2aKxNaaNGC4TY8UmUml9xL4Wad0giaRghiczHqsppQExA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeuF1icciaO3pV2uiaRSP2kmZcI0cCf4nbiatow2UfymiaYM6KDEqV9yokMtwP31EVIyID1wWtrnyXqibsQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeuF1icciaO3pV2uiaRSP2kmZcmRDuIhV7ZCT8UCkyRPDKhR8ZzG4oa1DLD69QYqpLkn7RfHq1dWramw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、直流电机结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeuF1icciaO3pV2uiaRSP2kmZc0T1oM9G06nfmmOmhxMQ6qicqiaXZzPe43ZyWb12V8DmF6zxqXiawwDxYQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、触摸按键中断回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeuF1icciaO3pV2uiaRSP2kmZc5ncbAXLCLs4QaRuibaH4ic4D8lByCqW1F2EwxbINmpOQcCsVUIIYVJBA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-10"><a href="#6-1的程序-10" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置-8"><a href="#工程配置-8" class="headerlink" title="工程配置"></a>工程配置</h5><p>主要配PWM，其他都是前面配过的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230926132534998.png" alt="image-20230926132534998"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230926132630374.png" alt="image-20230926132630374"></p>
<h5 id="硬件电路-15"><a href="#硬件电路-15" class="headerlink" title="硬件电路"></a>硬件电路</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230926132702937.png" alt="image-20230926132702937"></p>
<p>这是我接的，接的很乱很杂，hhh，板子是旺哥今天给的，他之前画的，有这个板子我的面包板就有更多的位置了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230926133151018.png" alt="image-20230926133151018"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230926133205501.png" alt="image-20230926133205501"></p>
<h5 id="软件代码-7"><a href="#软件代码-7" class="headerlink" title="软件代码"></a>软件代码</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">  * @file    DC_Motor</span></span><br><span class="line"><span class="comment">  * @author  6+1</span></span><br><span class="line"><span class="comment">  * @date    2023-09-26 13:34:13</span></span><br><span class="line"><span class="comment">  * @brief   存放直流电机函数文件</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Start</span><span class="params">(<span class="type">void</span>)</span>;    <span class="comment">//直流电机启动</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Stop</span><span class="params">(<span class="type">void</span>)</span>;	    <span class="comment">//直流电机停止</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Direction_Adjust</span><span class="params">(<span class="type">void</span>)</span>;        <span class="comment">//直流电机方向调整</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Speed_Adjust</span><span class="params">(Speed_Change_t)</span>;  <span class="comment">//直流电机速度调整</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* function prototypes--------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义结构体类变量</span></span><br><span class="line">DC_Motor_t DC_Motor = </span><br><span class="line">&#123;</span><br><span class="line">  Stop_State,</span><br><span class="line">	Forward_State, </span><br><span class="line">	Speed_50,</span><br><span class="line">	</span><br><span class="line">	Start,</span><br><span class="line">	Stop,</span><br><span class="line">	Direction_Adjust,</span><br><span class="line">	Speed_Adjust</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Start</span></span><br><span class="line"><span class="comment">	* @brief  直流电机启动</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Start</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//启动电机</span></span><br><span class="line">	<span class="keyword">if</span>(DC_Motor.Direction == Forward_State)</span><br><span class="line">	&#123;</span><br><span class="line">		HAL_TIM_PWM_Start(&amp;htim3,TIM_CHANNEL_3);</span><br><span class="line">        </span><br><span class="line">		HAL_GPIO_WritePin(GPIOA, GPIO_PIN_12,GPIO_PIN_RESET);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//更新电机状态</span></span><br><span class="line">	DC_Motor.Status = Start_State;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Stop</span></span><br><span class="line"><span class="comment">	* @brief  直流电机停止</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Stop</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//停止电机</span></span><br><span class="line">	HAL_TIM_PWM_Stop(&amp;htim3,TIM_CHANNEL_3);</span><br><span class="line">	<span class="comment">//更新电机状态</span></span><br><span class="line">	DC_Motor.Status = Stop_State;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Direction_Adjust</span></span><br><span class="line"><span class="comment">	* @brief  直流电机方向调整</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Direction_Adjust</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(DC_Motor.Status == Start_State)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(DC_Motor.Direction == Reverse_State)</span><br><span class="line">		&#123;</span><br><span class="line">            HAL_GPIO_WritePin(GPIOA, GPIO_PIN_11,GPIO_PIN_SET);</span><br><span class="line">		    HAL_GPIO_WritePin(GPIOA, GPIO_PIN_12,GPIO_PIN_RESET);</span><br><span class="line">			<span class="comment">//更新电机方向标识</span></span><br><span class="line">			DC_Motor.Direction = Forward_State;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			HAL_GPIO_WritePin(GPIOA, GPIO_PIN_11,GPIO_PIN_RESET);</span><br><span class="line">		    HAL_GPIO_WritePin(GPIOA, GPIO_PIN_12,GPIO_PIN_SET);</span><br><span class="line">			<span class="comment">//更新电机方向标识</span></span><br><span class="line">			DC_Motor.Direction = Reverse_State;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Speed_Adjust</span></span><br><span class="line"><span class="comment">	* @brief  直流电机速度调整</span></span><br><span class="line"><span class="comment">	* @param  Speed_Change -&gt; 速度变化</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Speed_Adjust</span><span class="params">(Speed_Change_t Speed_Change)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(DC_Motor.Status == Start_State)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(Speed_Change == Speed_up)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//增大电机速度</span></span><br><span class="line">			<span class="keyword">switch</span>(DC_Motor.Speed)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">case</span> Speed_50:	DC_Motor.Speed = Speed_60;  <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Speed_60:	DC_Motor.Speed = Speed_70;  <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Speed_70:	DC_Motor.Speed = Speed_80;  <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Speed_80:	DC_Motor.Speed = Speed_90;  <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Speed_90:	DC_Motor.Speed = Speed_100; <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Speed_100:	DC_Motor.Speed = Speed_100; <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">default</span>: DC_Motor.Speed = Speed_50;         </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//减小电机速度</span></span><br><span class="line">			<span class="keyword">switch</span>(DC_Motor.Speed)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">case</span> Speed_50:	DC_Motor.Speed = Speed_50;  <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Speed_60:	DC_Motor.Speed = Speed_50;  <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Speed_70:	DC_Motor.Speed = Speed_60;  <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Speed_80:	DC_Motor.Speed = Speed_70;  <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Speed_90:	DC_Motor.Speed = Speed_80;  <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Speed_100:	DC_Motor.Speed = Speed_90;  <span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">default</span>: DC_Motor.Speed = Speed_90;         </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//更新PWM占空比</span></span><br><span class="line">		TIM3-&gt;CCR3 = DC_Motor.Speed;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Peripheral_Set</span></span><br><span class="line"><span class="comment">	* @brief  外设设置</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Peripheral_Set</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;----此程序实现直流电机的启停、正反转与加减速功能----\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Initialization completed, system startup!\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Software version is V%.1f\r\n\r\n&quot;</span>,SoftWare_Version);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;触摸按键1控制启停\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;触摸按键2控制正反转\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;触摸按键3控制加速\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;触摸按键4控制减速\r\n\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  Timer2.Timer2_Start_IT();  <span class="comment">//启动定时器2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">  * @file    CallBack</span></span><br><span class="line"><span class="comment">  * @author  6+1</span></span><br><span class="line"><span class="comment">  * @date    2023-09-21 19:54:53</span></span><br><span class="line"><span class="comment">  * @brief   存放回调函数</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private define-------------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private function prototypes------------------------------------------------*/</span>      </span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * @name   </span></span><br><span class="line"><span class="comment">    * @param  </span></span><br><span class="line"><span class="comment">    * @retval </span></span><br><span class="line"><span class="comment">    * @brief  中断回调函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_EXTI_Callback</span><span class="params">(<span class="type">uint16_t</span> GPIO_Pin)</span></span><br><span class="line">&#123;</span><br><span class="line">		<span class="comment">//控制启停</span></span><br><span class="line">	<span class="keyword">if</span>(GPIO_Pin == KEY1_Pin)</span><br><span class="line">	&#123;</span><br><span class="line">		LED.LED_Flip(LED2);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(DC_Motor.Status == Stop_State) </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;电机启动\r\n&quot;</span>);</span><br><span class="line">			<span class="comment">//启动电机</span></span><br><span class="line">			DC_Motor.Start(); </span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;电机停止\r\n&quot;</span>);</span><br><span class="line">			<span class="comment">//停止电机</span></span><br><span class="line">			DC_Motor.Stop();</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//电机调整转动方向</span></span><br><span class="line">	<span class="keyword">if</span>(GPIO_Pin == KEY2_Pin)</span><br><span class="line">	&#123;</span><br><span class="line">		LED.LED_Flip(LED2);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;电机改变转向\r\n&quot;</span>);</span><br><span class="line">		DC_Motor.Direction_Adjust();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//电机加速</span></span><br><span class="line">	<span class="keyword">if</span>(GPIO_Pin == KEY3_Pin)</span><br><span class="line">	&#123;</span><br><span class="line">		LED.LED_Flip(LED2);</span><br><span class="line">		</span><br><span class="line">		DC_Motor.Speed_Adjust(Speed_up);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;电机加速，当前速度为：%d\r\n&quot;</span>,DC_Motor.Speed);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//电机减速</span></span><br><span class="line">	<span class="keyword">if</span>(GPIO_Pin == KEY4_Pin)</span><br><span class="line">	&#123;</span><br><span class="line">		LED.LED_Flip(LED2);</span><br><span class="line">		</span><br><span class="line">		DC_Motor.Speed_Adjust(Speed_down);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;电机减速，当前速度为：%d\r\n&quot;</span>,DC_Motor.Speed);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   HAL_TIM_PeriodElapsedCallback</span></span><br><span class="line"><span class="comment">	* @brief  定时器中断回调函数</span></span><br><span class="line"><span class="comment">	* @param  *htim -&gt; 处理定时器的结构体指针</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_PeriodElapsedCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(htim-&gt;Instance == htim2.Instance)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//程序支持运行，指示灯间隔1s闪烁</span></span><br><span class="line">		<span class="keyword">if</span>(++Timer2.usMCU_Run_Timer &gt;= TIMER0_1S)</span><br><span class="line">		&#123;</span><br><span class="line">			Timer2.usMCU_Run_Timer = <span class="number">0</span>;</span><br><span class="line">			</span><br><span class="line">			LED.LED_Flip(LED1);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h5><p>电机和电机驱动照着江科大这样接就行，PWMA哪个端口接到你自己配置的PWM端口，比如我用的是PB0口，我就把PWMA接到PB0，接线很简单的，自己看着接就行，注意端口，其他AIN1 2随便接两个接口，这个没有要求，主要就是PWMA的口。</p>
<p>按键LED那些代码前面有，就算没有我也相信现在的你肯定可以轻松写出按键控制led的程序</p>
<p>程序运行起来还是有问题的，比如按键不灵敏，按下按键电机没反应，按键失灵然后会多按好几下，不知道的代码问题还是硬件电路问题，往前先学吧，后面在回头看。</p>
<h5 id="按键问题"><a href="#按键问题" class="headerlink" title="按键问题"></a>按键问题</h5><p>==<strong>注</strong>== ：按键不灵敏是因为代码没有消抖，硬件家园的是触摸按键，我的是机械按键，没有消抖导致按键不灵敏，因为有个key文件，导致我认为调用的是按键检测，其实根本没有用到按键检测函数，问题都是没有消抖导致的。软件消抖需要延时，但是延时不建议放在中断，容易程序卡死</p>
<p>建议在回调函数获取按键标志位，然后在主程序调用检测按键函数，但是按键按下要干嘛，则需要去key文件修改，有点麻烦</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * @name   </span></span><br><span class="line"><span class="comment">    * @param  </span></span><br><span class="line"><span class="comment">    * @retval </span></span><br><span class="line"><span class="comment">    * @brief  中断回调函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_EXTI_Callback</span><span class="params">(<span class="type">uint16_t</span> GPIO_Pin)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">switch</span>(GPIO_Pin)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> KEY1_Pin: KEY1.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY2_Pin: KEY2.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY3_Pin: KEY3.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY4_Pin: KEY4.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY5_Pin: KEY5.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:<span class="built_in">printf</span>(<span class="string">&quot;错误 - 外部中断回调函数中，触摸按键键值错误！\r\n\r\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Run</span></span><br><span class="line"><span class="comment">	* @brief  系统运行</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Run</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	KEY1.KEY_Deteck();</span><br><span class="line">	KEY2.KEY_Deteck();</span><br><span class="line">	KEY3.KEY_Deteck();</span><br><span class="line">	KEY4.KEY_Deteck();</span><br><span class="line">	KEY5.KEY_Deteck();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="单极性步进电机"><a href="#单极性步进电机" class="headerlink" title="单极性步进电机"></a>单极性步进电机</h3><h4 id="程序功能-10"><a href="#程序功能-10" class="headerlink" title="程序功能"></a>程序功能</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mdEk4ROdRyjMLsRE5zrBo8ekM1RpsSSWayUWjeJVpB818480UMU1m6A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-16"><a href="#硬件电路-16" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0meps0oMZbK72tnrCkUGcaB5uRiag5o3ykmIFA8Pq7pyaKL6cnPGcXr9g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-10"><a href="#技术讲解-10" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>步进电机是将电脉冲信号转变为角位移或线位移的开环控制元件。在非超载的情况下，电机的转速、停止的位置只取决于脉冲信号的频率和脉冲数，而不受负载变化的影响，当步进驱动器接收到一个脉冲信号，它就驱动步进电机按设定的方向转动一个固定的角度，称为”步距角”，它的旋转是以固定的角度一步一步运行的。可以通过控制脉冲个数来控制角位移量，从而达到准确定位的目的;同时可以通过控制脉冲频率来控制电机转动的速度和加速度，从而达到调速的目的。</p>
<p><strong>单极性4相5线步进电机：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mjQ9Xmm0EgN6MlUDqc4894GV7iaQ2t7EWgoQbKQgtIZzvyOJYibib83jMw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0miclQ0L8otWr9rJjQgxeh0ZUErzDACcWLiasKW5OXYDicGyRaTHl8hoWBQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mv45vRY6iaMwH0PG31WIsicCMzMjkGfvaE6AFr4O3rBlhSicuaRw9dzf2A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><strong>驱动方式：</strong></p>
<p>1、单四拍  A - B - C -D - A - 循环往复</p>
<p>特点：步距角5.625/32， 电流最小，扭矩最小</p>
<p>2、双四拍 AB - BC - CD - DA - AB - 循环往复</p>
<p>特点：步距角5.625/32， 电流最大，扭矩最大</p>
<p>3、八拍 A - AB - B - BC - C - CD - D - DA - A - 循环往复</p>
<p>特点：步距角5.625/64， 电流居中，扭矩居中</p>
<h4 id="HAL库函数-4"><a href="#HAL库函数-4" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mznshF7voe2s8L2S2x5cjMfciciaibOCllEMibtLyHDtWuoQ2h4LHTQQCEg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mTSJGJT0aKgKI6ulBO2CFFCgVgXIUUht090ZyhM0DPewIQ3nA6a46pw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="编程说明-10"><a href="#编程说明-10" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mJ0G9yx37ACicAaQt5J5xiaHmO6tPCxPtLvVrFO3c0U3AOXt4AAY7SmiaQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mkiaQrJGcrszdF0r2QeHfuib5IYMjPzwwO0fIaCn7bq5LRSMQbVSmm7YA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mNkasODtMA26uibYxFWa6iaqJkOD3iagoWg8Cia4oVZAhM6W9RctKTtNibEg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeuF1icciaO3pV2uiaRSP2kmZcmRDuIhV7ZCT8UCkyRPDKhR8ZzG4oa1DLD69QYqpLkn7RfHq1dWramw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、单极性步进电机结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mYSFm5HQ2Ygltn9CMMh4kXAp9yvaGumQ3abu5icPoMBoZfTR7USVllOA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、定时器7中断回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mHs2se0oqyHvSQ4oLiaaPH0gLjHUNxaeNpHcibY0mo9a7Bo4aW79Hz8Yw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h4><p>电机没反应，下课</p>
<h3 id="双极性步进电机"><a href="#双极性步进电机" class="headerlink" title="双极性步进电机"></a>双极性步进电机</h3><p>没有这个电机，看看视频了解了解就行</p>
<h4 id="程序功能-11"><a href="#程序功能-11" class="headerlink" title="程序功能"></a>程序功能</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfzgZzDkzj44xfibC9Z0lAP7cDW7icPGd0T8jPskPcdqTY7rP6anRlxG6kSsGicFrJvictwdZNtBibNvlQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-17"><a href="#硬件电路-17" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfzgZzDkzj44xfibC9Z0lAP7CoQe6icYAggULljC4SAV8d6M1ccsCKjdyPwXPsngXzjlE12Q3ms8GDQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-11"><a href="#技术讲解-11" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>步进电机是将电脉冲信号转变为角位移或线位移的开环控制元件。在非超载的情况下，电机的转速、停止的位置只取决于脉冲信号的频率和脉冲数，而不受负载变化的影响，当步进驱动器接收到一个脉冲信号，它就驱动步进电机按设定的方向转动一个固定的角度，称为”步距角”，它的旋转是以固定的角度一步一步运行的。可以通过控制脉冲个数来控制角位移量，从而达到准确定位的目的;同时可以通过控制脉冲频率来控制电机转动的速度和加速度，从而达到调速的目的。</p>
<p><strong>双极性2相4线步进电机：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfzgZzDkzj44xfibC9Z0lAP7u0HXhIIVOQOhcO8cMkqBSrggG0Nqib9RkU9ibamU5209eDBqdNO8IrTw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfzgZzDkzj44xfibC9Z0lAP76acmJ9N8acjFHGjff8Ty4AibYyZaarz1QqtkiaS8sBYCP1NArt9t9ROg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><strong>驱动方式：</strong></p>
<p>1、单四拍  A+ , B+ , A- , B-  循环往复</p>
<p>特点：步距角7.5°， 电流最小，扭矩最小</p>
<p>2、双四拍 A+B+，B+A-，A-B-，B-A+ 循环往复</p>
<p>特点：步距角7.5°， 电流最大，扭矩最大</p>
<p>3、八拍 A+，A+B+，B+ , B+A-，A- , A-B-，B-，B-A+循环往复</p>
<p>特点：步距角3.75°， 电流居中，扭矩居中</p>
<h4 id="HAL库函数-5"><a href="#HAL库函数-5" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mznshF7voe2s8L2S2x5cjMfciciaibOCllEMibtLyHDtWuoQ2h4LHTQQCEg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mTSJGJT0aKgKI6ulBO2CFFCgVgXIUUht090ZyhM0DPewIQ3nA6a46pw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="编程说明-11"><a href="#编程说明-11" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfzgZzDkzj44xfibC9Z0lAP7ynn58ys8rgTd5c6oSueyp8PpO3GTd6oxITdRB78b22ORZplI4nuI3w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZd5dvZnM1ueu0q8peBlcF0mkiaQrJGcrszdF0r2QeHfuib5IYMjPzwwO0fIaCn7bq5LRSMQbVSmm7YA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfzgZzDkzj44xfibC9Z0lAP7njlRGDQhKibmPeQtVI5SLnkzbWR85q6b7V2iaybHOE2E1s3rQXGMQ6qg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeuF1icciaO3pV2uiaRSP2kmZcmRDuIhV7ZCT8UCkyRPDKhR8ZzG4oa1DLD69QYqpLkn7RfHq1dWramw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、双极性步进电机结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfzgZzDkzj44xfibC9Z0lAP7A6w8vQBskyL3pzvwt2hw4iaE960Wa9Jha5ibtWAC6YcE7e18icgFFaFIw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、定时器7中断回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfzgZzDkzj44xfibC9Z0lAP7KA9h054chDceQDw9bwbgO6lA9icZJFFsYp13ib1GJiaQdtqWU6IkxAeWA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h3 id="HMI智能串口屏"><a href="#HMI智能串口屏" class="headerlink" title="HMI智能串口屏"></a>HMI智能串口屏</h3><p>没屏幕，了解了解</p>
<h4 id="程序功能-12"><a href="#程序功能-12" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、HMI智能串口屏同步显示数码管计数；</p>
<p>2、HMI智能串口屏与主板同时控制步进电机。</p>
<p>图片：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHplfEQLyib4QnyQSb1q4GSfrt0iaWsuYyfshII2KK6QcVgUIbORDH4tCZA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-18"><a href="#硬件电路-18" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpeWCqSTlGV4HCpg347VYkYUBodtHsjhEKDfia6E6wXnCvCjmZzJPBTuw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpYRS8b2Ekc4TBonglt5IrbzpBd6jibTd0Kx8BYHuKFP5BMb2bJNKrjiaA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>双排针H11接线说明：</p>
<p>1、MicroUSB口连接到STM32，用于打印程序信息</p>
<p> 短路帽短接3与1,4与2</p>
<p>2、HMI智能串口屏连接到STM32</p>
<p> 短路帽短接3与5,4与6</p>
<p>3、MicroUSB口连接到HMI智能串口屏，用于更新串口屏程序与调试串口屏</p>
<p>杜邦线短接1与6，5与2</p>
<h4 id="技术讲解-12"><a href="#技术讲解-12" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>资料网址：<a target="_blank" rel="noopener" href="http://wiki.tjc1688.com/doku.php">http://wiki.tjc1688.com/doku.php</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpB6lJvtfaedFIExvAFIbCPq3KHLcZjKmAiaCh1W9UjzddeC5wblt6kAg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>应用：</p>
<p>1、充电桩</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpQPKv8tdpJ2e13nUicGUIGrtqdib80tJGXgZu480kXqjicRL4YiapCwdkTw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、仪器仪表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHptawhYln86DUjOemHByR4mhcJf2yibogBRFawjvBEK1CcK2HlxjUAE2g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>3、工业产品</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpcQC3b02VxicSKZefJgV4RrWOh4JTAXjXNnMfprn60BPu5TZKW7Vupgw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>技术讲解</p>
<p>资料网址：<a target="_blank" rel="noopener" href="http://wiki.tjc1688.com/doku.php">http://wiki.tjc1688.com/doku.php</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpB6lJvtfaedFIExvAFIbCPq3KHLcZjKmAiaCh1W9UjzddeC5wblt6kAg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>应用：</p>
<p>1、充电桩</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpQPKv8tdpJ2e13nUicGUIGrtqdib80tJGXgZu480kXqjicRL4YiapCwdkTw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、仪器仪表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHptawhYln86DUjOemHByR4mhcJf2yibogBRFawjvBEK1CcK2HlxjUAE2g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>3、工业产品</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpcQC3b02VxicSKZefJgV4RrWOh4JTAXjXNnMfprn60BPu5TZKW7Vupgw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="编程说明-12"><a href="#编程说明-12" class="headerlink" title="编程说明"></a>编程说明</h4><p>0、智能串口屏GUI设计</p>
<p>视频详细讲解</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpYuBccqiakTtyTQqzEJibw7JlmLjOrzG9XAgxBRscRCicic4X1L2KjfAoNg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>1、STM32cubeMX初始化</p>
<p>主要配置串口1，DMA接收+空闲中断</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpyUSrHnPibKl2vdfNSfuv5yYtzQLicKx3aukAFSYh0xZLsN5VFWXebyibg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpFQCwJ1f7IQYIMRibA29dEHzsMtgYPLG6DmjTZRLHrrPdjaLDKx8uByg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpIBYufxelWiaAib7ezI7dJY21vjn32XqtxPG4zHazAEZ9OgV6wTSoedVA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpfcp7Xh576FmvsQUxr6aeueBXxgIyI7LXv7lmNhmzfmEypnee2s1Clw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHpqFb17YbU4lbmPM0hf2lHjs2WpTQ4047TCCgDutoFibalC28kjD20tow/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、HMI串口屏结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHp8DunbwdiaP86qIO9KbcIsUXvu3BAPPhd67k5VhAxFkuxrCZagBJOCkA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、串口1空闲中断回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHphU53mIsLfiaURMg7e3n3QxIyYQl8WDxhPcc7510Vs17K8j42QmszIxA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>6、接口协议解析函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeQLFMibmrbEiauR4GfCPAvHppziaBPxfXG1vmc2S2eWa7BqcBIWhNyg1uqY1ib5Lrp8vsg0fCl7ibuAkA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h3 id="RS-485通信-modbus协议"><a href="#RS-485通信-modbus协议" class="headerlink" title="RS-485通信 modbus协议"></a>RS-485通信 modbus协议</h3><h4 id="程序功能-13"><a href="#程序功能-13" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、主板与数码管均可以显示SHT30的温湿度；</p>
<p>2、主板与数码管均可以控制继电器与蜂鸣器；</p>
<h4 id="硬件电路-19"><a href="#硬件电路-19" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfDBOlre5aI2HJLzsvHK2CxafcVeGGl1N1Iia2Zdx6gh4426ZGg69EDGeN2KcbcwYgqT6mnXMKiauCw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-13"><a href="#技术讲解-13" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>Modbus是一种串行通信协议，是Modicon公司(现在的施耐德电气 Schneider Electric)于1979年为使用可编程逻辑控制器(PLC)通信而发表。Modbus已经成为工业领域通信协议的业界标准(De facto)，并且现在是工业电子设备之间常用的连接方式。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4ggUUgggHzb8fibdGcicAI1mxugXIqN5BgVUpolDtu76KymSrPxqW790lQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gDCsFZHI97iaOsxibyKkuohYdiaiacwbiajfJIOV8RXvPicnLbttAt8nPkdKQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4ge08gEkgaYSo3ldaWtaDeflSqYxeQbefJibCYdjicUAX1iaic2kFC2vTJWA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="HAL库函数-6"><a href="#HAL库函数-6" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gjCvsiatqQkFeewaAJGwa6aduLSyWjrkRoIyBh78zQeTWO8eniauV2VOw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>发送：采用DMA+TC中断</p>
<p>接收：采用DMA+空闲中断</p>
<h4 id="编程说明-13"><a href="#编程说明-13" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p>配置串口3：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gxbL1UAOPk1XNiawtIMZA0Cl2aHyGDxniaziaZCvicic0mAicmibONzAqFIMOw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>配置DMA：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gaK39YPAn0u2W1gJ6g6aOopI47qg5KrXwwBB91FwicbRkibdfVMSabbJQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>配置中断：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4goeLHMJDodeU42K1K8cLJAA3icH65mFbT9p6aROkdbHZfy0ibRqL6FwpA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gbllgAqIWeMaiaHGmtBZ6NMsy6mq7BBPicsMBsQibzTNFrpC8BWbxxCYtw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gW9AKYxvlyCZDZaCzQyYMzqIlVUWx0dSLVn4wXAmce5Jm9Az21z18IQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、串口结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4g2kbazou8yibnTqSNmMqrCD7avfMjPvZLl4X3TA3bPnW84s1RXfqv3Bg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、串口3发送完成与空闲中断回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gbaQhKugO0ODaKTRA0DSljIZIEWqKgN3zm8JPtatMtV6vsGicu82IVkw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gN1efmicgwm8l0GM9SibqZ6sR7xWvKWfbVooFAbz99jIE2qO3AjXF6ItQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>6、modbus结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gBsRNOOrfVdB4Fkjz1iaafh7RiaTymMw5ZvzQ9veqPlQmKEnXgyuKIMaQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h3 id="WIFI无线通信"><a href="#WIFI无线通信" class="headerlink" title="WIFI无线通信"></a>WIFI无线通信</h3><h4 id="程序功能-14"><a href="#程序功能-14" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、智能配网；</p>
<p>2、上电自动连接WIFI与TCP服务器；</p>
<p>3、间隔1s推送SHT30的温湿度至TCP服务器；</p>
<p>4、接收TCP服务器指令，控制继电器与蜂鸣器。</p>
<p>图片：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3hNmfJlFQoibPK7qpmRl4xFrmicuq1VP4onzVtndCDe9kibiaxGIuibherpQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>串口信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3UIiaYNDvomRSSsSpaKs6wA0wlVpVDFP3tIWUjxF61lJxaFV4ebeMQ3w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>电脑端模拟TCP</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3x7KNRDdiaNIzYoKrInIHicKBQLzdQD3302d1PEfYib3tvESjaLtsfVv1w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>手机端模拟TCP</p>
<h4 id="硬件电路-20"><a href="#硬件电路-20" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdNWak8jLavmCDsHQNxZE4I0yCPKHuyHibebiblsgIb00ypLNKMOAQwS1AFI5FrMhPFXmZoZZAyRf8Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdNWak8jLavmCDsHQNxZE4IATA3csougZWP6Px9pUegadLXlnQtlKjf5ly486F5oPK4y8ZwokiclsQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-14"><a href="#技术讲解-14" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>视频讲解WIFI模块资料以及如何熟悉AT指令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3VoQIP7XqKsxUkdWF8ia0L1icTUqsQd7Tia9x02JMvBxicdKgPKYqE5zk1g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="HAL库函数-7"><a href="#HAL库函数-7" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p> 主要使用串口的DMA收发，以及空闲中断。 <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gjCvsiatqQkFeewaAJGwa6aduLSyWjrkRoIyBh78zQeTWO8eniauV2VOw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="编程说明-14"><a href="#编程说明-14" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA38L38Fh2IgdgRzyzzErxIpoicyDoAYCowAt70HicPh14qNypES88SITOA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3chsPfdfOXXcVeibmVt7wvVxAECAcdeGKLxtk54Pibia1giaylOyicJSTBqg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA36kOcXCdY6siamhLOXIpPianmbgnMwAXcrtIBIQZwBNmt4Matl4Pz0MdQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3rg66HyItERvdS1MZph7gvmQ33YWO6Hs8wxMkZWicwQsO5YwVV784qpg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、串口结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3tTm5uqu8iaTuLUPR2T8GHK2rHJZFxGzPSIKuMhkDCe7uudBbFzPZkfg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、ESP8266结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3AX9IXR7mLxBJtz82JXb3djt6G2PnibLZrlZqMzBtZrTvXX5uxQ9SByw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>6、WIFI模块配网函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA36os0soKAwgjLM2UMjqZnvib0TeAwwUhINy57O5JGYwjj4NMStnrrbQw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-11"><a href="#6-1的程序-11" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><p><strong>代码运行有问题，不知道是什么问题。</strong> 后面在弄吧</p>
<p>测试AT指令<br>关闭回显功能<br>设置工作模式为STA<br>连接AP<br>查询本地IP地址<br>建立TCP连接<br>设置透传模式<br>开始发送数据<br>退出发送数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231006122257308.png" alt="image-20231006122257308"></p>
<p>需要连接同一个路由才能成功连接TCP</p>
<h5 id="工程配置-9"><a href="#工程配置-9" class="headerlink" title="工程配置"></a>工程配置</h5><h5 id="硬件电路-21"><a href="#硬件电路-21" class="headerlink" title="硬件电路"></a>硬件电路</h5><p>TX连RX,RX连TX,GND接GND，3.3V接3.3V，我接串口的3.3没反应，接stlink的3.3就行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20230927202707862.png" alt="image-20230927202707862"></p>
<h3 id="GPRS无线通信"><a href="#GPRS无线通信" class="headerlink" title="GPRS无线通信"></a>GPRS无线通信</h3><p>没有模块，看看就好</p>
<h4 id="程序功能-15"><a href="#程序功能-15" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、上电通过GPRS模块自动连接TCP服务器；</p>
<p>2、间隔1s推送SHT30的温湿度至TCP服务器；</p>
<p>3、接收TCP服务器指令，控制继电器与蜂鸣器。</p>
<p>图片：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeY6UIFl1N6e8AofDTHmuJJOR8pUYsTia82owdyibOiaUoNCneNDPmVvHdIEJpELcxuuR2pyfghWKlSw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>串口信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3UIiaYNDvomRSSsSpaKs6wA0wlVpVDFP3tIWUjxF61lJxaFV4ebeMQ3w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>电脑端模拟TCP</p>
<h4 id="硬件电路-22"><a href="#硬件电路-22" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeKFmPMGPFJHAQRjqVJrUHZ8vibhxxicykqXwRycfdhp4JaKUosWbmGvNSib2zTrTSFKgUhFGhEnCMTQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdNWak8jLavmCDsHQNxZE4IATA3csougZWP6Px9pUegadLXlnQtlKjf5ly486F5oPK4y8ZwokiclsQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-15"><a href="#技术讲解-15" class="headerlink" title="技术讲解"></a>技术讲解</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeY6UIFl1N6e8AofDTHmuJJ40OlnOmNRgZjXDfGOowcdF9ua7Ih5Kn8kB9icID4poRo5Q5EKezibjtw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>视频讲解GPRS模块资料以及如何熟悉AT指令</p>
<h4 id="HAL库函数-8"><a href="#HAL库函数-8" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p> 主要使用串口的DMA收发，以及空闲中断。 <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfIdk5w2kwQRUeibMWDJrl4gjCvsiatqQkFeewaAJGwa6aduLSyWjrkRoIyBh78zQeTWO8eniauV2VOw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="编程说明-15"><a href="#编程说明-15" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA38L38Fh2IgdgRzyzzErxIpoicyDoAYCowAt70HicPh14qNypES88SITOA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3chsPfdfOXXcVeibmVt7wvVxAECAcdeGKLxtk54Pibia1giaylOyicJSTBqg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeY6UIFl1N6e8AofDTHmuJJWx5Izo5xtNn00BIiaqzlIQpFVqYbGejic4icPtKxH04SwicvQ95yraKCHg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeY6UIFl1N6e8AofDTHmuJJzb6vHHLwwgicfNibtlwmWcp4aXkU9boUrh5wkdy2PlI4IlLmpTRz6O6Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、串口结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdmHGd1tdM0ibVN0ccIKIkA3tTm5uqu8iaTuLUPR2T8GHK2rHJZFxGzPSIKuMhkDCe7uudBbFzPZkfg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、SIM800C结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeY6UIFl1N6e8AofDTHmuJJib7q8sXTibRXeUXkGols4Hr51orWQerjuMYcQDMCm4PDyt0SIp2poy5A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>6、SIM800C模块AT指令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZeY6UIFl1N6e8AofDTHmuJJPD8uzwh4WwsI7DnCV02iaB6oWhntvB2GpIMDwEZxFAfSdhsdR2epp0Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h3 id="RTC时钟"><a href="#RTC时钟" class="headerlink" title="RTC时钟"></a>RTC时钟</h3><h4 id="程序功能-16"><a href="#程序功能-16" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、通过串口设置RTC的时间与日期；</p>
<p>2、通过串口打印RTC的时间与日期；</p>
<p>3、数码管显示RTC时间；</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlCa8W2QGibiazOvTzhUsUaFgd7VKemv8ugY6CghIK1Ko7Ddx5Qf4RSURkQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-23"><a href="#硬件电路-23" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdAL0IRvoht8PqlKHdDdiaCvomwniaGyvlKqLBexQ79wFpzOa4XiajfJGQOZeKOSummkyGQrHnNhpkJQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZdAL0IRvoht8PqlKHdDdiaCvibGwOl7qMQEcovnEpk4vBmVAfnicjicicH5T9OlacIBKF6wxXTkHGuM7vA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-16"><a href="#技术讲解-16" class="headerlink" title="技术讲解"></a>技术讲解</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlCHO1fiafYx3SoJxm0GcEzpchY5FtITD8U6tASgBJ3QoItm7WHbSvplQA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>分析框图，RTC的后备区域没有日期寄存器，断电后恢复后，没法直接读取日期；如果需要读取断电恢复后日期更新值，方法有二：</p>
<p>1、使用高级些的MCU，比如STM32F4，RTC自带日期寄存器。</p>
<p>缺点：MCU成本贵</p>
<p>2、利用32位可编程计数器进行计算。具体方法是：假定计数器为0时，为一个起始日期，比如2000年1月1日； 设定日期后，减去起始日期，换算成秒钟初始化给计数器； 断电后，计数器值不重新装载，与设定日期对比，换算出当前日期。</p>
<p>缺点：</p>
<p>①、不能使用HAL库编程；</p>
<p>②、需要CPU大量计算，效率低；</p>
<p>③、RTC溢出与闹钟功能不可用。</p>
<h4 id="HAL库函数-9"><a href="#HAL库函数-9" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlCufA2jyvyiawD4AgyXaKiba6FEPnC3FMozy5GvV8cLRmRgjusJ6ZMrib4A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<stm32f1xx_hal_rtc>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlChXrnibEmEefXCnpWoPzfrwNxrjwVibiaKPuTXg1V2F0vceTYA4eKUe4kw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<stm32f1xx_hal_rtc_ex>



<h4 id="编程说明-16"><a href="#编程说明-16" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlC2m9jDBLfDmQlNbdAqQUQgDh4vSc8KNib5OnZc1QkrPxWy0lWnIYR53A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlCZgVeX5d9cEiaHtzTBI6PtnjtoR9ekUrzZMZJxZ0jlqfC7iayI271bvDA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlCbgsl0iaeAP0IhwKmLN6YuiaXg5JRYE3hmyLtzyyUKIIeMe516Ts6AyibQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlCibwkRR1vTtQeXe9SXfQxUmMG1GhOZjf1bDmkxdAK4HCYQMsb87hXyfA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlCibuZhHftcK874P2TngPOUQ2MItbKoPNGCswMworjHxIDNmWdicphsic4Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、MyRTC结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlCWS3n7mUsANDvwp2gyU2lpO9hibKxNXdbhthvLiaa5kjJROFNMEOCZibhQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、RTC设置日历</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlCWl3GCqX1jozdWG7mVONq28XR1RSgeUFl2Bf1rsPFDCiatJywD3O2ahA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>6、RTC显示日历</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc3po3xoLCQvCmy38ibFqVlCNAV6KfbPb3g3XwicGrRDoR8qicenMdmBszo6fXiauVoMB02gUQic0621Gg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-12"><a href="#6-1的程序-12" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置-10"><a href="#工程配置-10" class="headerlink" title="工程配置"></a>工程配置</h5><p>选择这个晶振，没有LSE晶振，用LSE会卡死在程序里，用LSI就行，就是时间不准，不过也没什么关系，勾选串口的接收发送</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231007205021385.png" alt="image-20231007205021385"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231007210142644.png" alt="image-20231007210142644"></p>
<h5 id="硬件电路-24"><a href="#硬件电路-24" class="headerlink" title="硬件电路"></a>硬件电路</h5><p>不用接OLED，在接个LED灯就行，</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231007210013438.png" alt="image-20231007210013438"></p>
<h5 id="软件代码-8"><a href="#软件代码-8" class="headerlink" title="软件代码"></a>软件代码</h5><h6 id="RTC-1"><a href="#RTC-1" class="headerlink" title="RTC"></a>RTC</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MYRTC_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MYRTC_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">uint8_t</span> RTC_SetValue_Flag;   <span class="comment">//RTC设置标志位</span></span><br><span class="line">	</span><br><span class="line">	RTC_TimeTypeDef *pRTC_TimeStruct;  <span class="comment">//RTC时间结构体指针</span></span><br><span class="line">	RTC_DateTypeDef *pRTC_DateStruct;  <span class="comment">//RTC日期结构体指针	</span></span><br><span class="line">	</span><br><span class="line">	<span class="type">void</span> (*Calendar_Set)(<span class="type">void</span>);  <span class="comment">//设置日历</span></span><br><span class="line">	<span class="type">void</span> (*Calendar_Get)(<span class="type">void</span>);  <span class="comment">//获取日历</span></span><br><span class="line">	<span class="type">void</span> (*Calendar_Show)(<span class="type">void</span>); <span class="comment">//获取日历</span></span><br><span class="line">&#125; MyRTC_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span>  MyRTC_t  MyRTC;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern function prototypes-------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">RTC_TimeTypeDef RTC_TimeStruct_CurrentValue; <span class="comment">//RTC当前时间</span></span><br><span class="line">RTC_DateTypeDef RTC_DateStruct_CurrentValue; <span class="comment">//RTC当前日期</span></span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> *Week_Str[<span class="number">7</span>] = </span><br><span class="line">&#123;</span><br><span class="line">	(<span class="type">uint8_t</span>*)<span class="string">&quot;日&quot;</span>,</span><br><span class="line">	(<span class="type">uint8_t</span>*)<span class="string">&quot;一&quot;</span>, </span><br><span class="line">	(<span class="type">uint8_t</span>*)<span class="string">&quot;二&quot;</span>, </span><br><span class="line">	(<span class="type">uint8_t</span>*)<span class="string">&quot;三&quot;</span>, </span><br><span class="line">	(<span class="type">uint8_t</span>*)<span class="string">&quot;四&quot;</span>, </span><br><span class="line">	(<span class="type">uint8_t</span>*)<span class="string">&quot;五&quot;</span>, </span><br><span class="line">	(<span class="type">uint8_t</span>*)<span class="string">&quot;六&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Calendar_Set</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//设置日历</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Calendar_Get</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//获取日历</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Calendar_Show</span><span class="params">(<span class="type">void</span>)</span>; <span class="comment">//显示日历</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> <span class="title function_">Input_RTC_SetValue</span><span class="params">(<span class="type">uint8_t</span>)</span>; <span class="comment">//输入RTC设置值</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span>    <span class="title function_">RTC_Time_Set</span><span class="params">(<span class="type">void</span>)</span>;          <span class="comment">//RTC时间设置</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span>    <span class="title function_">RTC_Date_Set</span><span class="params">(<span class="type">void</span>)</span>;          <span class="comment">//RTC日期设置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">MyRTC_t MyRTC = </span><br><span class="line">&#123;</span><br><span class="line">	TRUE,</span><br><span class="line">	</span><br><span class="line">	&amp;RTC_TimeStruct_CurrentValue,</span><br><span class="line">	&amp;RTC_DateStruct_CurrentValue,</span><br><span class="line">	</span><br><span class="line">	Calendar_Set,</span><br><span class="line">	Calendar_Get,</span><br><span class="line">	Calendar_Show</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* function prototypes--------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Calendar_Set</span></span><br><span class="line"><span class="comment">	* @brief  设置日历</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Calendar_Set</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	<span class="comment">//上电复位时，读取RTC备份寄存器1的数据，如果为0x1688，则不需要通过串口重新设置日期与时间</span></span><br><span class="line">	<span class="keyword">if</span>(HAL_RTCEx_BKUPRead(&amp;hrtc,RTC_BKP_DR1) != <span class="number">0x1688</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;^_^^_^开始设置RTC的日期与时间^_^^_^\r\n\r\n&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		RTC_Date_Set(); <span class="comment">//设置日期</span></span><br><span class="line">		RTC_Time_Set(); <span class="comment">//设置时间</span></span><br><span class="line">		</span><br><span class="line">		HAL_RTCEx_BKUPWrite(&amp;hrtc,RTC_BKP_DR1,<span class="number">0x1688</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;^_^^_^RTC的日期与时间已设置！^_^^_^\r\n\r\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;重新设置的方法如下:\r\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;方法一：长按触摸按键2s以上；\r\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;方法二：系统断电，同时拔掉RTC电池。\r\n\r\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Calendar_Get</span></span><br><span class="line"><span class="comment">	* @brief  显示日历</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Calendar_Get</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//获取当前时间</span></span><br><span class="line">	HAL_RTC_GetTime(&amp;hrtc,MyRTC.pRTC_TimeStruct,RTC_FORMAT_BIN);</span><br><span class="line">	<span class="comment">//获取当前日期</span></span><br><span class="line">	HAL_RTC_GetDate(&amp;hrtc,MyRTC.pRTC_DateStruct,RTC_FORMAT_BIN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Calendar_Show</span></span><br><span class="line"><span class="comment">	* @brief  显示日历</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Calendar_Show</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//串口打印日期</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;当前时间为: %02u年%02d月%02d日(星期%s)  &quot;</span>, <span class="number">2000</span>+MyRTC.pRTC_DateStruct-&gt;Year,MyRTC.pRTC_DateStruct-&gt;Month,MyRTC.pRTC_DateStruct-&gt;Date,Week_Str[MyRTC.pRTC_DateStruct-&gt;WeekDay]);</span><br><span class="line">	<span class="comment">//串口打印时间</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%02u:%02u:%02u\r\n&quot;</span>,MyRTC.pRTC_TimeStruct-&gt;Hours,MyRTC.pRTC_TimeStruct-&gt;Minutes,MyRTC.pRTC_TimeStruct-&gt;Seconds);</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Input_RTC_SetValue</span></span><br><span class="line"><span class="comment">	* @brief  输入RTC设置值</span></span><br><span class="line"><span class="comment">	* @param  MAX_Value -&gt; 输入最大值</span></span><br><span class="line"><span class="comment">	* @retval SetValue  -&gt; 返回输入字符对应的数值     </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> <span class="title function_">Input_RTC_SetValue</span><span class="params">(<span class="type">uint8_t</span> MAX_Value)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> SetValue = <span class="number">0</span>;  <span class="comment">//返回值</span></span><br><span class="line">	<span class="type">uint8_t</span> Value_Arr[<span class="number">2</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="type">uint8_t</span> Index = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//以等待方式从串口接收2个有效字符</span></span><br><span class="line">	<span class="keyword">while</span>(Index &lt; <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//等待接收串口数据</span></span><br><span class="line">		Value_Arr[Index++] = getchar();</span><br><span class="line">		<span class="comment">//校验字符有效性</span></span><br><span class="line">		<span class="keyword">if</span>((Value_Arr[Index <span class="number">-1</span>] &lt; <span class="string">&#x27;0&#x27;</span>) || (Value_Arr[Index <span class="number">-1</span>] &gt; <span class="string">&#x27;9&#x27;</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;请输入 0 到 9 之间的数字 --&gt;:\n&quot;</span>);</span><br><span class="line">			Index--;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//接收到的2个字符转化为数值</span></span><br><span class="line">	SetValue = (Value_Arr[<span class="number">0</span>] - <span class="string">&#x27;0&#x27;</span>)*<span class="number">10</span> + (Value_Arr[<span class="number">1</span>] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//校验数值有效行</span></span><br><span class="line">	<span class="keyword">if</span>(SetValue &gt; MAX_Value)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;请输入 0 到 %d 之间的数字\n&quot;</span>, MAX_Value);</span><br><span class="line">		SetValue = <span class="number">0xFF</span>; <span class="comment">//SetValue设置为无效数据</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//返回数据</span></span><br><span class="line">	<span class="keyword">return</span> SetValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   RTC_Date_Set</span></span><br><span class="line"><span class="comment">	* @brief  RTC日期设置</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None  </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">RTC_Date_Set</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  RTC_DateTypeDef RTC_DateStruct_SetValue;</span><br><span class="line">	<span class="type">uint8_t</span> SetValue;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;=========================日期设置==================\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入年份(00-99): 20\n&quot;</span>);</span><br><span class="line">	SetValue = <span class="number">0xFF</span>;</span><br><span class="line">	<span class="keyword">while</span> (SetValue == <span class="number">0xFF</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		SetValue = Input_RTC_SetValue(<span class="number">99</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;年份被设置为:  20%02u\n&quot;</span>, SetValue);</span><br><span class="line">	RTC_DateStruct_SetValue.Year = SetValue;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入月份(01-12):  \n&quot;</span>);</span><br><span class="line">	SetValue = <span class="number">0xFF</span>;</span><br><span class="line">	<span class="keyword">while</span> (SetValue == <span class="number">0xFF</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		SetValue = Input_RTC_SetValue(<span class="number">12</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(SetValue == <span class="number">0x00</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;月份不能设置为0，请重新输入月份：\r\n&quot;</span>);</span><br><span class="line">			SetValue = <span class="number">0xFF</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;月份被设置为:  %02u\n&quot;</span>, SetValue);</span><br><span class="line">	RTC_DateStruct_SetValue.Month = SetValue;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入日期(01-31):  \n&quot;</span>);</span><br><span class="line">	SetValue = <span class="number">0xFF</span>;</span><br><span class="line">	<span class="keyword">while</span> (SetValue == <span class="number">0xFF</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		SetValue = Input_RTC_SetValue(<span class="number">31</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(SetValue == <span class="number">0x00</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;日期不能设置为0，请重新输入日期：\r\n&quot;</span>);	</span><br><span class="line">			SetValue = <span class="number">0xFF</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;日期被设置为:  %02u\r\n&quot;</span>, SetValue);</span><br><span class="line">	RTC_DateStruct_SetValue.Date = SetValue;</span><br><span class="line">	<span class="comment">//设置日期</span></span><br><span class="line">	HAL_RTC_SetDate(&amp;hrtc,&amp;RTC_DateStruct_SetValue,RTC_FORMAT_BIN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   RTC_Time_Set</span></span><br><span class="line"><span class="comment">	* @brief  RTC时间设置</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None  </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">RTC_Time_Set</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	RTC_TimeTypeDef RTC_TimeStruct_SetValue;</span><br><span class="line">	<span class="type">uint8_t</span> SetValue;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;=========================时间设置==================\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入时钟(00-23):  \n&quot;</span>);</span><br><span class="line">	SetValue = <span class="number">0xFF</span>;</span><br><span class="line">	<span class="keyword">while</span> (SetValue == <span class="number">0xFF</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		SetValue = Input_RTC_SetValue(<span class="number">23</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;时钟被设置为:  %02u\n&quot;</span>, SetValue);</span><br><span class="line">	RTC_TimeStruct_SetValue.Hours = SetValue;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入分钟(00-59):  \n&quot;</span>);</span><br><span class="line">	SetValue = <span class="number">0xFF</span>;</span><br><span class="line">	<span class="keyword">while</span> (SetValue == <span class="number">0xFF</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		SetValue = Input_RTC_SetValue(<span class="number">59</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;分钟被设置为:  %02u\n&quot;</span>, SetValue);</span><br><span class="line">	RTC_TimeStruct_SetValue.Minutes = SetValue;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入秒钟(00-59):  \n&quot;</span>);</span><br><span class="line">	SetValue = <span class="number">0xFF</span>;</span><br><span class="line">	<span class="keyword">while</span> (SetValue == <span class="number">0xFF</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		SetValue = Input_RTC_SetValue(<span class="number">59</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;秒钟被设置为:  %02u\n&quot;</span>, SetValue);</span><br><span class="line">	RTC_TimeStruct_SetValue.Seconds = SetValue;</span><br><span class="line">	<span class="comment">//设置时间</span></span><br><span class="line">	HAL_RTC_SetTime(&amp;hrtc,&amp;RTC_TimeStruct_SetValue,RTC_FORMAT_BIN);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="PUBLIC"><a href="#PUBLIC" class="headerlink" title="PUBLIC"></a>PUBLIC</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __PUBLIC_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __PUBLIC_H_</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public define-------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SoftWare_Version 	(float)1.0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>	huart_debug		huart1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//枚举类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  BIT0 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">0</span>),  </span><br><span class="line">	BIT1 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">1</span>),  </span><br><span class="line">	BIT2 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">2</span>),  </span><br><span class="line">	BIT3 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">3</span>),  </span><br><span class="line">	BIT4 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">4</span>),</span><br><span class="line">	BIT5 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">5</span>),</span><br><span class="line">	BIT6 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">6</span>),</span><br><span class="line">	BIT7 = (<span class="type">uint8_t</span>)(<span class="number">0x01</span> &lt;&lt; <span class="number">7</span>),</span><br><span class="line">&#125;BIT_t;</span><br><span class="line"><span class="comment">//定义枚举类型 -&gt; TRUE/FALSE位</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  FALSE = <span class="number">0U</span>, </span><br><span class="line">  TRUE = !FALSE</span><br><span class="line">&#125; FlagStatus_t;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  FAILED = <span class="number">0U</span>, </span><br><span class="line">  PASSED = !FAILED</span><br><span class="line">&#125; TestStatus_t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******预编译宏定义*******/</span></span><br><span class="line"><span class="comment">//#define Monitor_Run_Code   //代码运行监控器 </span></span><br><span class="line"><span class="comment">//#define Hardware_TEST      //硬件测试</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">  * @file    Public</span></span><br><span class="line"><span class="comment">  * @author  6+1</span></span><br><span class="line"><span class="comment">  * @date    2023-09-21 19:56:59</span></span><br><span class="line"><span class="comment">  * @brief   存放公共函数</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private define-------------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Memory_Clr</span><span class="params">(<span class="type">uint8_t</span>*,<span class="type">uint16_t</span>)</span>;   <span class="comment">//内存清除函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private function prototypes------------------------------------------------*/</span>      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   fputc</span></span><br><span class="line"><span class="comment">	* @brief  fputc映射物理串口</span></span><br><span class="line"><span class="comment">	* @param  ch -&gt; 待发送字符</span></span><br><span class="line"><span class="comment">	* @retval ch -&gt; 已发送字符      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">fputc</span><span class="params">(<span class="type">int</span> ch,FILE* f)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//通过查询的方式循环发送</span></span><br><span class="line">	HAL_UART_Transmit(&amp;huart_debug, (<span class="type">uint8_t</span> *)&amp;ch, <span class="number">1</span>, <span class="number">0x000A</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   fgetc</span></span><br><span class="line"><span class="comment">	* @brief  fgetc映射物理串口</span></span><br><span class="line"><span class="comment">	* @param  none</span></span><br><span class="line"><span class="comment">	* @retval ch -&gt; 已接收字符      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">fgetc</span><span class="params">(FILE * f)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uint8_t</span> ch = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//通过查询的方式等待接收</span></span><br><span class="line">  HAL_UART_Receive(&amp;huart_debug,&amp;ch, <span class="number">1</span>, <span class="number">0xffff</span>);</span><br><span class="line">	</span><br><span class="line">  <span class="keyword">return</span> ch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="回调函数与运行函数"><a href="#回调函数与运行函数" class="headerlink" title="回调函数与运行函数"></a>回调函数与运行函数</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  EXTI line detection callbacks.</span></span><br><span class="line"><span class="comment">  * @param  GPIO_Pin: Specifies the pins connected EXTI line</span></span><br><span class="line"><span class="comment">  * @retval None</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_EXTI_Callback</span><span class="params">(<span class="type">uint16_t</span> GPIO_Pin)</span></span><br><span class="line">&#123;	</span><br><span class="line">	<span class="keyword">if</span>(GPIO_Pin == KEY1_Pin)</span><br><span class="line">	&#123;</span><br><span class="line">		KEY1.KEY_Flag = TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   HAL_TIM_PeriodElapsedCallback</span></span><br><span class="line"><span class="comment">	* @brief  定时器中断回调函数</span></span><br><span class="line"><span class="comment">	* @param  *htim -&gt; 处理定时器的结构体指针</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_PeriodElapsedCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(htim-&gt;Instance == htim2.Instance)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//程序支持运行，指示灯间隔1s闪烁</span></span><br><span class="line">		<span class="keyword">if</span>(++Timer2.usMCU_Run_Timer &gt;= TIMER2_1S)</span><br><span class="line">		&#123;</span><br><span class="line">			Timer2.usMCU_Run_Timer = <span class="number">0</span>;</span><br><span class="line">			</span><br><span class="line">			LED.LED_Flip(LED1);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Run</span></span><br><span class="line"><span class="comment">	* @brief  系统运行</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Run</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	KEY1.KEY_Deteck();</span><br><span class="line">    <span class="keyword">if</span>(MyRTC.RTC_SetValue_Flag == TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		MyRTC.RTC_SetValue_Flag = FALSE;</span><br><span class="line">		MyRTC.Calendar_Set(); <span class="comment">//设置日历</span></span><br><span class="line">	&#125;	</span><br><span class="line">	MyRTC.Calendar_Get();  <span class="comment">//获取日历</span></span><br><span class="line">	MyRTC.Calendar_Show(); <span class="comment">//显示日历</span></span><br><span class="line">	<span class="comment">//延时1s</span></span><br><span class="line">	HAL_Delay(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="按键-1"><a href="#按键-1" class="headerlink" title="按键"></a>按键</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __KEY_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __KEY_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">uint8_t</span> <span class="keyword">volatile</span> KEY_Flag;  <span class="comment">//按键标志位</span></span><br><span class="line">    <span class="type">uint8_t</span> Click;  <span class="comment">//单击</span></span><br><span class="line">    <span class="type">uint8_t</span> Press;  <span class="comment">//长按</span></span><br><span class="line">    <span class="type">void</span> (*KEY_Deteck)(<span class="type">void</span>);  <span class="comment">//按键检测</span></span><br><span class="line">&#125; KEY_t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">extern</span> KEY_t KEY1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern function prototypes-------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY1_Detect</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//机械按键1检测</span></span><br><span class="line">KEY_t KEY1 = &#123;.KEY_Flag = FALSE,.Click = FALSE,.Press = FALSE,KEY1_Detect&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   KEY1_Detect</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  机械按键1检测</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY1_Detect</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (KEY1.KEY_Flag == TRUE)</span><br><span class="line">    &#123;</span><br><span class="line">        KEY1.Click = FALSE;</span><br><span class="line">        KEY1.Press = TRUE;</span><br><span class="line">		MyRTC.RTC_SetValue_Flag = TRUE;</span><br><span class="line">		<span class="comment">//长按2s重新设置RTC</span></span><br><span class="line">        <span class="comment">//消抖</span></span><br><span class="line">		HAL_Delay(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//按键长按检测</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">200</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//延时1秒</span></span><br><span class="line">            HAL_Delay(<span class="number">10</span>);</span><br><span class="line">            <span class="comment">//如果1s内，按键状态出现高电平，此时按键为单击，跳出循环</span></span><br><span class="line">            <span class="keyword">if</span>(HAL_GPIO_ReadPin( KEY1_GPIO_Port, KEY1_Pin) == GPIO_PIN_SET)</span><br><span class="line">            &#123;</span><br><span class="line">                KEY1.Click = TRUE;</span><br><span class="line">                KEY1.Press = FALSE;</span><br><span class="line">				MyRTC.RTC_SetValue_Flag = FALSE;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(KEY1.Click == TRUE)</span><br><span class="line">        &#123;</span><br><span class="line">			</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;检测到按键1点击\r\n&quot;</span>);</span><br><span class="line">			</span><br><span class="line">            LED.LED_Flip(LED1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(KEY1.Press == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			MyRTC.RTC_SetValue_Flag = TRUE;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;\r\n触摸按键1长按了2s，重新设置RTC的日期与时间。\r\n&quot;</span>);</span><br><span class="line">			HAL_RTCEx_BKUPWrite(&amp;hrtc,RTC_BKP_DR1,<span class="number">0x00</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">        <span class="comment">//清除按键状态</span></span><br><span class="line">		KEY1.KEY_Flag = FALSE;</span><br><span class="line">		KEY1.Click = FALSE;</span><br><span class="line">		KEY1.Press = FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h4><p>时钟选择LSI，不要选择LSE，选择LSE卡死在程序，按键检测函数不要放中断，会导致程序卡死，串口勾选接收与发送，多了一个接收定向函数。感谢旺哥帮我看了半个小时程序，不然又找不出问题。</p>
<h3 id="独立看门狗"><a href="#独立看门狗" class="headerlink" title="独立看门狗"></a>独立看门狗</h3><h4 id="程序功能-17"><a href="#程序功能-17" class="headerlink" title="程序功能"></a>程序功能</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGDok4ictwCCNaC3ZSV5WyFEukegztiasJGN77CXFQZJIcibj223FDtS3Zg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-25"><a href="#硬件电路-25" class="headerlink" title="硬件电路"></a>硬件电路</h4><p>无</p>
<h4 id="技术讲解-17"><a href="#技术讲解-17" class="headerlink" title="技术讲解"></a>技术讲解</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGcLvV2of0kGmuzVIXWOPggvYWcnZOvPT2ic9QkBqmzwoQR5C3QebQURg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGvdia6KqNsWbZRibjVbvJAd1zaxxvBglcdq2mLYqCfQhtG33na8D4KWRw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="HAL库函数-10"><a href="#HAL库函数-10" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGMiaEtsrxtWtib2WfFjEx1XrWRAQbtldYk4f7iaicqcwk8O1r1XOqGcxHwg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<stm32f1xx_hal_iwdg.h>



<h4 id="编程说明-17"><a href="#编程说明-17" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGsEFaZa0AqiaJQLbsIX03icuX03LmSTldQgS9WnprOQmJJsvYVN08FjRg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>独立看门狗超时时间计算：</p>
<p>LSI = 40kHz</p>
<p>超出时间 = (1/(40/32)) * 2500ms = 2s</p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGtwqicy6sHvXVqVAIiaoI8vP9kYdicgyp7vxTBg0SxKYxCqr7eibwDblGMQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGDc02NP2cicuxSkywgQ85QYIdLdxunHAxRoWiadFjWPibRS7gTuyTcjk8Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、MyIWDG结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGurkL5795MshsnASad2gK2DXZJMnnlgCicibkskib6GBY9PfQibMcax5vsw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、触摸按键1回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGGB2bwgRw07IXVeyibP5Z77MJOWYMg81s9j6yQc6dbdtE3SYPyia13KaA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-13"><a href="#6-1的程序-13" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置-11"><a href="#工程配置-11" class="headerlink" title="工程配置"></a>工程配置</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231007222325435.png" alt="image-20231007222325435"></p>
<h5 id="硬件电路-26"><a href="#硬件电路-26" class="headerlink" title="硬件电路"></a>硬件电路</h5><h5 id="软件代码-9"><a href="#软件代码-9" class="headerlink" title="软件代码"></a>软件代码</h5><p>按键代码看之前的就好了现在的按键代码都是这样弄，因为按键要消抖，延时不能放中断</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MYIWDG_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MYIWDG_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">uint8_t</span> FeedDog_Flag;  <span class="comment">//喂狗标志位</span></span><br><span class="line"></span><br><span class="line">    <span class="type">void</span>(*FeedDog)(<span class="type">void</span>);  <span class="comment">//喂狗</span></span><br><span class="line">&#125; MyIWDG_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> MyIWDG_t MyIWDG;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern function prototypes-------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">FeedDog</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">MyIWDG_t MyIWDG =</span><br><span class="line">&#123;</span><br><span class="line">    TRUE,</span><br><span class="line"></span><br><span class="line">    FeedDog</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* function prototypes--------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   FeedDog</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  喂狗</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">FeedDog</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HAL_IWDG_Refresh(&amp;hiwdg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  EXTI line detection callbacks.</span></span><br><span class="line"><span class="comment">  * @param  GPIO_Pin: Specifies the pins connected EXTI line</span></span><br><span class="line"><span class="comment">  * @retval None</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_EXTI_Callback</span><span class="params">(<span class="type">uint16_t</span> GPIO_Pin)</span></span><br><span class="line">&#123;	</span><br><span class="line">	<span class="keyword">if</span>(GPIO_Pin == KEY1_Pin)</span><br><span class="line">	&#123;</span><br><span class="line">		KEY1.KEY_Flag = TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>(KEY1.Click == TRUE)</span><br><span class="line">        &#123;</span><br><span class="line">			</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;检测到按键1点击\r\n&quot;</span>);</span><br><span class="line">			</span><br><span class="line">            <span class="comment">//清除喂狗标志位</span></span><br><span class="line">		    MyIWDG.FeedDog_Flag = FALSE;</span><br><span class="line">		    LED.LED_ON(LED2);</span><br><span class="line">		    <span class="built_in">printf</span>(<span class="string">&quot;\r\n停止喂狗，系统复位！\r\n\r\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Run</span></span><br><span class="line"><span class="comment">	* @brief  系统运行</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Run</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	KEY1.KEY_Deteck();</span><br><span class="line">    <span class="keyword">if</span>(MyIWDG.FeedDog_Flag == TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;喂狗，程序正常运行\r\n&quot;</span>);</span><br><span class="line">		MyIWDG.FeedDog();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">		HAL_Delay(<span class="number">1500</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="窗口看门狗"><a href="#窗口看门狗" class="headerlink" title="窗口看门狗"></a>窗口看门狗</h3><h4 id="程序功能-18"><a href="#程序功能-18" class="headerlink" title="程序功能"></a>程序功能</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZe0W7A7X7SHCbA06q8SgmaMAj73IJU52YROKEYdkCA9icV742K3cyiaEoUZuS9UheASE4QGYpEm8dTw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-18"><a href="#技术讲解-18" class="headerlink" title="技术讲解"></a>技术讲解</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGo4TrAPv6FObjLRaVwmhRq1iabqMbxbUBOq0kBAIgwmMV0kjECjus7Xg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcia8CJzUMXylnZic6bHia12kGhWrjY6GYeY94hbg2j5KMRbTmCGusRdFT5uVOlEYFFVOTz79VE9w23w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="HAL库函数-11"><a href="#HAL库函数-11" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZe0W7A7X7SHCbA06q8SgmaMy1iaZTMsLBxibo8a6VLiceHP0QtVia27eicUHwjmkZ3K6GLDwDmd3ZxsKMw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<stm32f1xx_hal_wwdg.h>



<h4 id="编程说明-18"><a href="#编程说明-18" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZe0W7A7X7SHCbA06q8SgmaMuKsrr4Glsya9TLBPo6LiciaJUVrda62HT0HrOeicRFbFz4YJxnvCW85iaQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZe0W7A7X7SHCbA06q8SgmaMATOvHm6uRT9WcNYO13QahiafAic055nwNT0rdp3rNeeSG3ZH9oDk0nHw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>窗口看门狗超时时间计算：</p>
<p>PCLK1 = 36MHz</p>
<p>超出时间 = (1/36000000) <em> 4096 </em> 8 * (63+1)us = 58.25ms</p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZe0W7A7X7SHCbA06q8SgmaMNTnNgyyFFiaSkibgJuDMZ0p61UZHqAhkFvc7K26TuqicicCEIzT9jmmMbQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZe0W7A7X7SHCbA06q8SgmaMibnXlxicKKmibfsDfEib6g2cvyEDaBc5lWJ7G4iaGoc8oPpzhwpBmFa7T9Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、MyWWDG结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZe0W7A7X7SHCbA06q8SgmaMLdnpCictn9rjSTWKjIpauriczWS0RlUnp1icvreP1iaYsiacSQEcIqPmEmQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、窗口看门狗提前唤醒中断回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZe0W7A7X7SHCbA06q8SgmaMlsLNYqYicGYE7UTTqCvFEzmjN4iapGhJx0RRxgZB8kAwiaFNibEyUTyvRA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-14"><a href="#6-1的程序-14" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置-12"><a href="#工程配置-12" class="headerlink" title="工程配置"></a>工程配置</h5><p>配置就是这样配，需要注意的是把LSE时钟那关了，不然看门狗的喂狗时间会不对，隔几秒复位一次，因为我的工程做过RTC所以是打开的，然后找了很久的bug才发现这个时钟。记得使能看门狗中断</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231008115149487.png" alt="image-20231008115149487"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231008115214286.png" alt="image-20231008115214286"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231008115224344.png" alt="image-20231008115224344"></p>
<h5 id="软件代码-10"><a href="#软件代码-10" class="headerlink" title="软件代码"></a>软件代码</h5><p>代码非常简单，跟上一个独立看门狗差不多，就多了个中断，因为是使用提前唤醒中断回调函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MYWWDG_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MYWWDG_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">uint8_t</span> FeedDog_Flag;  <span class="comment">//喂狗标志位</span></span><br><span class="line"></span><br><span class="line">    <span class="type">void</span>(*FeedDog)(<span class="type">void</span>);  <span class="comment">//喂狗</span></span><br><span class="line">&#125; MyWWDG_t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> MyWWDG_t MyWWDG;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern function prototypes-------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">FeedDog</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* function prototypes--------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">MyWWDG_t MyWWDG = </span><br><span class="line">&#123;</span><br><span class="line">  TRUE,</span><br><span class="line"></span><br><span class="line">  FeedDog</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * @name   FeedDog</span></span><br><span class="line"><span class="comment">    * @param  None</span></span><br><span class="line"><span class="comment">    * @retval None</span></span><br><span class="line"><span class="comment">    * @brief  喂狗</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">FeedDog</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  HAL_WWDG_Refresh(&amp;hwwdg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Peripheral_Set</span></span><br><span class="line"><span class="comment">	* @brief  外设设置</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Peripheral_Set</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;----此程序测试窗口看门狗----\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Initialization completed, system startup!\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Software version is V%.1f\r\n\r\n&quot;</span>,SoftWare_Version);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;程序功能：\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;上电后，系统正常运行，利用窗口看门狗提前唤醒中断回调函数喂狗。\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;单击触摸按键1，停止喂狗，系统重启！\r\n\r\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	Timer2.Timer2_Start_IT(); <span class="comment">//启动定时器6</span></span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">if</span>(KEY1.Click == TRUE)</span><br><span class="line">        &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;检测到按键点击&quot;</span>);</span><br><span class="line">			</span><br><span class="line">            <span class="comment">//清除喂狗标志位</span></span><br><span class="line">			MyWWDG.FeedDog_Flag = FALSE;</span><br><span class="line">			LED.LED_ON(LED2);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;\r\n停止喂狗，系统复位！\r\n\r\n&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @name   HAL_WWDG_EarlyWakeupCallback</span></span><br><span class="line"><span class="comment">  * @brief  窗口看门狗提前唤醒中断回调函数</span></span><br><span class="line"><span class="comment">  * @param  hwwdg : pointer to a WWDG_HandleTypeDef structure that contains</span></span><br><span class="line"><span class="comment">  *                the configuration information for the specified WWDG module.</span></span><br><span class="line"><span class="comment">  * @retval None</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_WWDG_EarlyWakeupCallback</span><span class="params">(WWDG_HandleTypeDef *hwwdg)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(MyWWDG.FeedDog_Flag == TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;喂狗\r\n&quot;</span>);</span><br><span class="line">		MyWWDG.FeedDog();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="低功耗模式"><a href="#低功耗模式" class="headerlink" title="低功耗模式"></a>低功耗模式</h3><h4 id="程序功能-19"><a href="#程序功能-19" class="headerlink" title="程序功能"></a>程序功能</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc2KnyrF0LoB9hAiaOYibL7PJicHD8ibaeoNZTG82mbj3bzONbuvVthzVRuoc8mCufDmZxKbts16f892w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-19"><a href="#技术讲解-19" class="headerlink" title="技术讲解"></a>技术讲解</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc2KnyrF0LoB9hAiaOYibL7PJvsgKibibuwsibt5GXbiaHTbHmNFWzrgx7ccgsKiccHI8Yic2uwxfJDzRCJqw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="HAL库函数-12"><a href="#HAL库函数-12" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc2KnyrF0LoB9hAiaOYibL7PJeUkWF13S9NQF5sUNekD0bI5viax0NuibOOom4uvOIQ5ThImoiaXKxebPQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<stm32f1xx_hal_pwr.h>



<h4 id="编程说明-19"><a href="#编程说明-19" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc2KnyrF0LoB9hAiaOYibL7PJibHJHhD0Xq3Gfu5m41h8Ria3tr1dMW0sqK9PSBAa8pKve1PdmhjXeo4w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc2KnyrF0LoB9hAiaOYibL7PJWWibrVPxrhNvBfgPwIbog56R9sccsibsVIJoqrm79mB8ONl0JibTiaF7Ag/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc2KnyrF0LoB9hAiaOYibL7PJpEDK68NR5oQLstDDJGbg5Cf4ALpTg45ohIMDgxzXkNmvDSEmiate6Mw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、LowPowerConsumption结构体封装</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZc2KnyrF0LoB9hAiaOYibL7PJtvcPWIDvfIE5bRVagNxicD6PGLGymmKE10Q1rEdFqEeh7rQWmo1dfSQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、进入睡眠模式函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfcdEQtlmtVzdJ6NiaI98XZul9DxRHZTTeGw3EHVQiavictGsibic4XeVibcxRxFuY0nR3J7NiaxxbeWrepQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-15"><a href="#6-1的程序-15" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h5 id="工程配置-13"><a href="#工程配置-13" class="headerlink" title="工程配置"></a>工程配置</h5><p>配按键跟LED灯的口就行了，按键使用中断，还有一个定时器2</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231008181914006.png" alt="image-20231008181914006"></p>
<h5 id="硬件电路-27"><a href="#硬件电路-27" class="headerlink" title="硬件电路"></a>硬件电路</h5><p>无</p>
<h5 id="软件代码-11"><a href="#软件代码-11" class="headerlink" title="软件代码"></a>软件代码</h5><p>注意自己按键的中断通道，不要弄错通道了，程序弄好也可以自己试试用万用表测测电流看看是多少。</p>
<h6 id="LOWPOWRECONSUMPTION"><a href="#LOWPOWRECONSUMPTION" class="headerlink" title="LOWPOWRECONSUMPTION"></a>LOWPOWRECONSUMPTION</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LOWPOWRECONSUMPTION_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LOWPOWRECONSUMPTION_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">//标志位</span></span><br><span class="line">    <span class="type">uint8_t</span> Enter_Sleep_Mode_Flag;</span><br><span class="line">    <span class="type">uint8_t</span> Enter_Stop_Mode_Flag;</span><br><span class="line">    <span class="type">uint8_t</span> Enter_Standby_Mode_Flag;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span>(*Sleep_Mode)(<span class="type">void</span>);  <span class="comment">//睡眠模式</span></span><br><span class="line">    <span class="type">void</span>(*Stop_Mode)(<span class="type">void</span>);  <span class="comment">//停机模式</span></span><br><span class="line">    <span class="type">void</span>(*Standby_Mode)(<span class="type">void</span>);  <span class="comment">//待机模式</span></span><br><span class="line">&#125; LowPowerConsumption_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> LowPowerConsumption_t LowPowerConsumption;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern function prototypes-------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">SystemClock_Config</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Sleep_Mode</span><span class="params">()</span>;  <span class="comment">//睡眠模式</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Stop_Mode</span><span class="params">()</span>;  <span class="comment">//停机模式</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Standby_Mode</span><span class="params">()</span>;  <span class="comment">//待机模式</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">LowPowerConsumption_t LowPowerConsumption =</span><br><span class="line">&#123;</span><br><span class="line">    .Enter_Sleep_Mode_Flag = FALSE,</span><br><span class="line">    .Enter_Stop_Mode_Flag = FALSE,</span><br><span class="line">    .Enter_Standby_Mode_Flag = FALSE,</span><br><span class="line"></span><br><span class="line">    Sleep_Mode,</span><br><span class="line">    Stop_Mode,</span><br><span class="line">    Standby_Mode</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* function prototypes--------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   Sleep_Mode</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  睡眠模式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Sleep_Mode</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/***Note:任意中断都可以将系统从睡眠模式中唤醒***/</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//关闭Systick与定时器中断，否则，进入睡眠模式后立马被唤醒</span></span><br><span class="line">    HAL_SuspendTick();</span><br><span class="line">    HAL_TIM_Base_Stop_IT(&amp;htim2);</span><br><span class="line">    <span class="comment">//关闭按键1到3的外部中断，只允许按键4中断退出睡眠模式</span></span><br><span class="line">    HAL_NVIC_DisableIRQ(EXTI9_5_IRQn);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进入睡眠模式</span></span><br><span class="line">    HAL_PWR_EnterSLEEPMode(PWR_MAINREGULATOR_ON,PWR_SLEEPENTRY_WFI);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//恢复中断</span></span><br><span class="line">    HAL_ResumeTick();</span><br><span class="line">    HAL_TIM_Base_Start_IT(&amp;htim2);</span><br><span class="line">    HAL_NVIC_EnableIRQ(EXTI9_5_IRQn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   Stop_Mode</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  停机模式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Stop_Mode</span><span class="params">()</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/***Note:外部中断可将系统从停机模式中唤醒***/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭按键1到3的外部中断，只允许按键4中断退出停机模式</span></span><br><span class="line">    HAL_NVIC_DisableIRQ(EXTI9_5_IRQn);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进入停机模式</span></span><br><span class="line">    HAL_PWR_EnterSTOPMode(PWR_LOWPOWERREGULATOR_ON,PWR_STOPENTRY_WFI);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//退出停止模式时，HSI RC振荡器被选为系统时钟</span></span><br><span class="line">	<span class="comment">//系统时钟需要重新初始化</span></span><br><span class="line">    SystemClock_Config();</span><br><span class="line">    <span class="comment">//恢复中断</span></span><br><span class="line">    HAL_NVIC_EnableIRQ(EXTI9_5_IRQn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   Standby_Mode</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  待机模式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Standby_Mode</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HAL_PWR_EnterSTANDBYMode();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="KEY"><a href="#KEY" class="headerlink" title="KEY"></a>KEY</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __KEY_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __KEY_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">uint8_t</span> <span class="keyword">volatile</span> KEY_Flag;  <span class="comment">//按键标志位</span></span><br><span class="line">    <span class="type">uint8_t</span> Click;  <span class="comment">//单击</span></span><br><span class="line">    <span class="type">uint8_t</span> Press;  <span class="comment">//长按</span></span><br><span class="line">    <span class="type">void</span> (*KEY_Deteck)(<span class="type">void</span>);  <span class="comment">//按键检测</span></span><br><span class="line">&#125; KEY_t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern variables-----------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> KEY_t KEY1;</span><br><span class="line"><span class="keyword">extern</span> KEY_t KEY2;</span><br><span class="line"><span class="keyword">extern</span> KEY_t KEY3;</span><br><span class="line"><span class="keyword">extern</span> KEY_t KEY4;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* extern function prototypes-------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">  * @file    KEY</span></span><br><span class="line"><span class="comment">  * @author  6+1</span></span><br><span class="line"><span class="comment">  * @date    2023-09-22 20:14:56</span></span><br><span class="line"><span class="comment">  * @brief   存放按键函数</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyApplication.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private variables----------------------------------------------------------*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY1_Detect</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//机械按键1检测</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY2_Detect</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//机械按键2检测</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY3_Detect</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//机械按键3检测</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY4_Detect</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//机械按键4检测</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Public variables-----------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">//结构体类型定义</span></span><br><span class="line">KEY_t KEY1 = &#123;.KEY_Flag = FALSE,.Click = FALSE,.Press = FALSE,KEY1_Detect&#125;;</span><br><span class="line">KEY_t KEY2 = &#123;.KEY_Flag = FALSE,.Click = FALSE,.Press = FALSE,KEY2_Detect&#125;;</span><br><span class="line">KEY_t KEY3 = &#123;.KEY_Flag = FALSE,.Click = FALSE,.Press = FALSE,KEY3_Detect&#125;;</span><br><span class="line">KEY_t KEY4 = &#123;.KEY_Flag = FALSE,.Click = FALSE,.Press = FALSE,KEY4_Detect&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* function prototypes--------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   KEY1_Detect</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  机械按键1检测</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY1_Detect</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (KEY1.KEY_Flag == TRUE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;检测到KEY1按下!\r\n&quot;</span>);</span><br><span class="line">        LED.LED_ON(LED2);</span><br><span class="line">        KEY1.Click = FALSE;</span><br><span class="line">        KEY1.Press = TRUE;</span><br><span class="line">        <span class="comment">//消抖</span></span><br><span class="line">		HAL_Delay(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//按键长按检测</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//延时1秒</span></span><br><span class="line">            HAL_Delay(<span class="number">10</span>);</span><br><span class="line">            <span class="comment">//如果1s内，按键状态出现高电平，此时按键为单击，跳出循环</span></span><br><span class="line">            <span class="keyword">if</span>(HAL_GPIO_ReadPin( KEY1_GPIO_Port, KEY1_Pin) == GPIO_PIN_SET)</span><br><span class="line">            &#123;</span><br><span class="line">                KEY1.Click = TRUE;</span><br><span class="line">                KEY1.Press = FALSE;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;KEY1提前释放,系统正常运行！\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(KEY1.Click == TRUE)</span><br><span class="line">        &#123;		</span><br><span class="line">            </span><br><span class="line">			LowPowerConsumption.Enter_Sleep_Mode_Flag = FALSE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(KEY1.Press == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			LowPowerConsumption.Enter_Sleep_Mode_Flag = TRUE; </span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">//清除按键状态</span></span><br><span class="line">		KEY1.KEY_Flag = FALSE;</span><br><span class="line">		KEY1.Click = FALSE;</span><br><span class="line">		KEY1.Press = FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   KEY2_Detect</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  机械按键2检测</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY2_Detect</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (KEY2.KEY_Flag == TRUE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;检测到KEY2按下!\r\n&quot;</span>);</span><br><span class="line">        LED.LED_ON(LED2);</span><br><span class="line">        KEY2.Click = FALSE;</span><br><span class="line">        KEY2.Press = TRUE;</span><br><span class="line">        <span class="comment">//消抖</span></span><br><span class="line">		HAL_Delay(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//按键长按检测</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//延时</span></span><br><span class="line">            HAL_Delay(<span class="number">20</span>);</span><br><span class="line">            <span class="comment">//如果1s内，按键状态出现高电平，此时按键为单击，跳出循环</span></span><br><span class="line">            <span class="keyword">if</span>(HAL_GPIO_ReadPin(KEY2_GPIO_Port,KEY2_Pin) == GPIO_PIN_SET)</span><br><span class="line">            &#123;</span><br><span class="line">                KEY2.Click = TRUE;</span><br><span class="line">                KEY2.Press = FALSE;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(KEY2.Click == TRUE)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;KEY2提前释放,系统正常运行！\r\n&quot;</span>);</span><br><span class="line">			LowPowerConsumption.Enter_Stop_Mode_Flag = FALSE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(KEY2.Press == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">            LowPowerConsumption.Enter_Stop_Mode_Flag = TRUE; </span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//清除按键状态</span></span><br><span class="line">		KEY2.KEY_Flag = FALSE;</span><br><span class="line">		KEY2.Click = FALSE;</span><br><span class="line">		KEY2.Press = FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   KEY3_Detect</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  机械按键3检测</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY3_Detect</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (KEY3.KEY_Flag == TRUE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;检测到KEY3按下!\r\n&quot;</span>);</span><br><span class="line">		LED.LED_ON(LED2);</span><br><span class="line">        KEY3.Click = FALSE;</span><br><span class="line">        KEY3.Press = TRUE;</span><br><span class="line">        <span class="comment">//消抖</span></span><br><span class="line">		HAL_Delay(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//触摸按键长按检测</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//延时</span></span><br><span class="line">            HAL_Delay(<span class="number">10</span>);</span><br><span class="line">            <span class="comment">//如果1s内，按键状态出现高电平，此时按键为单击，跳出循环</span></span><br><span class="line">            <span class="keyword">if</span>(HAL_GPIO_ReadPin(KEY3_GPIO_Port,KEY3_Pin) == GPIO_PIN_SET)</span><br><span class="line">            &#123;</span><br><span class="line">                KEY3.Click = TRUE;</span><br><span class="line">                KEY3.Press = FALSE;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(KEY3.Click == TRUE)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;KEY3提前释放,系统正常运行！\r\n&quot;</span>);</span><br><span class="line">			LowPowerConsumption.Enter_Standby_Mode_Flag = FALSE;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(KEY3.Press == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			LowPowerConsumption.Enter_Standby_Mode_Flag = TRUE; </span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//清除按键状态</span></span><br><span class="line">		KEY3.KEY_Flag = FALSE;</span><br><span class="line">		KEY3.Click = FALSE;</span><br><span class="line">		KEY3.Press = FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      * @name   KEY4_Detect</span></span><br><span class="line"><span class="comment">      * @param  None</span></span><br><span class="line"><span class="comment">      * @retval None</span></span><br><span class="line"><span class="comment">      * @brief  机械按键4检测</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">KEY4_Detect</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (KEY4.KEY_Flag == TRUE)</span><br><span class="line">    &#123;</span><br><span class="line">        KEY4.Click = TRUE;</span><br><span class="line">        <span class="comment">//消抖</span></span><br><span class="line">		HAL_Delay(<span class="number">20</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;检测到按键4按下\r\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">		KEY4.KEY_Flag = FALSE;</span><br><span class="line">		KEY4.Click = FALSE;</span><br><span class="line">		KEY4.Press = FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************************</span></span><br><span class="line"><span class="comment">  End Of File</span></span><br><span class="line"><span class="comment">********************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="运行函数"><a href="#运行函数" class="headerlink" title="运行函数"></a>运行函数</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Peripheral_Set</span></span><br><span class="line"><span class="comment">	* @brief  外设设置</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Peripheral_Set</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;----此程序测试STM32低功耗模式----\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Initialization completed, system startup!\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Software version is V%.1f\r\n\r\n&quot;</span>,SoftWare_Version);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;长按KEY1超过1s,系统进入睡眠模式！\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;长按KEY2超过1s,系统进入停机模式！\r\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;长按KEY3超过1s,系统进入待机模式！\r\n\r\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	Timer2.Timer2_Start_IT(); <span class="comment">//启动定时器2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	* @name   Run</span></span><br><span class="line"><span class="comment">	* @brief  系统运行</span></span><br><span class="line"><span class="comment">	* @param  None</span></span><br><span class="line"><span class="comment">	* @retval None      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Run</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	</span><br><span class="line">	KEY1.KEY_Deteck();</span><br><span class="line">	KEY2.KEY_Deteck();</span><br><span class="line">	KEY3.KEY_Deteck();</span><br><span class="line">	KEY4.KEY_Deteck();</span><br><span class="line">	</span><br><span class="line">	<span class="type">uint8_t</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//延时1s，期间间隔50ms检测是否需要进入低功耗模式</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">20</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//进入睡眠模式</span></span><br><span class="line">		<span class="keyword">if</span>(LowPowerConsumption.Enter_Sleep_Mode_Flag == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			LowPowerConsumption.Enter_Sleep_Mode_Flag = FALSE;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;系统进入睡眠模式,通过KEY4按键唤醒\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">			LowPowerConsumption.Sleep_Mode();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//进入停机模式</span></span><br><span class="line">		<span class="keyword">if</span>(LowPowerConsumption.Enter_Stop_Mode_Flag == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			LowPowerConsumption.Enter_Stop_Mode_Flag = FALSE;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;系统进入停机模式,通过KEY4按键唤醒\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">			LowPowerConsumption.Stop_Mode();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//进入待机模式</span></span><br><span class="line">		<span class="keyword">if</span>(LowPowerConsumption.Enter_Standby_Mode_Flag == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			LowPowerConsumption.Enter_Standby_Mode_Flag = FALSE;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;系统进入待机模式，通过复位按键唤醒\r\n&quot;</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;待机模式,外设不受STM32控制,系统功耗可能增加：\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">			LowPowerConsumption.Standby_Mode();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//延时50ms</span></span><br><span class="line">		HAL_Delay(<span class="number">50</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;系统正常运行\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  EXTI line detection callbacks.</span></span><br><span class="line"><span class="comment">  * @param  GPIO_Pin: Specifies the pins connected EXTI line</span></span><br><span class="line"><span class="comment">  * @retval None</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_EXTI_Callback</span><span class="params">(<span class="type">uint16_t</span> GPIO_Pin)</span></span><br><span class="line">&#123;	</span><br><span class="line">	  <span class="keyword">switch</span>(GPIO_Pin)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> KEY1_Pin: KEY1.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY2_Pin: KEY2.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY3_Pin: KEY3.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> KEY4_Pin: KEY4.KEY_Flag = TRUE; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:<span class="built_in">printf</span>(<span class="string">&quot;错误 - 外部中断回调函数中，触摸按键键值错误！\r\n\r\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="万用表测单片机电流"><a href="#万用表测单片机电流" class="headerlink" title="万用表测单片机电流"></a>万用表测单片机电流</h3><p>我们单片机的是直流电流</p>
<p>开启万用表，调到测试直流电流200毫安的地方，黑笔接公共端，红笔接200毫安的端口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231008175409474.png" alt="image-20231008175409474"></p>
<p>STLINK需要连接电源，把STLINK连接单片机3.3V的线拔掉</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231008180557201.png" alt="image-20231008180557201"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231008180456184.png" alt="image-20231008180456184"></p>
<p>红笔接电流+极，黑笔接电流负极</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231008175355803.png" alt="image-20231008175355803"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\Y\AppData\Roaming\Typora\typora-user-images\image-20231008180922737.png" alt="image-20231008180922737"></p>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ol>
<li>根据待测电路的电流范围，选择适当的电流档位。如果电流不确定，可以从最大档位开始，然后逐渐减小档位。在选择电流档位时，初始选择较大的档位，再逐渐调整到适合电流范围的档位。选择过小的档位可能导致测量不准确或对万用表造成损坏。</li>
</ol>
<p>由于我们测试的单片机我是知道电流不大，要是测试其他东西自己不清楚的就直接用20A就好了</p>
<p>万用表是一种常见的电测量仪器，通常可以用来测量电压、电流和电阻等参数。要使用万用表来测量电流，需要将万用表的测量功能切换到电流档位，并连接正确的电路。</p>
<p>以下是一般测量电流的步骤：</p>
<ol>
<li>确保被测电路处于断开状态，以免损坏万用表或产生危险。</li>
<li>找到万用表上的电流测量插孔或端口。通常，它标有符号”A”表示电流测量。</li>
<li>将测量插头插入电流测量插孔。</li>
<li>根据待测电路的电流范围，选择适当的电流档位。如果电流不确定，可以从最大档位开始，然后逐渐减小档位。</li>
<li>如果万用表上有多个电流档位，选择最接近待测电流的一个档位。</li>
<li>断开电路中的连接，将万用表的两个探头连接到待测电路的两个断开处。</li>
<li>注意万用表的极性，确保正负极正确连接。</li>
<li>在合适的测量环境下，重新连接待测电路。电流将通过万用表流过，万用表将测量并显示电流值。</li>
</ol>
<p>请注意以下几点：</p>
<ul>
<li>在选择电流档位时，初始选择较大的档位，再逐渐调整到适合电流范围的档位。选择过小的档位可能导致测量不准确或对万用表造成损坏。</li>
<li>尽量避免测量过大的电流，以免超出万用表的额定测量范围，引发故障或安全风险。</li>
<li>如果待测电流是交流电流，需要注意万用表的测量范围是否包括交流电流。</li>
<li>在进行电流测量之前，最好参考万用表的使用手册或说明书，以了解特定仪器的操作方法和注意事项。</li>
</ul>
<p>请谨慎操作，确保安全并正确使用万用表进行电流测量。</p>
<h3 id="在线程序升级-IAP"><a href="#在线程序升级-IAP" class="headerlink" title="在线程序升级(IAP)"></a>在线程序升级(IAP)</h3><h4 id="程序功能-20"><a href="#程序功能-20" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、准备了3个程序，1个Boot引导程序+2个APP应用程序</p>
<p>2、Boot引导程序负责将APP应用程序写入内部FLASH，然后跳转到APP应用程序</p>
<p>3、APP应用程序通过软件复位也可以回到Boot引导程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMKpNDHqqsEEXyqNM5M5f176nYjg1kOEsCP4UpiaZbViaUXhOeaQDQibdUQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<Boot程序上电输出>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CM2kuF1E0YabqjGr2qkunKroxT1UXceM9qX3f8MhCyKoPWsXVpSTbOsA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>&lt;升级程序并跳转至APP&gt;</p>
<h4 id="硬件电路-28"><a href="#硬件电路-28" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMfzKicCgiasVWNN1xKVHGbdJ031oS3KYOOM3y0mTK71Wfj3hd9QvibibDaw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-20"><a href="#技术讲解-20" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>一、编程技术</p>
<p>1、ICP</p>
<p>英文全称 - In  Circuit Programming，即在线电路编程。</p>
<p>需要将芯片取出，用专门的烧录器进行编程， 传统单片机编程模式。</p>
<p>2、ISP</p>
<p>英文全称 - In Syetem Programming，即在线系统编程。</p>
<p>可以在电路板上，通过接口对芯片编程 ，当前绝大部分单片机都支持此编程模式。</p>
<p>3、IAP</p>
<p>英文全称 - In Application Programming，即在线应用编程。</p>
<p>可以使用应用程序对芯片进行编程，方便远程升级，部分单片机支持此编程模式。</p>
<p>二、普通STM32程序运行过程</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMogFFSKlpqD4eQg3hIXFlqwrGUmdqibgS6NrRFuYiaEBSN6uuUUTrtK8g/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>&lt;图片来源于网络&gt;</p>
<p>三、带IAP升级的STM32程序运行过程</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMXQ2uGKJKENfnMDhXt6JP6JlOmRDmHLhvUibOHmpnO8MMoHoAMkfauNA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>&lt;图片来源于网络&gt;</p>
<p>四、Boot程序设计注意事项</p>
<p>1、APP应用程序数据格式采用Bin文件，因为HEX文件包含地址等信息，而Bin文件只包含数据，不需要额外处理</p>
<p>2、APP应用程序数据传输方式没硬性要求，可以采用有线通信(UART,SD卡，USB等)，也可以采用无线通信(蓝牙，GPRS，4G等)，实战代码采用UART</p>
<p>、APP应用数据可以分包传输，也可以一次性传输。 一次性传输方便代码小的APP，因为数据需要存放在RAM； 分包传输，对RAM要求低，同时，无线传输时，减小丢包的可能。 实战代码使用串口工具一次性传输</p>
<p>4、跳转至APP应用程序前，清除所有中断标志，关闭所有中断，否则，可能出现死机。</p>
<p>五、APP应用程序设计注意事项</p>
<p>1、先按正常情况调试好应用程序，再经过设置生成可供IAP升级的应用程序</p>
<p>2、设置第一步，ROM地址</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMQVmTOg9U3a3OkowJueBTqGBXW41eNY0nNwTkvT1IjFhHAbGfS4xibLQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>IROM1：start  = FLASH_BASE+预留给Boot程序尺寸 ，为了方便Boot代码擦写FLASH，要求进行页对齐(1k/2k)， 预留给Boot程序尺寸为2k的整数倍， 比如32k，64k等</p>
<p>IROM1：Size = 芯片FLASH总尺寸 - 预留给Boot程序尺寸</p>
<p>3、设置第二步，中断向量表的偏移地址</p>
<p>Note：必须设置ok，否则APP应用程序无法执行中断程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMwLazR33FNjUMkPuFibmPO4tIS0RCOPTLWRnzm1z3GJb2l6mwNtLZ2mA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、利用Keil软件自带的工具生产Bin文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMdTlclBic0Lxa2xVRnqC1c8DXiarMS69RYibHB7NQgEJqpMicTib0ibS7vPkw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>命令格式：C:\Keil_v5\ARM\ARMCC\bin\fromelf.exe —bin -o IAP-APP1.bin IAP-APP1\IAP-APP1.axf</p>
<p>注意：命令不要包含中文与空格</p>
<h4 id="HAL库函数-13"><a href="#HAL库函数-13" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CM0H8sxR5RUr0MnApbLic9VhBpib35UC0gj4NMlLQuALAPcTSlckaePcHQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<stm32f1xx_hal_flash.h>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CM3URFNVEYaicaPdKRsGWA0oIDMNK1btDDibDn4CrdqQ5KaLPfphWiatjeQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<stm32f1xx_hal_flash_ex.h>



<h4 id="编程说明-20"><a href="#编程说明-20" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMKkkudNINic01P1GVeX0XqYm6l5VSMGx504Z080IwKgSTjPwW3IHyfpg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>&lt;串口&gt;</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMrDPAxZGXrKS2Ncj65naDgmpnUJwfk9qKV1kL0jh3dJlDunm4lYhjHw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<NVIC>



<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMx7UNIoVjqemIKeEM6RcdnZajF2ib63LokicWr80F9ldBzALt8NKRibhqQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CM2MyAwoqsC1nYuhRsGO2iaef0KCaZSeqczt8xpdgSibWFOiajaEKfY7lJg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、FLASH结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMN7s82FiaJOx88OibBrd6pamOf5GDsvbKqhK4Hjy4JLl4MyQDice47qSbA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、FLASH写页面函数(带校验)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CM2kTaWQ2uRZ50h0tJWCUQmjWj44owXKm4drS37EQRdXshbYpv5Hxmxg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMNIK71vgkHQXNJY4bwAZGleCjicHJysyofdVRS69OAhnFia5f43QOyx4A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>6、IAP结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CMT6FI3g1vkS3CFuurBSNhJgGeO6KRsryMia1UlIvicSaeUaUhx2lSR3rQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>7、写APP应用程序函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNHlrxlVyIA93Af0dwv8CM9Uh4N2Cfz76Q6vcKr60x1NbDBw35dwe14ibkuHBKpabKZxZO3KCjrsQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-16"><a href="#6-1的程序-16" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><p>感觉现在用不上，用上的时候再弄吧</p>
<h3 id="CAN通信"><a href="#CAN通信" class="headerlink" title="CAN通信"></a>CAN通信</h3><h4 id="程序功能-21"><a href="#程序功能-21" class="headerlink" title="程序功能"></a>程序功能</h4><p>程序一：CAN工作模式 - 环回模式</p>
<p>说明：只需一块开发板，即可测试CAN的收发功能</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRv2qM6p6UHomswArrgW1gQbk8bXvsL8UXty4VMkNzCScINDqILxRpV0Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>程序二：CAN工作模式 - 正常模式</p>
<p>说明：至少两块开发板，组成CAN总线系统，测试CAN的收发功能</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRvVFlGPmnq4ibONsmBOiaGv9ORSScXqoEYvYnm8CktpL46nOK5Ac3ibu1wA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-29"><a href="#硬件电路-29" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcswBKfQTxAyL06aBbqq7pC9yoTobob3nEicJ3OLW3GPrZQIpQxicHLk4vzZTReOiaAfBbBV8exjz8RQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明：CAN总线接口分隐形电平与显性电平</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRvyAFj7UepXX1ZQ6Te9MVGduowEKVwicGKia8tEFBMhSCQGNzbGbF39OBg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-21"><a href="#技术讲解-21" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>一、CAN入门知识</p>
<p>阅读文档 - can入门教程.pdf</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRvFvvWvzz6AZ43GgOSl06KLRZoXJg8914wDlibMa7BibWmngiaa2pFqTFeQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>二、STM32F103的bxCAN</p>
<p>阅读STM32F1手册 - bxCAN章节</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRvicFznaQNp4GiaiaTKicz5iayS9lYntHZhm5Kjzicnk2M7CHUOHuafqYXibMYg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="HAL库函数-14"><a href="#HAL库函数-14" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRvxibBvW59Tcww5tFKGj5ZzvP48Ax8auEge7cpbibYicNB8rh4icu3yUFyZw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<stm32f1xx_hal_can.h>



<h4 id="编程说明-21"><a href="#编程说明-21" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRvNkgVkxt2JbDhgtb7G5BC2wWKOkgZKrbkNDKYN0gyQEKmxCtMovtjqg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>①、位时序</p>
<p>波特率计算 = 36M/4/(1+11+6) = 500HKz</p>
<p>②、工作模式</p>
<p>环回模式与正常模式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRvbeOiabdFWzY0lkzBaMvMJKD9DRqUvGuPyt5e6Lg0bsJ97pq6IGMxang/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>发送采用查询，接收采用中断</p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRviaQQ57SvhKlFnnAeRP5fawpictBWwGAFxlPM72Ljg1dEyaOmDjTxbQ8w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRvQJ9ll9vremAAMGeibibmjoYXclLv8H4ibKmRwiayM3c0SMA2ZshtCfBlrQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、CAN结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRv98tJMovtz9bpvMMd7fiaVX0KibC86VaOsBRG5wy9lG4gU160fkbwy9tw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、CAN配置函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRv6RKLw9vSYO9EVMSicD1O4G7vz009L7QCZeAicKJWCibGAlQGm17ibACzpw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>6、CAN发送函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRvyfmBPDXyAhdic6gw3odS6iaAVpOy6QI1PbTJHrKlK9TOd9W5sMdaPWmg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>7、CAN接收回调函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcNS4TqQhRcCRzL6ibBHstRvXxickyxPDImVTLuvDMGQMz183Cgf9BYlNXCEQ3hAMWsGibLWUbqgCEYQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="6-1的程序-17"><a href="#6-1的程序-17" class="headerlink" title="6+1的程序"></a>6+1的程序</h4><h3 id="FatFS文件系统-外部Flash读写"><a href="#FatFS文件系统-外部Flash读写" class="headerlink" title="FatFS文件系统(外部Flash读写)"></a>FatFS文件系统(外部Flash读写)</h3><h4 id="程序功能-22"><a href="#程序功能-22" class="headerlink" title="程序功能"></a>程序功能</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcglePegn8VZWoGaPhEsD587iaGgiat7rRjNhAiaDpF4pic50s77ZQ639wsaIsPFQk7pqZZDQwicicseIPw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-30"><a href="#硬件电路-30" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcglePegn8VZWoGaPhEsD58xPPM7mwe9nGnyPBAYob0DkibzrwJsoVicFQplibpdxBZocEEc0y1vvohQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-22"><a href="#技术讲解-22" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>FatFs是用于小型嵌入式系统的通用FAT / exFAT文件系统模块。FatFs模块是按照ANSI C（C89）编写的，并且与磁盘I / O层完全分开。因此，它独立于平台。可以将其合并到资源有限的小型微控制器中，例如8051，PIC，AVR，ARM，Z80，RX等。还提供了适用于小型微控制器的Petit FatFs模块。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcglePegn8VZWoGaPhEsD58hFX0pW9H0X7fHLYfPAhLB7Xib0ftXOMOGKCsW6EtEv3vXbbd2ApRVfA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><strong>带大家阅读官网资料：</strong><a target="_blank" rel="noopener" href="http://elm-chan.org/fsw/ff/00index_e.html">http://elm-chan.org/fsw/ff/00index_e.html</a></p>
<h4 id="编程说明-22"><a href="#编程说明-22" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcglePegn8VZWoGaPhEsD58NXKzqpmLWYWbRPHiakCUo6ic9VMm0hKuymhG8phC6Bm5BkmWWO53N9Sw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>Note：</p>
<p>①、支持长文件名</p>
<p>②、最大扇区尺寸，Flash为4096 bytes</p>
<p>③、支持设备的数量，此处为1</p>
<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcglePegn8VZWoGaPhEsD58ICZzhabnajibS0ogIgsj7c4HLTMPaDakyiaL040jYc6icGIKHe9rtBVeQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcglePegn8VZWoGaPhEsD58ERdEoDxS4YFBC8TNWbPWwyKxmMrH9pIGJxD7VLarPicYXmm8SRSF5eg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、MyFatFS结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcglePegn8VZWoGaPhEsD585sBDNFClTWhR5czUiaqZ9A56GeZ1vR2akDtziaE11X08ndtd4iaNyJW9Q/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、FatFS底层驱动初始化函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcglePegn8VZWoGaPhEsD58CCPd0EGqibUOGhoUKdOlzhibkX5A9FnlvY87pk9XU906zhRvGfibJpdTg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>6、FatFS底层驱动写数据函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcglePegn8VZWoGaPhEsD580QicWQnj7DPYjLVgMRL3ZwOQG629oeQfKVR0tZCMBW3U50bhPxzGaww/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>7、FatFS底层驱动读数据函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZcglePegn8VZWoGaPhEsD585bbdYQwqwqQpksXeezTevMC9J7vUV67YXGCddmzVs3APONVWhlpgXw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h3 id="SD卡-FatFS文件系统，IAP自动升级程序"><a href="#SD卡-FatFS文件系统，IAP自动升级程序" class="headerlink" title="SD卡(FatFS文件系统，IAP自动升级程序)"></a>SD卡(FatFS文件系统，IAP自动升级程序)</h3><h4 id="程序功能-23"><a href="#程序功能-23" class="headerlink" title="程序功能"></a>程序功能</h4><p>1、上电后，检测SD卡中是否有文件名为IAP-SD.bin的APP应用程序；</p>
<p>2、如果有，读取文件并写入flash,每次8k</p>
<p>3、跳转APP，运行应用程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsLBJgZvFbxicEFibrYC2NZw0KTnuAibByYDqPXc2DRRNrCnOeIRDfyNly2A/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="硬件电路-31"><a href="#硬件电路-31" class="headerlink" title="硬件电路"></a>硬件电路</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsLaSMCIfI3LmNtpTYRsKCgakzmMqZ9sDSOfVgRa7YreHbPvEicM5ax8QA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="技术讲解-23"><a href="#技术讲解-23" class="headerlink" title="技术讲解"></a>技术讲解</h4><p>1、SD卡介绍</p>
<p>方便储存数据，单片机系统需要大容量存储设备，通常用Flash芯片，SD卡，U盘。Flash芯片容量有限，通常16M-128M，需要专用设备烧录信息；U盘不适合嵌入到系统， SD卡容量可以几百M至32G，甚至更大，尺寸分SD卡与TF卡，通过电脑也方便写入信息，方便用于IAP升级与储存历史数据，图片数据等</p>
<p>SD卡支持SPI与SDIO驱动。只需几个IO便可可扩展高达32G以上的外部存储器，编程也方便，是单片机大容量存储设备的首选。</p>
<p>自行阅读下列文档，对SD卡有个大概认识：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsL5LicCaicqtEryHFKTRVGOE5HT5P3xWUthrxVjEicNpLa0PZWUGibmssSvg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、阅读STM32中文参考手册</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsLEfnSAf5UB0xHoSDTTUgUB0jtrGb4uLmc1H9hFRI8MVgf7fl4qvC73w/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsLFJj8Kib3BibDsvWz2KWL4JqBNh8g8XG2oapw01vrDMd1AfxKaI6GuukA/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="HAL库函数-15"><a href="#HAL库函数-15" class="headerlink" title="HAL库函数"></a>HAL库函数</h4><p>视频：阅读SDIO库函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsLjpjSbHG1O3vdLuMB8IsR4LgmhZELEe2TmRna2tBjNkghCDPkkQzknw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="编程说明-23"><a href="#编程说明-23" class="headerlink" title="编程说明"></a>编程说明</h4><p>1、STM32cubeMX初始化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsLhOodrvpAz0M4DboaVeVOX51RiaQFrATj5AwT4TIqy45UpEV2ZicwIZUQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<SDIO>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsL4OLic6oWEugS2llF0juPcAnDFhMkHRZO4qfcibvRrUKXc8WFL49tHibdg/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<FatFS>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsLVRd9yTg0JZxOrtfPRnoYqGZXq7JyaBooXWqd6mLAz25rPgP8iaeZTJQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<TF-CD>



<p>2、文件结构如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsLkwUicLvRFbicJK0QHdevWFEqZBpia7Ix1lD1X1xNztgwtnU6khbZRibHJw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>说明，程序在标准的程序框架基础上设计。</p>
<p>3、运行函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsL2fJVbwsCGVXCg7qythvu8a1F5VuKF4TpaLC2ZmPhUdCHQTcE4q3NMQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、MyFatFS结构体</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsLicmicyUUN081xRyWxfQfxWtthjubibVibqR7HZic9jB2q4OxbNaXd4PRDjQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>5、FatFS_IAP_SD自动升级程序函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZf1jSwQTWn6R3BSScsCficsLld6xFRaVrOMOhBINCSzGCj5SKuUtuwicK6gibLOcnmKzGRXom8Y7KMWQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h3 id="生产资料-项目结束"><a href="#生产资料-项目结束" class="headerlink" title="生产资料(项目结束)"></a>生产资料(项目结束)</h3><h4 id="生产资料"><a href="#生产资料" class="headerlink" title="生产资料"></a>生产资料</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfcMOC08X30VnQ8gzhk6l7SMXgYjODkwhQXcNo9vG5YSGEBTKLOoGYibbRkdn4Bkr0uibNROCrFDDbQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="资料介绍"><a href="#资料介绍" class="headerlink" title="资料介绍"></a>资料介绍</h4><p>1、BOM表</p>
<p>一般需要详细的列出元器件信息，包含位号、型号、封装、数量，安装方式等信息，另外，有必要的话，还可以列出图片，品牌等信息。</p>
<p>BOM表，一般公司有自己的规范，按照规范做好即可。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfcMOC08X30VnQ8gzhk6l7SKN9VhmbGTwH8v3BzpmowhGkSYk7GxeHBGKm8zAibd8Yo8qibpDia5KlHQ/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>2、gerber文件</p>
<p>Gerber文件是PCB生产制造文件，可以让PCB板厂帮忙拼板，提供gerber文件。 如果没有保密要求，也可以直接用PCB文件制板。</p>
<p>3、PCB文件</p>
<p>对于不需要保密的PCB文件，可以提供PCB原文件与拼板说明给到厂家，让厂家帮忙拼板，生产gerber文件。</p>
<p>制板说明：详细说明PCB板的生产工艺；</p>
<p>坐标文件：生产贴片用；</p>
<p>丝印图： 生产参照用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/uY9kIGsoHZfcMOC08X30VnQ8gzhk6l7Sibc7pLHiaMJ32soUFhNJ95OKuQK4UJAZhkY0O87PkvcePx94ugErpNLw/640?wx_fmt=png&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>4、<strong>pdf格式的PCB文件</strong></p>
<p>方便PCB厂家不熟悉pcb软件时，通过pdf格式的PCB文件，统计焊盘数量，提供贴片报价。</p>
<p><strong>5、原理图</strong></p>
<p>如果PCB厂帮忙测试与维修，可以提供pdf格式的原理图，有必要的话，还需提供维修文档。</p>
<p><strong>6、程序文件</strong></p>
<p>这个文件根据需要提供，一般公司都会保密，程序让单片机供应商代烧，或自行烧录，以确保产品安全。</p>
<p><strong>7、样机图</strong></p>
<p>最好提供样机图，有必要的话，需要提供样机实物，方便贴片厂参照，确保贴片无误。 另外，贴片出现问题时，也方便定位责任，如果是样机有误，你懂的。</p>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>STM32HAL库</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="http://example.com/2023/11/18/STM32HAL%E5%BA%93/">http://example.com/2023/11/18/STM32HAL%E5%BA%93/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>6+1</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2023-11-18</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2023-11-25</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/STM32/">STM32</a></div><div class="post_share"></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#STM32CubeMx"><span class="toc-number">1.</span> <span class="toc-text">STM32CubeMx</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">1.1.</span> <span class="toc-text">安装软件包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%92%9F%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">时钟配置问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">新建工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%8C%BA%E5%9F%9F"><span class="toc-number">1.4.</span> <span class="toc-text">代码区域</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E6%96%B0%E7%9A%84%E7%A8%8B%E5%BA%8F%E6%A1%86%E6%9E%B6"><span class="toc-number">2.</span> <span class="toc-text">全新的程序框架</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E6%A1%86%E6%9E%B6%E7%9A%84%E6%9E%84%E6%83%B3"><span class="toc-number">2.1.</span> <span class="toc-text">程序框架的构想</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E6%A1%86%E6%9E%B6%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.2.</span> <span class="toc-text">程序框架的实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyApplication-h"><span class="toc-number">2.3.</span> <span class="toc-text">MyApplication.h</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#main-c%E6%96%87%E4%BB%B6"><span class="toc-number">2.4.</span> <span class="toc-text">main.c文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#system%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.</span> <span class="toc-text">system文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Run%E5%87%BD%E6%95%B0"><span class="toc-number">2.6.</span> <span class="toc-text">Run函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">HAL库函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8c%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text">常用c函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#volatile"><span class="toc-number">3.1.1.</span> <span class="toc-text">volatile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#weak"><span class="toc-number">3.1.2.</span> <span class="toc-text">_weak</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GPIO"><span class="toc-number">3.2.</span> <span class="toc-text">GPIO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#USART"><span class="toc-number">3.3.</span> <span class="toc-text">USART</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TIM"><span class="toc-number">3.4.</span> <span class="toc-text">TIM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EXTI"><span class="toc-number">3.5.</span> <span class="toc-text">EXTI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NVIC"><span class="toc-number">3.6.</span> <span class="toc-text">NVIC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ADC"><span class="toc-number">3.7.</span> <span class="toc-text">ADC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DAC"><span class="toc-number">3.8.</span> <span class="toc-text">DAC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PWM"><span class="toc-number">3.9.</span> <span class="toc-text">PWM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RTC"><span class="toc-number">3.10.</span> <span class="toc-text">RTC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IWDG"><span class="toc-number">3.11.</span> <span class="toc-text">IWDG</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#System"><span class="toc-number">3.12.</span> <span class="toc-text">System</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PWR"><span class="toc-number">3.13.</span> <span class="toc-text">PWR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SPI"><span class="toc-number">3.14.</span> <span class="toc-text">SPI</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LED%E6%B5%81%E6%B0%B4%E7%81%AF"><span class="toc-number">4.</span> <span class="toc-text">LED流水灯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%BC%96%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">普通编程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%9C%BA%E6%B5%81%E6%B0%B4%E7%81%AF"><span class="toc-number">4.2.</span> <span class="toc-text">状态机流水灯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E6%B5%81%E6%B0%B4%E7%81%AF"><span class="toc-number">4.3.</span> <span class="toc-text">回调函数流水灯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F"><span class="toc-number">4.4.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE"><span class="toc-number">4.4.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF"><span class="toc-number">4.4.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81"><span class="toc-number">4.4.3.</span> <span class="toc-text">软件代码</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#LED%E6%96%87%E4%BB%B6"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">LED文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%9C%BA%E6%96%87%E4%BB%B6"><span class="toc-number">4.4.3.2.</span> <span class="toc-text">状态机文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BB%E5%87%BD%E6%95%B0"><span class="toc-number">4.4.3.3.</span> <span class="toc-text">主函数</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.4.4.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3%E6%89%93%E5%8D%B0"><span class="toc-number">5.</span> <span class="toc-text">串口打印</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD"><span class="toc-number">5.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-1"><span class="toc-number">5.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3"><span class="toc-number">5.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E"><span class="toc-number">5.4.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-1"><span class="toc-number">5.5.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-1"><span class="toc-number">5.5.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-2"><span class="toc-number">5.5.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-1"><span class="toc-number">5.5.3.</span> <span class="toc-text">软件代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">5.6.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">基本定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-1"><span class="toc-number">6.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-1"><span class="toc-number">6.2.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-1"><span class="toc-number">6.3.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-2"><span class="toc-number">6.4.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-2"><span class="toc-number">6.4.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-3"><span class="toc-number">6.4.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-2"><span class="toc-number">6.4.3.</span> <span class="toc-text">软件代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">6.4.4.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%94%AE"><span class="toc-number">7.</span> <span class="toc-text">按键</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-2"><span class="toc-number">7.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-4"><span class="toc-number">7.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-2"><span class="toc-number">7.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-2"><span class="toc-number">7.4.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-3"><span class="toc-number">7.5.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-3"><span class="toc-number">7.5.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-5"><span class="toc-number">7.5.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-3"><span class="toc-number">7.5.3.</span> <span class="toc-text">软件代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-1"><span class="toc-number">7.6.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%9C%82%E9%B8%A3%E5%99%A8"><span class="toc-number">8.</span> <span class="toc-text">蜂鸣器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-3"><span class="toc-number">8.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-6"><span class="toc-number">8.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-3"><span class="toc-number">8.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-3"><span class="toc-number">8.4.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-4"><span class="toc-number">8.5.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-4"><span class="toc-number">8.5.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-7"><span class="toc-number">8.5.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-4"><span class="toc-number">8.5.3.</span> <span class="toc-text">软件代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">9.</span> <span class="toc-text">高级定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-4"><span class="toc-number">9.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-4"><span class="toc-number">9.2.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-4"><span class="toc-number">9.3.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-5"><span class="toc-number">9.4.</span> <span class="toc-text">6+1的程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NTC-ADC"><span class="toc-number">10.</span> <span class="toc-text">NTC(ADC)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-5"><span class="toc-number">10.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-8"><span class="toc-number">10.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-5"><span class="toc-number">10.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-5"><span class="toc-number">10.4.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-6"><span class="toc-number">10.5.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-5"><span class="toc-number">10.5.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-9"><span class="toc-number">10.5.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-5"><span class="toc-number">10.5.3.</span> <span class="toc-text">软件代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">10.5.4.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DAC-1"><span class="toc-number">11.</span> <span class="toc-text">DAC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-6"><span class="toc-number">11.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-10"><span class="toc-number">11.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-6"><span class="toc-number">11.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-6"><span class="toc-number">11.4.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-7"><span class="toc-number">11.5.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-6"><span class="toc-number">11.5.1.</span> <span class="toc-text">工程配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DMA"><span class="toc-number">12.</span> <span class="toc-text">DMA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-7"><span class="toc-number">12.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-11"><span class="toc-number">12.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-7"><span class="toc-number">12.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-1"><span class="toc-number">12.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-7"><span class="toc-number">12.5.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-8"><span class="toc-number">12.6.</span> <span class="toc-text">6+1的程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#I2C"><span class="toc-number">13.</span> <span class="toc-text">I2C</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-8"><span class="toc-number">13.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-12"><span class="toc-number">13.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-8"><span class="toc-number">13.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-2"><span class="toc-number">13.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-8"><span class="toc-number">13.5.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-9"><span class="toc-number">13.6.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-7"><span class="toc-number">13.6.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-13"><span class="toc-number">13.6.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-6"><span class="toc-number">13.6.3.</span> <span class="toc-text">软件代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA"><span class="toc-number">14.</span> <span class="toc-text">直流电机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-9"><span class="toc-number">14.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-14"><span class="toc-number">14.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-9"><span class="toc-number">14.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-3"><span class="toc-number">14.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-9"><span class="toc-number">14.5.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-10"><span class="toc-number">14.6.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-8"><span class="toc-number">14.6.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-15"><span class="toc-number">14.6.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-7"><span class="toc-number">14.6.3.</span> <span class="toc-text">软件代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">14.6.4.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%89%E9%94%AE%E9%97%AE%E9%A2%98"><span class="toc-number">14.6.5.</span> <span class="toc-text">按键问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E6%9E%81%E6%80%A7%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA"><span class="toc-number">15.</span> <span class="toc-text">单极性步进电机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-10"><span class="toc-number">15.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-16"><span class="toc-number">15.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-10"><span class="toc-number">15.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-4"><span class="toc-number">15.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-10"><span class="toc-number">15.5.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-number">15.6.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E6%9E%81%E6%80%A7%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA"><span class="toc-number">16.</span> <span class="toc-text">双极性步进电机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-11"><span class="toc-number">16.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-17"><span class="toc-number">16.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-11"><span class="toc-number">16.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-5"><span class="toc-number">16.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-11"><span class="toc-number">16.5.</span> <span class="toc-text">编程说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HMI%E6%99%BA%E8%83%BD%E4%B8%B2%E5%8F%A3%E5%B1%8F"><span class="toc-number">17.</span> <span class="toc-text">HMI智能串口屏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-12"><span class="toc-number">17.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-18"><span class="toc-number">17.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-12"><span class="toc-number">17.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-12"><span class="toc-number">17.4.</span> <span class="toc-text">编程说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RS-485%E9%80%9A%E4%BF%A1-modbus%E5%8D%8F%E8%AE%AE"><span class="toc-number">18.</span> <span class="toc-text">RS-485通信 modbus协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-13"><span class="toc-number">18.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-19"><span class="toc-number">18.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-13"><span class="toc-number">18.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-6"><span class="toc-number">18.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-13"><span class="toc-number">18.5.</span> <span class="toc-text">编程说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WIFI%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1"><span class="toc-number">19.</span> <span class="toc-text">WIFI无线通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-14"><span class="toc-number">19.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-20"><span class="toc-number">19.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-14"><span class="toc-number">19.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-7"><span class="toc-number">19.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-14"><span class="toc-number">19.5.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-11"><span class="toc-number">19.6.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-9"><span class="toc-number">19.6.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-21"><span class="toc-number">19.6.2.</span> <span class="toc-text">硬件电路</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GPRS%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1"><span class="toc-number">20.</span> <span class="toc-text">GPRS无线通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-15"><span class="toc-number">20.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-22"><span class="toc-number">20.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-15"><span class="toc-number">20.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-8"><span class="toc-number">20.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-15"><span class="toc-number">20.5.</span> <span class="toc-text">编程说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RTC%E6%97%B6%E9%92%9F"><span class="toc-number">21.</span> <span class="toc-text">RTC时钟</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-16"><span class="toc-number">21.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-23"><span class="toc-number">21.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-16"><span class="toc-number">21.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-9"><span class="toc-number">21.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-16"><span class="toc-number">21.5.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-12"><span class="toc-number">21.6.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-10"><span class="toc-number">21.6.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-24"><span class="toc-number">21.6.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-8"><span class="toc-number">21.6.3.</span> <span class="toc-text">软件代码</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#RTC-1"><span class="toc-number">21.6.3.1.</span> <span class="toc-text">RTC</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#PUBLIC"><span class="toc-number">21.6.3.2.</span> <span class="toc-text">PUBLIC</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E4%B8%8E%E8%BF%90%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">21.6.3.3.</span> <span class="toc-text">回调函数与运行函数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8C%89%E9%94%AE-1"><span class="toc-number">21.6.3.4.</span> <span class="toc-text">按键</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-5"><span class="toc-number">21.7.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8B%AC%E7%AB%8B%E7%9C%8B%E9%97%A8%E7%8B%97"><span class="toc-number">22.</span> <span class="toc-text">独立看门狗</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-17"><span class="toc-number">22.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-25"><span class="toc-number">22.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-17"><span class="toc-number">22.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-10"><span class="toc-number">22.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-17"><span class="toc-number">22.5.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-13"><span class="toc-number">22.6.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-11"><span class="toc-number">22.6.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-26"><span class="toc-number">22.6.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-9"><span class="toc-number">22.6.3.</span> <span class="toc-text">软件代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E7%9C%8B%E9%97%A8%E7%8B%97"><span class="toc-number">23.</span> <span class="toc-text">窗口看门狗</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-18"><span class="toc-number">23.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-18"><span class="toc-number">23.2.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-11"><span class="toc-number">23.3.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-18"><span class="toc-number">23.4.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-14"><span class="toc-number">23.5.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-12"><span class="toc-number">23.5.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-10"><span class="toc-number">23.5.2.</span> <span class="toc-text">软件代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8E%E5%8A%9F%E8%80%97%E6%A8%A1%E5%BC%8F"><span class="toc-number">24.</span> <span class="toc-text">低功耗模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-19"><span class="toc-number">24.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-19"><span class="toc-number">24.2.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-12"><span class="toc-number">24.3.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-19"><span class="toc-number">24.4.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-15"><span class="toc-number">24.5.</span> <span class="toc-text">6+1的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%85%8D%E7%BD%AE-13"><span class="toc-number">24.5.1.</span> <span class="toc-text">工程配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-27"><span class="toc-number">24.5.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E4%BB%A3%E7%A0%81-11"><span class="toc-number">24.5.3.</span> <span class="toc-text">软件代码</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#LOWPOWRECONSUMPTION"><span class="toc-number">24.5.3.1.</span> <span class="toc-text">LOWPOWRECONSUMPTION</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#KEY"><span class="toc-number">24.5.3.2.</span> <span class="toc-text">KEY</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">24.5.3.3.</span> <span class="toc-text">运行函数</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%87%E7%94%A8%E8%A1%A8%E6%B5%8B%E5%8D%95%E7%89%87%E6%9C%BA%E7%94%B5%E6%B5%81"><span class="toc-number">25.</span> <span class="toc-text">万用表测单片机电流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">25.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E7%A8%8B%E5%BA%8F%E5%8D%87%E7%BA%A7-IAP"><span class="toc-number">26.</span> <span class="toc-text">在线程序升级(IAP)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-20"><span class="toc-number">26.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-28"><span class="toc-number">26.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-20"><span class="toc-number">26.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-13"><span class="toc-number">26.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-20"><span class="toc-number">26.5.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-16"><span class="toc-number">26.6.</span> <span class="toc-text">6+1的程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAN%E9%80%9A%E4%BF%A1"><span class="toc-number">27.</span> <span class="toc-text">CAN通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-21"><span class="toc-number">27.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-29"><span class="toc-number">27.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-21"><span class="toc-number">27.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-14"><span class="toc-number">27.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-21"><span class="toc-number">27.5.</span> <span class="toc-text">编程说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%9A%84%E7%A8%8B%E5%BA%8F-17"><span class="toc-number">27.6.</span> <span class="toc-text">6+1的程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FatFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-%E5%A4%96%E9%83%A8Flash%E8%AF%BB%E5%86%99"><span class="toc-number">28.</span> <span class="toc-text">FatFS文件系统(外部Flash读写)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-22"><span class="toc-number">28.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-30"><span class="toc-number">28.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-22"><span class="toc-number">28.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-22"><span class="toc-number">28.4.</span> <span class="toc-text">编程说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SD%E5%8D%A1-FatFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%8CIAP%E8%87%AA%E5%8A%A8%E5%8D%87%E7%BA%A7%E7%A8%8B%E5%BA%8F"><span class="toc-number">29.</span> <span class="toc-text">SD卡(FatFS文件系统，IAP自动升级程序)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD-23"><span class="toc-number">29.1.</span> <span class="toc-text">程序功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF-31"><span class="toc-number">29.2.</span> <span class="toc-text">硬件电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%AE%B2%E8%A7%A3-23"><span class="toc-number">29.3.</span> <span class="toc-text">技术讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAL%E5%BA%93%E5%87%BD%E6%95%B0-15"><span class="toc-number">29.4.</span> <span class="toc-text">HAL库函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%B4%E6%98%8E-23"><span class="toc-number">29.5.</span> <span class="toc-text">编程说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%B5%84%E6%96%99-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9D%9F"><span class="toc-number">30.</span> <span class="toc-text">生产资料(项目结束)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%B5%84%E6%96%99"><span class="toc-number">30.1.</span> <span class="toc-text">生产资料</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%84%E6%96%99%E4%BB%8B%E7%BB%8D"><span class="toc-number">30.2.</span> <span class="toc-text">资料介绍</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div class="copyright">&copy;2023 🏀 6+1</div><div id="running-time" style="color: #bbbbbb;"><script>setInterval(()=>{let create_time=Math.round(new Date('2023/11/21 08:00:00').getTime()/1000);let timestamp=Math.round((new Date().getTime()+8*60*60*1000)/1000);
let second=timestamp-create_time;let time=new Array(0,0,0,0,0);if(second>=365*24*3600){time[0]=parseInt(second/(365*24*3600));second%=365*24*3600;}if(second>=24*3600){time[1]=
parseInt(second/(24*3600));second%=24*3600;}if(second>=3600){time[2]=parseInt(second/3600);second%=3600;}if(second>=60){time[3]=parseInt(second/60);second%=60;}if(second>0){time[4]=second;}currentTimeHtml= 
  '<svg t="1700709558688" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1687" width="200" height="200"><path d="M471.49511147 378.65244479c62.57777813-20.02488853 153.48622187-17.6355552 190.80533333 44.032-27.76177813-2.50311147-55.5235552-5.46133333-83.17155627-8.64711146-1.70666667 2.95822187-5.23377813 8.76088853-6.94044373 11.60533333-41.64266667 3.52711147-77.5964448 26.51022187-103.08266667 58.82311147-12.17422187-34.70222187-9.55733333-71.4524448 2.38933334-105.81333334zM257.59288853 378.19733333c24.00711147-1.8204448 48.01422187-2.95822187 71.90755627-4.20977814 10.69511147 10.24 21.39022187 20.36622187 32.1991104 30.4924448-2.61688853 24.3484448-8.07822187 48.24177813-15.01866667 71.68-7.3955552-3.52711147-22.3004448-10.4675552-29.696-13.88088853-44.48711147-25.71377813-97.28-29.4684448-147.00088853-20.59377813 13.19822187-38.6844448 65.19466667-31.40266667 87.60888853-63.488z" fill="#FDFEFA" p-id="1688"></path><path d="M506.88 470.69866666c32.5404448-26.96533333 75.88977813-30.26488853 116.39466667-30.83377813-39.02577813 35.95377813-38.912 101.26222187 3.75466666 133.6888896-39.936-4.096-84.42311147-2.16177813-118.10133333-27.53422294-25.8275552-15.5875552-27.07911147-58.48177813-2.048-75.32088853zM116.05333333 521.78488853c10.24-51.65511147 62.6915552-65.3084448 107.7475552-69.0631104-32.88177813 38.57066667-28.4444448 92.04622187 0.7964448 131.2995552-43.46311147-3.64088853-89.65688853-19.11466667-108.544-62.2364448zM238.93333333 465.69244479c8.4195552 0.11377813 25.3724448 0.45511147 33.792 0.56888854 1.70666667 5.00622187 5.12 14.79111147 6.71288854 19.6835552-11.83288853 3.18577813-23.66577813 6.25777813-35.49866667 9.32977813l-5.00622187-29.58222187zM654.67733333 587.43466666c23.09688853-4.77866667 45.73866667-11.37777813 68.608-17.29422187 65.7635552 7.73688853 133.46133333 16.04266667 190.80533334 51.88266667 1.024 13.88088853 1.8204448 27.76177813 2.73066666 41.64266667 3.52711147 37.31911147-18.2044448 70.4284448-34.5884448 102.17244373-30.4924448 58.1404448-79.53066667 103.08266667-130.5031104 142.9048896-15.01866667 7.9644448-29.80977813 16.27022187-44.37333333 24.8035552-23.66577813 10.12622187-47.44533333 19.91111147-71.2248896 29.9235552-135.168 39.48088853-287.63022187 11.0364448-396.5155552-78.848-49.60711147-44.37333333-96.82488853-96.59733333-116.16711147-161.67822187-6.3715552-25.14488853-13.19822187-50.176-19.9111104-75.20711146 68.26666667-9.67111147 116.62222187 42.09777813 173.5111104 68.608 19.56977813 35.95377813 52.4515552 60.416 89.6568896 75.88977813-5.80266667 13.42577813-8.76088853 28.672-18.432 40.04977813-44.48711147 19.00088853-88.51911147-7.85066667-129.5928896-22.528 18.54577813 25.03111147 41.87022187 48.9244448 73.84177814 54.95466667 64.7395552 13.42577813 132.096 12.288 197.8595552 6.5991104 54.61333333-4.096 101.71733333-53.93066667 95.0044448-110.13688853-16.95288853 22.7555552-26.51022187 53.13422187-51.54133334 68.608-54.0444448 23.7795552-132.096 23.3244448-162.24711146-36.18133334 36.6364448-16.49777813 67.01511147-42.89422187 90.6808896-75.20711146 68.49422187-31.40266667 114.34666667-97.96266667 187.50577706-120.0355552 1.2515552-2.73066667 3.64088853-8.192 4.8924448-10.92266667M526.67733333 931.83999999c-54.38577813 12.288-109.68177813-1.70666667-163.38488853-11.15022186 5.12 42.2115552 48.46933333 28.672 76.45866667 36.75022186 25.8275552 26.05511147 65.7635552 17.52177813 98.07644373 12.40177814 38.6844448-12.62933333 79.98577813-33.22311147 93.7528896-75.09333334-35.72622187 10.4675552-69.51822187 26.05511147-104.90311147 37.0915552z" fill="#FDFEFA" p-id="1689"></path><path d="M799.63022187 8.53333333h16.1564448c28.21688853 22.7555552 55.86488853 47.9004448 70.76977813 81.80622186 34.36088853 72.9315552 55.86488853 154.96533333 45.62488853 235.97511147-7.168 36.75022187 11.60533333 70.54222187 21.16266667 105.01688853 55.63733333 179.4275552-19.6835552 388.096-172.8284448 495.50222294-105.2444448 76.34488853-244.05333333 106.04088853-370.80177707 75.43466666-109.568-25.6-210.37511147-91.3635552-273.63555626-184.8888896-82.7164448-117.87377813-108.99911147-277.04888853-56.5475552-412.672 42.7804448-91.70488853-5.80266667-190.35022187-19.56977814-283.0791104-8.9884448-43.2355552 37.54666667-77.36888853 77.48266667-70.08711146 66.7875552 8.30577813 119.35288853 52.67911147 174.76266667 86.47111146 44.14577813-10.80888853 85.44711147-32.31288853 131.18577813-37.31911146 73.728-13.88088853 148.7075552-0.7964448 220.04622187 18.77333333C709.06311147 83.05777813 735.80088853 15.13244479 799.63022187 8.53333333m-30.37866667 38.00177813c-28.10311147 37.0915552-57.5715552 73.728-92.84266667 104.22044373-28.78577813 2.61688853-55.75111147-13.42577813-83.85422186-18.20444373-96.93866667-16.72533333-199.68-3.2995552-286.26488854 44.60088853-54.38577813-49.60711147-120.14933333-92.84266667-195.92533333-96.71111146-8.53333333 9.32977813-17.06666667 18.54577813-25.48622293 27.87555626 19.456 62.80533333 32.5404448 127.54488853 40.27733333 192.7395552 13.88088853-15.92888853 27.19288853-32.31288853 40.16355627-49.03822186 7.85066667 0 23.66577813-0.2275552 31.63022186-0.22755627-22.3004448 45.62488853-60.87111147 81.6924448-77.5964448 130.38933333-52.11022187 112.29866667-43.008 242.80177813-4.096 357.48977814l8.192-16.72533334C142.79111147 788.02488853 190.00888853 840.24888853 239.616 884.62222186c108.88533333 89.8844448 261.3475552 118.32888853 396.5155552 78.848 23.7795552-10.0124448 47.55911147-19.79733333 71.2248896-29.9235552 14.5635552-8.53333333 29.35466667-16.83911147 44.37333333-24.8035552 50.9724448-39.82222187 100.01066667-84.7644448 130.5031104-142.9048896 16.384-31.744 38.1155552-64.85333333 34.5884448-102.17244373l20.02488854-0.7964448c-0.34133333-70.4284448 9.78488853-142.22222187-7.96444374-211.28533334-14.79111147-65.3084448-49.3795552-124.1315552-90.6808896-176.01422186-1.59288853-38.79822187-35.49866667-59.50577813-62.9191104-80.78222294 14.22222187-39.36711147 28.55822187-79.41688853 28.1031104-121.96977706 22.98311147 40.39111147 41.1875552 83.28533333 53.248 128.2275552 1.47911147 37.888 8.4195552 80.6684448 47.21777814 98.0764448-0.68266667-79.872-19.2284448-163.84-66.44622187-229.60355627-14.79111147-24.3484448-42.89422187-25.03111147-68.1528896-22.9831104z" fill="#9F4B06" p-id="1690"></path><path d="M469.10577813 484.46577813c25.48622187-32.31288853 61.44-55.296 103.08266667-58.82311147 56.43377813-2.73066667 128.11377813-10.92266667 170.09777707 35.38488853 29.35466667 34.70222187 15.47377813 83.85422187-19.00088854 109.1128896-22.86933333 5.9164448-45.51111147 12.5155552-68.608 17.29422187-55.75111147 3.52711147-121.0595552 7.28177813-165.54666666-32.88177813-20.93511147-17.1804448-19.79733333-45.62488853-20.02488854-70.0871104m37.77422187-13.76711147c-25.03111147 16.83911147-23.7795552 59.73333333 2.048 75.32088853 33.67822187 25.3724448 78.16533333 23.43822187 118.10133333 27.53422294-42.66666667-32.42666667-42.7804448-97.73511147-3.75466666-133.6888896-40.50488853 0.56888853-83.85422187 3.8684448-116.39466667 30.83377813m143.01866667 2.16177813c14.90488853 4.77866667 29.80977813 4.55111147 44.71466666-0.5688896-0.56888853-16.04266667-16.83911147-21.39022187-27.30666666-30.1511104-8.53333333 8.87466667-22.528 15.92888853-17.408 30.72zM101.83111147 533.39022186c-9.89866667-44.8284448 31.9715552-76.34488853 68.15288853-91.70488853 49.72088853-8.87466667 102.51377813-5.12 147.00088853 20.59377813 21.2764448 27.98933333 36.864 70.08711147 7.85066667 98.7591104-58.70933333 60.07466667-186.5955552 54.272-223.00444373-27.648m14.22222186-11.60533333c18.88711147 43.12177813 65.08088853 58.5955552 108.544 62.2364448-29.24088853-39.25333333-33.67822187-92.72888853-0.7964448-131.2995552-45.056 3.75466667-97.5075552 17.408-107.7475552 69.0631104M238.93333333 465.69244479l5.00622187 29.58222187c11.83288853-3.072 23.66577813-6.144 35.49866667-9.32977813-1.59288853-4.8924448-5.00622187-14.67733333-6.71288854-19.6835552-8.4195552-0.11377813-25.3724448-0.45511147-33.792-0.56888854zM325.29066667 671.40266666c48.69688853-0.7964448 118.89777813-12.74311147 136.9884448 46.99022187-23.66577813 32.31288853-54.0444448 58.70933333-90.6808896 75.20711146 30.15111147 59.50577813 108.20266667 59.96088853 162.24711146 36.18133334 25.03111147-15.47377813 34.5884448-45.8524448 51.54133334-68.608 6.71288853 56.20622187-40.39111147 106.04088853-95.0044448 110.13688853-65.7635552 5.68888853-133.12 6.82666667-197.8595552-6.5991104-31.9715552-6.03022187-55.296-29.9235552-73.84177814-54.95466667 41.07377813 14.67733333 85.10577813 41.52888853 129.5928896 22.528 9.67111147-11.37777813 12.62933333-26.624 18.432-40.04977813-37.20533333-15.47377813-70.08711147-39.936-89.6568896-75.88977813 11.94666667-14.5635552 23.89333333-29.12711147 35.95377814-43.69066667 2.048 9.4435552 6.25777813 28.4444448 8.4195552 37.888 0.91022187-9.78488853 2.8444448-29.35466667 3.8684448-39.1395552z" fill="#9F4B06" p-id="1691"></path><path d="M769.2515552 46.53511146c25.25866667-2.048 53.36177813-1.36533333 68.1528896 22.9831104 47.21777813 65.7635552 65.7635552 149.7315552 66.44622187 229.60355627-38.79822187-17.408-45.73866667-60.1884448-47.21777814-98.0764448-12.0604448-44.94222187-30.26488853-87.8364448-53.248-128.2275552 0.45511147 42.55288853-13.88088853 82.60266667-28.1031104 121.96977706 27.4204448 21.2764448 61.32622187 41.984 62.9191104 80.78222294 41.30133333 51.88266667 75.88977813 110.70577813 90.6808896 176.01422186 17.74933333 69.06311147 7.62311147 140.85688853 7.96444374 211.28533334l-20.02488854 0.7964448c-0.91022187-13.88088853-1.70666667-27.76177813-2.73066666-41.64266667-57.344-35.84-125.04177813-44.14577813-190.80533334-51.88266667 34.47466667-25.25866667 48.3555552-74.41066667 19.00088854-109.1128896-41.984-46.3075552-113.664-38.1155552-170.09777707-35.38488853 1.70666667-2.8444448 5.23377813-8.64711147 6.94044373-11.60533333 27.648 3.18577813 55.40977813 6.144 83.17155627 8.64711146-37.31911147-61.6675552-128.2275552-64.05688853-190.80533333-44.032-11.94666667 34.36088853-14.5635552 71.11111147-2.38933334 105.81333334 0.2275552 24.46222187-0.91022187 52.90666667 20.02488854 70.0871104 44.48711147 40.1635552 109.7955552 36.40888853 165.54666666 32.88177813-1.2515552 2.73066667-3.64088853 8.192-4.8924448 10.92266667-73.15911147 22.07288853-119.0115552 88.63288853-187.50577706 120.0355552-18.09066667-59.73333333-88.2915552-47.78666667-136.9884448-46.99022187-1.024 9.78488853-2.95822187 29.35466667-3.8684448 39.1395552-2.16177813-9.4435552-6.3715552-28.4444448-8.4195552-37.888-12.0604448 14.5635552-24.00711147 29.12711147-35.95377814 43.69066667-56.88888853-26.51022187-105.2444448-78.27911147-173.5111104-68.608 6.71288853 25.03111147 13.5395552 50.06222187 19.9111104 75.20711146l-8.192 16.72533334c-38.912-114.688-48.01422187-245.19111147 4.096-357.48977814 16.72533333-48.69688853 55.296-84.7644448 77.5964448-130.38933333-7.9644448 0-23.7795552 0.2275552-31.63022186 0.22755627A1108.13866667 1108.13866667 0 0 1 125.1555552 301.05599999c-7.73688853-65.19466667-20.82133333-129.93422187-40.27733333-192.7395552 8.4195552-9.32977813 16.95288853-18.54577813 25.48622293-27.87555626 75.776 3.8684448 141.5395552 47.104 195.92533333 96.71111146 86.58488853-47.9004448 189.32622187-61.32622187 286.26488854-44.60088853 28.10311147 4.77866667 55.0684448 20.82133333 83.85422186 18.20444373 35.27111147-30.4924448 64.7395552-67.12888853 92.84266667-104.22044373M257.59288853 378.19733333c-22.41422187 32.08533333-74.41066667 24.8035552-87.60888853 63.488-36.18133333 15.36-78.0515552 46.8764448-68.15288853 91.70488853 36.40888853 81.92 164.29511147 87.72266667 223.00444373 27.648 29.01333333-28.672 13.42577813-70.76977813-7.85066667-98.7591104 7.3955552 3.41333333 22.3004448 10.35377813 29.696 13.88088853 6.9404448-23.43822187 12.40177813-47.3315552 15.01866667-71.68-10.80888853-10.12622187-21.504-20.2524448-32.1991104-30.4924448-23.89333333 1.2515552-47.9004448 2.38933333-71.90755627 4.20977814z" fill="#FEE173" p-id="1692"></path><path d="M649.89866667 472.86044479c-5.12-14.79111147 8.87466667-21.84533333 17.408-30.72 10.4675552 8.76088853 26.73777813 14.1084448 27.30666666 30.1511104-14.90488853 5.12-29.80977813 5.3475552-44.71466666 0.5688896zM526.67733333 931.83999999c35.38488853-11.0364448 69.17688853-26.624 104.90311147-37.0915552-13.76711147 41.87022187-55.0684448 62.464-93.7528896 75.09333334-32.31288853 5.12-72.24888853 13.65333333-98.07644373-12.40177814-27.98933333-8.07822187-71.33866667 5.46133333-76.45866667-36.75022186 53.70311147 9.4435552 108.99911147 23.43822187 163.38488853 11.15022186z" fill="#FEE173" p-id="1693"></path></svg> 已经活了 '+time[0]+' 年 '+time[1]+' 天 '+time[2]+' 时 '+time[3]+' 分 '+time[4]+' 秒';document.getElementById("running-time").innerHTML=currentTimeHtml;},1000);</script></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="javascript:rmf.switchReadMode();"><i class="fa fa-book"></i><span>阅读模式</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async data-pjax src="/js/txmap.js"></script><script defer src="/js/fomal.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script async src="//at.alicdn.com/t/c/font_4341224_thz0gklagdp.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script src="/js/sun_moon.js" async></script><script type="text/javascript" src="https://cdn1.tianli0.top/npm/jquery@latest/dist/jquery.min.js"></script><script type="text/javascript" src="/js/rightmenu.js"></script><script async src="/js/title.js"></script><script defer data-pjax src="/js/readPercent.js"></script><script async type="text/javascript" src="https://jsd.onmicrosoft.cn/npm/izitoast@1.4.0/dist/js/iziToast.min.js"></script><script>
    document.body.oncopy = function () {
        iziToast.info({
            timeout: 4000, // 关闭弹窗的时间
          // icon: 'Fontawesome', // 图标类别
            closeOnEscape: 'true', // 允许使用Esc键关闭弹窗
            transitionIn: 'bounceInLeft', // 弹窗打开动画
            transitionOut: 'fadeOutRight', // 弹窗关闭动画
            displayMode: 'replace', // 替换已经打开的弹窗
            layout: '2', // Medium模式
            position: 'topLeft', // 弹窗位置
            //icon: 'fad fa-copy', // 图标类名
            iconUrl:'https://blogblog-1322568013.cos.ap-guangzhou.myqcloud.com/image/%E6%98%9F%E6%98%9F.svg',
            backgroundColor: 'rgb(179, 182, 180)', // 弹窗背景色
            title: '复制成功', // 通知标题
            message: '😝好好学习，天天向上😝' // 通知消息内容
        });
    }
</script>
<script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.6.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/11/18/STM32HAL库/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/num9.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-11-18</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/11/18/STM32HAL库/&quot;);" href="javascript:void(0);" alt="">STM32HAL库</a><div class="blog-slider__text">HAL库</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/11/18/STM32HAL库/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/11/18/江科大STM32/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/num6.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-11-18</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/11/18/江科大STM32/&quot;);" href="javascript:void(0);" alt="">STM32标准库</a><div class="blog-slider__text">标准库</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/11/18/江科大STM32/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/11/18/FreeRTOS/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/num11.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-11-18</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/11/18/FreeRTOS/&quot;);" href="javascript:void(0);" alt="">FreeRTOS</a><div class="blog-slider__text">单片机操作系统</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/11/18/FreeRTOS/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '2');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('pagination');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__rotateInDownLeft');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>